<?php
 namespace app\index\logic; use app\index\model\Contacts; use think\Db; use app\index\service\RequestContext; class Contact extends Base { const GENDER = array("\345\205\210\xe7\x94\x9f", "\345\245\xb3\345\xa3\xab"); const MODULE = "\x43\x6f\156\x74\141\143\x74\x73"; private $model; protected function __construct() { $this->model = new Contacts(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $order = "\143\56\x69\x64\x20\x64\145\163\x63") { goto W0sjv; tGP4L: $model->where($where); goto kTb0e; v08Bj: hrjMA: goto CzQpO; Vsgmg: o2Tzt: goto g_pDN; ybmOY: Npnrv: goto tGP4L; g_pDN: $items = $clone->join("\x65\156\x74\145\x72\160\x72\151\x73\145\x73\137\146\157\165\156\144\145\x72\163\x20\145\146", "\145\x66\x2e\x63\x6f\156\164\x61\x63\164\x5f\x69\144\75\143\x2e\151\144", "\114\x45\106\124")->field("\x63\56\52\x2c\x65\146\56\x65\x6e\164\x65\x72\160\162\151\x73\145\137\x69\144")->page($page, $rows)->order($order)->select(); goto Btvmp; NQuU5: $where["\x63\x2e\156\141\x6d\x65"] = ["\154\151\x6b\145", "\x25{$search["\156\x61\x6d\145"]}\x25"]; goto v08Bj; Btvmp: return ["\x74\x6f\x74\x61\154" => $count, "\162\157\x77\163" => $items]; goto eLGnO; uz0rI: if (!empty($count)) { goto o2Tzt; } goto KcF_y; KerC_: $where = ["\143\56\144\x65\x6c\x65\x74\145\x64" => 0]; goto UurRG; CzQpO: if (!(isset($search["\x6d\151\156\x65"]) && $search["\155\x69\x6e\145"])) { goto Npnrv; } goto qif22; KcF_y: return []; goto Vsgmg; k4Nmw: $where["\162\56\165\x73\x65\x72\x5f\x69\144"] = RequestContext::I()->loginUserId; goto ncF0t; UurRG: if (!(isset($search["\156\141\155\145"]) && $search["\156\x61\155\x65"])) { goto hrjMA; } goto NQuU5; ncF0t: $model->join("\x75\163\145\x72\x73\x5f\162\x65\143\157\162\144\x73\x20\162", "\143\x2e\x69\144\75\x72\x2e\162\145\143\x6f\162\144\x5f\x69\144"); goto ybmOY; qif22: $where["\162\x2e\x6d\157\144\x75\x6c\x65"] = self::MODULE; goto k4Nmw; W0sjv: $model = Db::table("\x63\157\156\x74\x61\143\164\163")->alias("\x63"); goto KerC_; Avy7T: $count = $model->count(); goto uz0rI; kTb0e: $clone = clone $model; goto Avy7T; eLGnO: } public function getContact($id) { goto LSKGk; qGaqv: return $row ?: []; goto YIxX3; Ee10j: $row = $this->model->where("\x69\144", $id)->find(); goto qGaqv; A3MHD: return []; goto C1zz4; C1zz4: D9O0w: goto Ee10j; LSKGk: if (!empty($id)) { goto D9O0w; } goto A3MHD; YIxX3: } public function saveContact($id, $data) { goto ujZ3y; Qm_7z: $data["\x63\162\145\x61\x74\x65\x64\137\x62\x79"] = session("\x75\163\145\162\x69\x64"); goto es9Pl; TDnIu: $data["\x61\x67\x65"] = null; goto GcYIf; MLpnV: D6dvj: goto tu8Q7; yPuFJ: goto zXumD; goto WCjL8; c8R40: UserRecord::I()->setRecordUsers(self::MODULE, $id, $assigners, $primary_assigner); goto fCFPm; mWGL5: if (empty($data["\141\x64\x64\x69\x74\151\x6f\x6e\x61\154\x5f\141\x73\163\x69\x67\x6e\x65\162\x73"])) { goto nxoNk; } goto FT0qD; fGfb8: if (!(isset($data["\141\147\x65"]) && empty($data["\x61\147\145"]))) { goto O0jt1; } goto TDnIu; R7u0N: zXumD: goto c8R40; Shdtm: EeiNa: goto la72S; GcYIf: O0jt1: goto EO2yY; u1rYW: if (!is_array($data["\x61\163\163\x69\x67\156\145\162"])) { goto EeiNa; } goto rjuSG; QuQb8: if (empty($id)) { goto S6G4d; } goto pUrZo; bo5KK: nenCA: goto fGfb8; es9Pl: $this->model->allowField(true)->save($data); goto Drkli; PoEnz: goto TA8Pc; goto cXvJf; ujZ3y: if (!(isset($data["\156\x61\x6d\145"]) && empty($data["\x6e\x61\x6d\145"]))) { goto nenCA; } goto oU2W_; M0uIs: kG4Z1: goto mCkOD; la72S: $assigners = $data["\141\163\163\151\x67\156\x65\162"]; goto mWGL5; mCkOD: $assigners .= "\x2c" . $data["\x61\144\144\x69\164\x69\x6f\156\x61\154\x5f\141\163\163\x69\147\156\145\x72\x73"]; goto PoEnz; pUrZo: $this->model->allowField(true)->save($data, ["\151\x64" => $id]); goto yPuFJ; BY4u8: TA8Pc: goto QuQb8; cXvJf: nxoNk: goto lTp9O; lTp9O: $data["\141\x64\x64\x69\164\151\x6f\x6e\x61\154\x5f\x61\163\163\151\147\156\x65\x72\x73"] = ''; goto BY4u8; EO2yY: $primary_assigner = $data["\141\x73\163\x69\x67\x6e\145\162"]; goto u1rYW; rjuSG: $data["\x61\x73\x73\x69\147\156\145\x72"] = join("\x2c", $data["\x61\x73\x73\151\147\x6e\145\x72"]); goto Shdtm; WCjL8: S6G4d: goto Qm_7z; FT0qD: if (!is_array($data["\141\x64\144\x69\164\x69\157\156\141\154\137\x61\163\163\151\147\x6e\145\162\x73"])) { goto kG4Z1; } goto LGuyb; fCFPm: if (!$data["\164\141\147\163"]) { goto D6dvj; } goto Ec0eU; Ec0eU: Tag::I()->setEntityTags($id, $data["\164\141\147\x73"]); goto MLpnV; LGuyb: $data["\141\144\144\151\x74\x69\157\x6e\141\154\x5f\x61\x73\163\151\x67\156\x65\162\x73"] = join("\x2c", $data["\x61\144\x64\151\164\151\x6f\156\141\x6c\137\x61\x73\x73\151\x67\156\x65\x72\x73"]); goto M0uIs; Drkli: $id = $this->model->id; goto R7u0N; oU2W_: exception("\350\xaf\267\345\xa1\xab\345\206\x99\345\210\x9b\xe5\xa7\213\344\272\272\xe5\xa7\x93\345\220\x8d"); goto bo5KK; tu8Q7: return $id; goto ymqpk; ymqpk: } public function delete($id) { $result = $this->model->where("\x69\x64", $id)->setField("\x64\145\x6c\x65\164\x65\x64", 1); return $result > 0 ? true : false; } public function password($id, $password, $username = '') { goto j0mPe; me0Nk: x9qGK: goto d1saR; Ieffl: if (!$exists) { goto x9qGK; } goto Kx3yD; lwZOY: Db::table("\x63\x6f\x6e\x74\x61\143\x74\x73")->where("\x69\144", $id)->update($update); goto srtra; Kx3yD: exception("\350\xb4\xa6\345\x8f\xb7\xe9\x87\x8d\345\244\x8d\357\xbc\x8c\xe8\257\xb7\xe6\233\264\xe6\x8d\xa2"); goto me0Nk; d1saR: $update["\165\163\x65\162\x6e\141\x6d\145"] = $username; goto JR24P; u5aa3: if (empty($username)) { goto Y7PVO; } goto AKdDn; j0mPe: $update = ["\x70\x61\x73\x73\167\157\x72\144" => md5($password)]; goto u5aa3; JR24P: Y7PVO: goto lwZOY; AKdDn: $exists = Db::table("\143\157\156\164\x61\x63\164\x73")->where(["\x69\144" => ["\x6e\145\161", $id], "\x75\163\145\x72\156\x61\155\x65" => $username])->value("\151\x64"); goto Ieffl; srtra: } }
