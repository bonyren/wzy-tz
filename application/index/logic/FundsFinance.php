<?php
 namespace app\index\logic; use app\index\model\FundsFinanceContributes; use app\index\model\FundsFinanceIncomes; use app\index\model\FundsFinanceEnterprises; use app\index\model\FundsFinanceFees; use app\index\model\FundsFinanceTaxes; use app\index\model\Setting; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs; class FundsFinance extends Base { const FUND_FINANCE_PAID_ITEM_INCOME_TYPE = 1; const FUND_FINANCE_PAID_ITEM_TAX_TYPE = 2; const FUND_FINANCE_PAID_ITEM_FEE_TYPE = 3; const FUND_FINANCE_PAID_ITEM_ENTERPRISE_TYPE = 4; const FUND_FINANCE_PAID_ITEM_CONTRIBUTE_TYPE = 5; protected static $fundFinanceTableDefs = array(self::FUND_FINANCE_PAID_ITEM_INCOME_TYPE => "\146\165\156\x64\x73\137\146\x69\156\x61\x6e\x63\145\x5f\151\156\x63\x6f\155\145\163", self::FUND_FINANCE_PAID_ITEM_TAX_TYPE => "\x66\165\x6e\144\163\137\146\151\156\x61\156\143\145\x5f\164\141\x78\x65\x73", self::FUND_FINANCE_PAID_ITEM_FEE_TYPE => "\146\165\156\x64\163\137\146\151\x6e\x61\x6e\143\145\137\x66\145\145\x73", self::FUND_FINANCE_PAID_ITEM_ENTERPRISE_TYPE => "\x66\x75\156\x64\163\x5f\x66\x69\x6e\141\x6e\143\x65\x5f\145\156\164\x65\162\x70\162\151\163\145\x73", self::FUND_FINANCE_PAID_ITEM_CONTRIBUTE_TYPE => "\x66\x75\x6e\x64\163\137\x66\x69\x6e\x61\156\x63\145\137\143\x6f\x6e\x74\162\x69\142\x75\164\x65\163"); protected static $fundFinanceIdFieldDefs = array(self::FUND_FINANCE_PAID_ITEM_INCOME_TYPE => "\146\x66\151\x5f\151\144", self::FUND_FINANCE_PAID_ITEM_TAX_TYPE => "\146\x66\x74\137\x69\x64", self::FUND_FINANCE_PAID_ITEM_FEE_TYPE => "\146\146\x66\x5f\x69\x64", self::FUND_FINANCE_PAID_ITEM_ENTERPRISE_TYPE => "\146\146\145\137\x69\144", self::FUND_FINANCE_PAID_ITEM_CONTRIBUTE_TYPE => "\146\146\143\137\151\144"); protected function __construct() { parent::__construct(); } public function getFinanceInfos($fundId) { goto XrObg; Av8Ic: $leftAmount = $contributes["\164\157\x74\141\x6c"] + array_sum(array_column($incomes, "\164\x6f\x74\141\154")) - $invests["\164\x6f\x74\141\154"] - array_sum(array_column($taxes, "\x74\157\x74\x61\x6c")) - array_sum(array_column($fees, "\x74\x6f\x74\141\x6c")); goto mPxlF; lNbAY: $invests = ["\x74\x6f\164\141\154" => 0.0, "\160\141\151\144" => 0.0, "\x6c\x65\146\164" => 0.0]; goto Nd2VC; CHpu4: $contributes = ["\x74\x6f\x74\x61\154" => 0.0, "\160\141\x69\x64" => 0.0, "\x6c\145\x66\164" => 0.0]; goto z0T3q; ZNPSw: $incomes = Db::table("\146\x75\x6e\x64\x73\137\146\x69\156\141\x6e\x63\145\x5f\151\x6e\x63\157\155\145\163")->where("\146\x75\156\144\x5f\x69\144", $fundId)->group("\164\x79\160\145")->field(["\164\171\x70\145", "\163\165\155\x28\x61\155\x6f\165\x6e\164\51" => "\x74\157\164\141\x6c"])->select(); goto EoQGx; z0T3q: $contributes["\164\x6f\x74\x61\x6c"] = Db::table("\x66\x75\x6e\x64\x73\x5f\x66\x69\x6e\141\156\143\x65\137\x63\157\156\x74\162\x69\142\165\164\145\163")->where("\x66\165\x6e\144\137\151\x64", $fundId)->sum("\141\155\157\x75\156\164"); goto lNbAY; XrObg: $leftAmount = 0.0; goto CHpu4; EoQGx: $taxes = Db::table("\x66\x75\156\x64\x73\137\x66\x69\156\x61\156\143\x65\x5f\164\x61\x78\x65\163")->where("\146\165\x6e\x64\x5f\151\x64", $fundId)->group("\x74\171\x70\145")->field(["\164\171\160\x65", "\x73\x75\x6d\50\141\155\x6f\x75\156\164\x29" => "\x74\x6f\164\x61\154"])->select(); goto l8mv3; l8mv3: $fees = Db::table("\x66\x75\x6e\144\x73\137\146\151\x6e\x61\x6e\143\145\x5f\146\145\145\x73")->where("\146\165\156\144\137\x69\x64", $fundId)->group("\x74\171\x70\145")->field(["\x74\171\x70\x65", "\163\165\x6d\x28\x61\x6d\157\x75\156\x74\x29" => "\164\x6f\x74\141\x6c"])->select(); goto Av8Ic; Nd2VC: $invests["\x74\157\164\x61\x6c"] = Db::table("\146\x75\156\144\x73\x5f\146\x69\x6e\141\156\143\x65\137\145\156\x74\145\x72\x70\162\x69\163\145\163")->where("\146\165\x6e\x64\x5f\x69\x64", $fundId)->sum("\141\x6d\157\165\x6e\x74"); goto ZNPSw; mPxlF: return ["\x6c\x65\x66\164\137\141\155\x6f\165\156\164" => $leftAmount, "\x63\157\156\x74\162\151\142\165\164\145\x73" => $contributes, "\x69\156\x63\157\155\x65\163" => $incomes, "\164\141\x78\x65\163" => $taxes, "\151\x6e\166\145\163\x74\x73" => $invests, "\146\x65\145\163" => $fees]; goto ZJYlm; ZJYlm: } public function loadFinanceContributes($fundId) { goto dhx5E; dhx5E: $records = Db::table("\146\x75\x6e\144\163\x5f\x66\x69\x6e\141\156\x63\x65\137\x63\157\156\x74\x72\151\x62\x75\x74\x65\x73")->where("\146\165\156\144\x5f\x69\144", $fundId)->order("\x66\146\143\x5f\151\144\x20\x64\x65\x73\x63")->field(true)->select(); goto Ki479; Ki479: $totalAmount = 0.0; goto BQEN_; pVWrg: return ["\164\x6f\164\141\x6c" => count($records), "\162\157\167\163" => $records, "\146\x6f\x6f\164\x65\162" => [["\146\x66\x63\x5f\151\144" => 0, "\144\141\x74\x65" => "\xe6\x80\273\350\256\241", "\141\155\x6f\x75\156\x74" => $totalAmount]]]; goto LP4Sh; BQEN_: foreach ($records as &$record) { $totalAmount += $record["\141\x6d\157\165\156\164"]; GqzKB: } goto ETmZr; ETmZr: XKnj6: goto pVWrg; LP4Sh: } public function getFinanceContributeInfos($ffcId) { goto NoDou; hHgXg: if ($infos) { goto X1Q7f; } goto QpSdt; NoDou: $infos = Db::table("\x66\165\156\144\163\x5f\146\x69\156\141\x6e\143\x65\x5f\x63\x6f\156\x74\162\x69\x62\165\x74\x65\x73")->where("\x66\x66\x63\137\x69\x64", $ffcId)->field(true)->find(); goto hHgXg; Uty05: if ($taxes) { goto Mo_dJ; } goto iq7ve; WdDXz: return $infos; goto NvCC0; k2rCB: Mo_dJ: goto OU4mr; dmagC: X1Q7f: goto XKJC7; OU4mr: $infos["\x74\x61\x78"] = $taxes; goto WdDXz; QpSdt: return null; goto dmagC; iq7ve: $taxes = []; goto k2rCB; XKJC7: $taxes = Db::table("\x66\x75\156\144\x73\x5f\146\151\x6e\141\x6e\x63\x65\x5f\x74\141\170\x65\x73")->where("\x66\146\143\x5f\151\x64", $ffcId)->column("\141\155\x6f\165\156\164", "\164\171\x70\x65"); goto Uty05; NvCC0: } public function addFinanceContribute($fundId, $infos) { goto qBnFM; JPe0q: Zr_lS: goto o_sbW; jMSCg: $datas["\x61\x6d\157\165\x6e\164"] = $infos["\141\x6d\157\165\x6e\x74"]; goto b4j17; o_sbW: return $ffcId; goto F025R; qBnFM: $datas = []; goto mIcc3; OJXJ6: $model->save(); goto rJTy0; SqJ_D: $model->data($datas); goto OJXJ6; kyQ6T: $datas["\164\x69\164\x6c\145"] = $infos["\x74\151\164\x6c\x65"]; goto jMSCg; zfRJW: $model = model("\106\165\x6e\144\163\x46\x69\156\141\x6e\143\x65\103\157\156\164\162\x69\x62\x75\164\x65\x73"); goto SqJ_D; mIcc3: $datas["\x66\x75\x6e\x64\137\x69\x64"] = $fundId; goto kyQ6T; sro5c: THBVW: goto rLmuB; xesl3: if (!emptyInArray($infos, "\164\141\x78\137\164\x79\160\145")) { goto B_eiD; } goto NkLoB; b4j17: $datas["\x64\x61\164\145"] = $infos["\x64\141\x74\145"]; goto zfRJW; hyb_6: if (is_array($infos["\164\141\x78\x5f\164\171\160\145"])) { goto THBVW; } goto Rk7ba; NkLoB: return $ffcId; goto LxqBh; rJTy0: $ffcId = $model->ffc_id; goto xesl3; rLmuB: foreach ($infos["\x74\x61\170\137\x74\x79\160\145"] as $taxType => $taxValue) { goto Wipcv; EBp29: lsRQg: goto rkrwj; Wipcv: $taxModel = model("\x46\165\156\144\x73\106\x69\156\x61\x6e\x63\145\124\x61\x78\145\163"); goto iGekt; iGekt: $taxDatas = ["\146\165\x6e\x64\137\151\144" => $fundId, "\x74\151\164\154\x65" => $datas["\164\151\164\x6c\x65"] . "\55" . Defs::$fundTaxTypeDefs[$taxType], "\141\x6d\x6f\x75\x6e\164" => $infos["\164\x61\x78"][$taxType], "\164\171\x70\x65" => $taxType, "\144\x61\x74\145" => $datas["\144\141\x74\145"], "\x66\146\143\x5f\x69\144" => $ffcId]; goto CZoCH; HuB5J: $taxModel->isUpdate(false)->save(); goto EBp29; CZoCH: $taxModel->data($taxDatas); goto HuB5J; rkrwj: } goto JPe0q; LxqBh: B_eiD: goto hyb_6; Rk7ba: return $ffcId; goto sro5c; F025R: } public function editFinanceContribute($ffcId, $infos) { goto SnSvw; q82BW: foreach ($infos["\x74\x61\170\137\164\171\160\145"] as $taxType => $taxValue) { goto W6TH1; n8Xic: Ms8TE: goto y10SO; apV1x: goto Lc_3a; goto n8Xic; IOIgB: $taxModel->data($taxDatas); goto MG0gx; UR0RL: sOdIl: goto TRuHM; dPs2P: $taxModel = model("\106\165\156\144\x73\x46\151\x6e\x61\x6e\143\145\124\x61\170\145\x73"); goto IOIgB; UQUKX: Lc_3a: goto UR0RL; wScTo: $taxModel = FundsFinanceTaxes::get(["\146\146\x63\x5f\x69\x64" => $ffcId, "\x74\171\160\145" => $taxType]); goto BOWIt; MG0gx: $taxModel->isUpdate(false)->save(); goto apV1x; BOWIt: if ($taxModel) { goto Ms8TE; } goto dPs2P; y10SO: $taxModel->data($taxDatas); goto nRMsx; W6TH1: $taxDatas = ["\x66\165\x6e\x64\x5f\x69\144" => $fundId, "\x74\x69\x74\154\145" => $datas["\x74\151\164\x6c\145"] . "\x2d" . Defs::$fundTaxTypeDefs[$taxType], "\141\155\157\165\156\164" => $infos["\x74\x61\x78"][$taxType], "\164\x79\x70\145" => $taxType, "\x64\x61\x74\145" => $datas["\144\x61\164\145"], "\146\146\x63\137\151\144" => $ffcId]; goto wScTo; nRMsx: $taxModel->save(); goto UQUKX; TRuHM: } goto HOxTK; x08sE: $model->save(); goto mFuwZ; utLqf: $existTaxTypes = Db::table("\x66\x75\156\144\163\x5f\x66\x69\x6e\141\156\x63\145\137\x74\x61\170\145\163")->where("\x66\146\x63\137\151\x64", $ffcId)->column("\x74\171\x70\145"); goto E29Th; ziaPL: return false; goto hAcGQ; DvXyj: $infos["\164\x61\170\x5f\164\x79\160\x65"] = []; goto OlRko; GExUz: return true; goto Ry_Al; M5SOa: $datas["\164\151\164\154\145"] = $infos["\x74\151\164\x6c\x65"]; goto BVeSl; E29Th: foreach ($existTaxTypes as $existTaxType) { goto hT0SB; TZ1kb: t39Kp: goto nFlou; Ao9zn: QZxL2: goto TZ1kb; nFlou: whGKt: goto YMp1L; vDbh5: if (!$taxModel) { goto QZxL2; } goto M317x; M317x: $taxModel->delete(); goto Ao9zn; DY18i: $taxModel = FundsFinanceTaxes::get(["\146\146\143\137\x69\144" => $ffcId, "\164\171\x70\145" => $existTaxType]); goto vDbh5; hT0SB: if (array_key_exists($existTaxType, $infos["\x74\141\170\x5f\164\171\x70\145"])) { goto t39Kp; } goto DY18i; YMp1L: } goto MVv6t; g3wxC: $model->data($datas); goto x08sE; R8V04: $datas = []; goto M5SOa; mtYsm: return false; goto XzLW2; hAcGQ: cIb7y: goto q82BW; Y9mP0: $fundId = Db::table("\146\165\156\144\x73\137\x66\151\x6e\x61\156\x63\x65\x5f\x63\x6f\156\164\x72\x69\142\165\x74\145\x73")->where("\x66\x66\143\x5f\151\x64", $ffcId)->value("\x66\x75\x6e\144\x5f\x69\x64"); goto UkO2Y; mFuwZ: if (!emptyInArray($infos, "\x74\141\x78\x5f\164\x79\x70\145")) { goto FYwwZ; } goto DvXyj; XzLW2: qaMA3: goto Y9mP0; lfiZw: if (is_array($infos["\164\x61\170\x5f\x74\171\160\x65"])) { goto qaMA3; } goto mtYsm; OlRko: FYwwZ: goto lfiZw; Pm4RM: $datas["\x64\x61\x74\x65"] = $infos["\x64\x61\164\145"]; goto g3wxC; CTk5c: return false; goto cHJHB; MVv6t: Dyq16: goto GExUz; BVeSl: $datas["\141\x6d\157\165\156\x74"] = $infos["\141\155\157\x75\156\x74"]; goto Pm4RM; UkO2Y: if ($fundId) { goto cIb7y; } goto ziaPL; HOxTK: We3vR: goto utLqf; lfo66: if ($model) { goto MtQQW; } goto CTk5c; SnSvw: $model = FundsFinanceContributes::get($ffcId); goto lfo66; cHJHB: MtQQW: goto R8V04; Ry_Al: } public function deleteFinanceContribute($ffcId) { goto UUfF3; UUfF3: $model = FundsFinanceContributes::get($ffcId); goto t_K1H; oCK6R: return true; goto YessD; wo9JN: $model->delete(); goto wh630; NoAQh: $taxes = FundsFinanceTaxes::all(["\146\146\143\137\x69\144" => $ffcId]); goto xaP2h; wh630: BJhrZ: goto NoAQh; WkfHu: Smbdg: goto oCK6R; t_K1H: if (!$model) { goto BJhrZ; } goto wo9JN; xaP2h: foreach ($taxes as $tax) { $tax->delete(); NpgeV: } goto WkfHu; YessD: } public function loadFinanceFees($fundId) { goto gExkz; EcqIK: foreach ($records as &$record) { $totalAmount += $record["\141\x6d\x6f\x75\156\164"]; mVpni: } goto LUo4G; D0ccr: $totalAmount = 0.0; goto EcqIK; gExkz: $records = Db::table("\x66\x75\156\x64\163\137\x66\151\x6e\x61\x6e\143\145\x5f\146\145\145\163")->where("\x66\x75\156\144\x5f\151\x64", $fundId)->order("\146\x66\146\137\151\x64\x20\144\145\163\x63")->field(true)->select(); goto D0ccr; Rx5GV: return ["\164\157\x74\x61\x6c" => count($records), "\x72\x6f\167\x73" => $records, "\x66\x6f\x6f\x74\145\x72" => [["\146\x66\x66\x5f\x69\x64" => 0, "\142\x65\154\x6f\x6e\x67\x5f\x69\156\164\x65\162\x76\141\154" => "\346\x80\273\350\xae\xa1", "\141\155\157\x75\x6e\164" => $totalAmount]]]; goto llf6W; LUo4G: kiduf: goto Rx5GV; llf6W: } public function getFinanceFeeInfos($fffId) { goto B4B_b; InAGY: return false; goto NONkR; NONkR: O4KbP: goto Mv1zD; B4B_b: $infos = Db::table("\x66\165\156\x64\163\x5f\146\151\x6e\x61\x6e\143\x65\x5f\146\145\145\x73")->where("\x66\x66\x66\137\x69\x64", $fffId)->field(true)->find(); goto bHg10; bHg10: if ($infos) { goto O4KbP; } goto InAGY; Mv1zD: return $infos; goto O41HU; O41HU: } public function addFinanceFee($fundId, $infos) { goto Q2me1; v3c8F: $datas["\x66\x75\x6e\x64\x5f\x69\x64"] = $fundId; goto CUYRa; eC_Aj: $model->data($datas); goto YYnr7; lfYqk: $datas["\145\x6e\144\x5f\144\141\164\x65"] = !emptyInArray($infos, "\145\x6e\144\137\x64\x61\164\x65") ? $infos["\x65\x6e\144\x5f\144\x61\164\x65"] : Defs::DEFAULT_DB_DATE_VALUE; goto xyb0t; iafRT: $datas["\x74\151\164\x6c\145"] = !emptyInArray($infos, "\x74\151\x74\x6c\145") ? $infos["\x74\151\x74\x6c\145"] : ''; goto PV0p4; Q2me1: $datas = []; goto v3c8F; juYii: $fffId = $model->fff_id; goto PadBs; PV0p4: $datas["\141\155\157\x75\156\x74"] = !emptyInArray($infos, "\x61\155\157\165\x6e\x74") ? $infos["\x61\x6d\x6f\x75\x6e\x74"] : 0; goto IkxpM; YYnr7: $model->save(); goto juYii; IkxpM: $datas["\x66\162\157\155\137\144\141\x74\145"] = !emptyInArray($infos, "\146\162\x6f\x6d\137\144\141\164\x65") ? $infos["\x66\x72\157\155\137\144\x61\164\x65"] : Defs::DEFAULT_DB_DATE_VALUE; goto lfYqk; xyb0t: $model = model("\x46\x75\x6e\144\163\x46\151\x6e\x61\156\x63\145\x46\145\x65\x73"); goto eC_Aj; PadBs: return true; goto j_5Ef; CUYRa: $datas["\x74\171\160\145"] = !emptyInArray($infos, "\x74\171\160\x65") ? $infos["\164\x79\160\145"] : Defs::FUND_FEE_OTHER_TYPE; goto iafRT; j_5Ef: } public function editFinanceFee($fffId, $infos) { goto rrfTl; KF1zb: yMSdZ: goto BrfIn; RGveT: $datas["\x74\x69\x74\154\145"] = !emptyInArray($infos, "\164\151\x74\x6c\145") ? $infos["\164\151\164\154\145"] : ''; goto VZpO6; b7Mkb: $model->save(); goto aut7V; aut7V: return true; goto jXIpJ; X4bQ6: if ($model) { goto yMSdZ; } goto qASWq; mFADB: $datas["\x65\156\144\137\144\x61\x74\145"] = !emptyInArray($infos, "\145\156\x64\x5f\x64\x61\x74\145") ? $infos["\x65\156\x64\137\x64\x61\x74\145"] : Defs::DEFAULT_DB_DATE_VALUE; goto Jgpmb; RhYmK: $datas["\x66\x72\157\155\x5f\144\x61\x74\x65"] = !emptyInArray($infos, "\146\162\157\155\137\x64\x61\x74\145") ? $infos["\x66\x72\157\x6d\x5f\x64\x61\x74\145"] : Defs::DEFAULT_DB_DATE_VALUE; goto mFADB; Jgpmb: $model = FundsFinanceFees::get($fffId); goto X4bQ6; BrfIn: $model->data($datas); goto b7Mkb; qASWq: return false; goto KF1zb; rrfTl: $datas = []; goto j9Zwu; j9Zwu: $datas["\x74\x79\x70\x65"] = !emptyInArray($infos, "\164\x79\x70\145") ? $infos["\x74\171\160\145"] : Defs::FUND_FEE_OTHER_TYPE; goto RGveT; VZpO6: $datas["\x61\x6d\x6f\x75\156\x74"] = !emptyInArray($infos, "\141\155\157\165\x6e\x74") ? $infos["\x61\155\x6f\x75\x6e\x74"] : 0; goto RhYmK; jXIpJ: } public function deleteFinanceFee($fffId) { goto x8rQn; u7eFH: return false; goto dknZR; LwYHm: if ($model) { goto YvU3W; } goto u7eFH; dknZR: YvU3W: goto y1hQJ; LaAoJ: return true; goto VMMQO; x8rQn: $model = FundsFinanceFees::get($fffId); goto LwYHm; y1hQJ: $model->delete(); goto LaAoJ; VMMQO: } public function loadFinanceIncomes($fundId) { goto Hq8NW; Hq8NW: $records = Db::table("\146\165\x6e\x64\x73\137\x66\x69\156\141\x6e\x63\x65\x5f\151\x6e\143\157\155\145\163")->where("\146\165\x6e\x64\137\151\x64", $fundId)->order("\x66\x66\x69\x5f\x69\144\40\x64\x65\163\x63")->field(true)->select(); goto l71zK; HqxGV: return ["\164\x6f\164\x61\x6c" => count($records), "\162\157\x77\163" => $records, "\146\x6f\x6f\164\x65\162" => [["\x66\146\151\x5f\x69\x64" => 0, "\144\141\164\x65" => "\xe6\x80\273\xe8\xae\xa1", "\x61\155\x6f\165\156\164" => $totalAmount]]]; goto TM_hg; dXGdG: foreach ($records as &$record) { $totalAmount += $record["\141\155\157\165\x6e\164"]; qcxh8: } goto onmD5; l71zK: $totalAmount = 0.0; goto dXGdG; onmD5: Nx9ss: goto HqxGV; TM_hg: } public function getFinanceIncomeInfos($ffiId) { goto wQPJ_; ydbxz: bshxS: goto gSt5d; AVoUZ: if ($infos) { goto bshxS; } goto ly_do; XfHlr: $infos["\164\141\170"] = $taxes; goto e6rGh; gSt5d: $taxes = Db::table("\146\x75\156\x64\x73\137\146\151\x6e\x61\156\x63\145\137\x74\x61\x78\x65\x73")->where("\146\x66\151\137\x69\x64", $ffiId)->column("\141\155\x6f\165\156\x74", "\x74\171\160\145"); goto WI1nb; ly_do: return false; goto ydbxz; WI1nb: if ($taxes) { goto INO2U; } goto Q0nPv; wQPJ_: $infos = Db::table("\x66\x75\156\144\163\x5f\146\151\156\x61\x6e\x63\145\x5f\151\x6e\143\157\155\x65\x73")->where("\146\146\151\x5f\x69\144", $ffiId)->field(true)->find(); goto AVoUZ; FrHbE: INO2U: goto XfHlr; Q0nPv: $taxes = []; goto FrHbE; e6rGh: return $infos; goto jVA6g; jVA6g: } public function addFinanceIncome($fundId, $infos) { goto r_AsV; ijuqw: $datas["\144\x61\164\145"] = !emptyInArray($infos, "\144\x61\164\145") ? $infos["\x64\141\x74\145"] : Defs::DEFAULT_DB_DATE_VALUE; goto LGdmE; gWGRf: $ffiId = $model->ffi_id; goto q7gTx; BolrC: $datas["\141\x6d\x6f\165\x6e\164"] = $infos["\x61\x6d\157\165\156\164"] ?? 0; goto PgeOT; bIyLw: vNzRj: goto ijuqw; OowkG: if (is_array($infos["\x74\141\x78\137\x74\171\160\145"])) { goto zzZ1J; } goto mdwqP; J0szs: return $ffiId; goto hamx3; mDpH_: $datas["\164\151\164\x6c\145"] = !emptyInArray($infos, "\164\151\164\x6c\145") ? $infos["\164\151\164\154\x65"] : ''; goto BolrC; XBJTI: $model->data($datas); goto HThIQ; Lv__n: $datas["\x74\171\x70\x65"] = !emptyInArray($infos, "\x74\171\x70\145") ? $infos["\x74\x79\x70\x65"] : Defs::FUND_INCOME_OTHER_TYPE; goto mDpH_; PgeOT: if (!(round($datas["\141\155\x6f\x75\156\164"], 2) <= 0)) { goto vNzRj; } goto B6rcS; pGYjj: Z4BiE: goto OowkG; B6rcS: return false; goto bIyLw; GRI8G: zzZ1J: goto pvzsj; q7gTx: if (!emptyInArray($infos, "\164\x61\170\137\x74\171\x70\145")) { goto Z4BiE; } goto q70Tv; vlwGh: oCDx3: goto J0szs; r_AsV: $datas = []; goto NdZUB; NdZUB: $datas["\x66\x75\156\144\x5f\x69\x64"] = $fundId; goto Lv__n; mdwqP: return $ffiId; goto GRI8G; pvzsj: foreach ($infos["\164\x61\x78\137\164\x79\160\x65"] as $taxType => $taxValue) { goto qhPfF; ODwo4: Db::table("\x66\165\x6e\x64\163\x5f\x66\151\x6e\x61\156\x63\145\137\x74\141\x78\x65\163")->insert(["\x66\165\156\x64\x5f\151\144" => $fundId, "\x74\x69\x74\154\145" => $datas["\x74\151\164\154\145"] . "\x2d" . Defs::$fundTaxTypeDefs[$taxType], "\x61\x6d\157\165\x6e\164" => $amount, "\x74\171\x70\145" => $taxType, "\x64\141\164\145" => $datas["\x64\141\x74\145"], "\x66\146\x69\137\x69\144" => $ffiId]); goto eNOze; qhPfF: $amount = round($infos["\x74\141\170"][$taxType], 2); goto Lzvv4; OpRgU: at9UQ: goto ODwo4; eNOze: qM596: goto HMpma; t9LdO: goto qM596; goto OpRgU; Lzvv4: if (!($amount == 0.0)) { goto at9UQ; } goto t9LdO; HMpma: } goto vlwGh; LGdmE: $model = model("\x46\165\x6e\x64\x73\106\x69\156\x61\x6e\x63\145\x49\156\143\157\x6d\145\x73"); goto XBJTI; q70Tv: return $ffiId; goto pGYjj; HThIQ: $model->save(); goto gWGRf; hamx3: } public function editFinanceIncome($ffiId, $infos) { goto Qv5dK; Vzp1R: KW1DG: goto ZUQGF; RMMdK: $ffi->type = $infos["\x74\x79\160\145"] ?? $ffi->type; goto XCWuP; Jt4wE: if (!emptyInArray($infos, "\164\141\x78\x5f\164\x79\x70\145")) { goto Nvy9X; } goto UEqvz; QZzNE: if (is_array($infos["\164\x61\170\x5f\164\x79\160\145"])) { goto KW1DG; } goto hnlV4; MMQK7: if ($ffi) { goto gnMzu; } goto WuMmj; K0PaT: Y1FNc: goto RWRaK; RWRaK: foreach ($infos["\x74\141\170\137\164\x79\160\x65"] as $taxType => $taxValue) { goto GRviN; S5buW: $fft_id = Db::table("\146\165\x6e\144\163\x5f\146\x69\156\141\156\143\x65\x5f\x74\x61\170\145\x73")->where(["\x66\x66\151\x5f\151\144" => $ffiId, "\x74\171\160\145" => $taxType])->value("\146\146\x74\137\151\x64"); goto OFWUe; Wow2n: Db::table("\146\165\x6e\144\x73\x5f\x66\151\156\141\156\x63\145\x5f\x74\x61\x78\145\x73")->where("\146\146\164\x5f\x69\x64", $fft_id)->update($taxDatas); goto xiuPM; kKqDM: $taxDatas = ["\146\165\156\144\x5f\x69\144" => $fundId, "\x74\151\x74\x6c\x65" => $ffi->title . "\x2d" . Defs::$fundTaxTypeDefs[$taxType], "\141\x6d\157\x75\x6e\164" => $amount, "\x74\171\160\x65" => $taxType, "\144\141\164\145" => $ffi->date, "\146\146\x69\137\x69\x64" => $ffiId]; goto S5buW; Wt1g5: l2rG9: goto Wow2n; tQBCI: WqCJ_: goto kKqDM; GRviN: $amount = round($infos["\x74\141\x78"][$taxType], 2); goto xYEF3; LD4oM: goto vhOXW; goto Wt1g5; ru8kl: Db::table("\146\x75\x6e\144\x73\x5f\x66\151\156\141\x6e\143\145\x5f\164\x61\170\x65\163")->insert($taxDatas); goto LD4oM; gOnbP: goto K3iQ4; goto tQBCI; xYEF3: if (!($amount == 0.0)) { goto WqCJ_; } goto gOnbP; xiuPM: vhOXW: goto ydnZV; ydnZV: K3iQ4: goto ONaSy; OFWUe: if ($fft_id) { goto l2rG9; } goto ru8kl; ONaSy: } goto MJWFy; fDiiK: foreach ($existTaxTypes as $v) { goto K7Vwf; Tkse1: GOJl4: goto NahcC; vpkjY: eqnmn: goto Tkse1; K7Vwf: if (isset($infos["\164\141\x78\137\164\x79\x70\145"][$v["\x74\x79\x70\x65"]])) { goto eqnmn; } goto qBqVn; qBqVn: Db::table("\146\165\x6e\x64\163\137\146\x69\x6e\141\156\143\145\x5f\164\141\x78\145\x73")->where("\146\x66\164\137\x69\144", $v["\x66\x66\x74\137\x69\x64"])->delete(); goto vpkjY; NahcC: } goto Ooynt; UEqvz: $infos["\164\141\x78\137\x74\171\160\x65"] = []; goto SZc5y; wJNXk: $ffi->save(); goto Jt4wE; RUMzG: $ffi->date = $infos["\x64\141\164\x65"] ?? $ffi->date; goto wJNXk; S6qW0: if ($fundId) { goto Y1FNc; } goto vDTUo; Qv5dK: $ffi = FundsFinanceIncomes::get($ffiId); goto MMQK7; CG2df: gnMzu: goto RMMdK; vDTUo: return false; goto K0PaT; Ooynt: f1DOy: goto jJR8X; BNLQN: $ffi->amount = $infos["\x61\155\157\x75\x6e\x74"] ?? $ffi->amount; goto RUMzG; MJWFy: i_q8H: goto ZHUoy; jJR8X: return true; goto bTyfk; ZUQGF: $fundId = Db::table("\146\165\156\144\163\x5f\x66\151\156\x61\156\x63\145\137\x69\156\143\157\x6d\145\x73")->where("\146\146\151\x5f\x69\144", $ffiId)->value("\146\165\156\x64\x5f\x69\144"); goto S6qW0; ZHUoy: $existTaxTypes = Db::table("\146\x75\156\144\x73\137\146\x69\156\141\x6e\143\x65\137\x74\141\170\x65\x73")->field("\146\146\x74\137\x69\144\54\x74\x79\x70\145")->where("\146\x66\x69\x5f\151\144", $ffiId)->select(); goto fDiiK; XCWuP: $ffi->title = $infos["\164\x69\x74\154\145"] ?? $ffi->title; goto BNLQN; WuMmj: return false; goto CG2df; SZc5y: Nvy9X: goto QZzNE; hnlV4: return false; goto Vzp1R; bTyfk: } public function deleteFinanceIncome($ffiId) { goto EIBh3; cKpRa: return true; goto ACrgf; VLLDs: KRQ4U: goto XdSez; YgPsX: $taxes = FundsFinanceTaxes::all(["\146\146\151\137\x69\144" => $ffiId]); goto X9S4S; EIBh3: $model = FundsFinanceIncomes::get($ffiId); goto BqlEQ; XdSez: $this->deleteFinanceFee($ffiId); goto cKpRa; BqlEQ: $model->delete(); goto YgPsX; X9S4S: foreach ($taxes as $tax) { $tax->delete(); w1a1B: } goto VLLDs; ACrgf: } public function loadFinanceTaxes($fundId) { goto ZaRRH; OzTTL: return ["\x74\x6f\x74\141\x6c" => count($records), "\x72\157\167\x73" => $records, "\x66\157\x6f\x74\145\x72" => [["\146\146\164\x5f\x69\144" => 0, "\164\151\164\154\x65" => "\346\200\xbb\350\xae\241", "\141\155\x6f\165\156\x74" => $totalAmount]]]; goto Bmq0e; IWMbv: $totalAmount = 0.0; goto YII5l; ZaRRH: $records = Db::table("\x66\165\x6e\x64\163\x5f\x66\x69\156\141\x6e\x63\145\137\164\x61\170\145\x73")->where("\146\165\156\x64\137\151\144", $fundId)->order("\x66\146\x74\x5f\151\144\x20\x64\x65\x73\143")->field(true)->select(); goto IWMbv; YII5l: foreach ($records as &$record) { $totalAmount += $record["\x61\x6d\x6f\x75\x6e\x74"]; ehzRO: } goto wDTBi; wDTBi: N54IK: goto OzTTL; Bmq0e: } public function getFinanceTaxInfos($fftId) { goto Njbvv; hK0eu: return false; goto pQ7_e; pQ7_e: RGQ3e: goto sstj_; Njbvv: $infos = Db::table("\146\x75\156\x64\163\x5f\146\151\156\x61\x6e\x63\x65\137\164\141\170\145\x73")->where("\146\x66\x74\137\x69\x64", $fftId)->field(true)->find(); goto zGV3b; zGV3b: if ($infos) { goto RGQ3e; } goto hK0eu; sstj_: return $infos; goto rs326; rs326: } public function addFinanceTax($fundId, $infos) { goto sMmyY; H0OZb: $model->data($datas); goto WxhbC; sM3d4: $model = model("\106\165\156\x64\x73\106\x69\156\x61\x6e\143\145\x54\x61\170\x65\163"); goto H0OZb; pFZsI: $fftId = $model->fft_id; goto bNDnD; WxhbC: $model->save(); goto pFZsI; StQ8q: $datas["\141\155\x6f\x75\x6e\x74"] = !emptyInArray($infos, "\x61\x6d\157\x75\156\164") ? $infos["\x61\155\157\x75\156\164"] : 0; goto v3a1W; sMmyY: $datas = []; goto fM1mK; v3UVf: $datas["\x64\x61\x74\145"] = !emptyInArray($infos, "\144\x61\164\145") ? $infos["\x64\x61\x74\x65"] : Defs::DEFAULT_DB_DATE_VALUE; goto XBOwn; fM1mK: $datas["\146\x75\x6e\x64\x5f\151\144"] = $fundId; goto K0xNL; bNDnD: return true; goto iFXAJ; XBOwn: $datas["\x66\x66\151\x5f\x69\x64"] = !emptyInArray($infos, "\146\x66\151\137\x69\144") ? $infos["\146\x66\151\137\x69\x64"] : 0; goto sM3d4; K0xNL: $datas["\164\x79\160\x65"] = !emptyInArray($infos, "\x74\x79\160\145") ? $infos["\164\x79\x70\x65"] : Defs::FUND_TAX_VALUEADD_TYPE; goto StQ8q; v3a1W: $datas["\x74\151\164\x6c\x65"] = !emptyInArray($infos, "\164\x69\164\x6c\145") ? $infos["\x74\x69\x74\x6c\145"] : ''; goto v3UVf; iFXAJ: } public function editFinanceTax($fftId, $infos) { goto eFtud; KW3Jn: return false; goto wBlnp; CnjJ5: $model->save(); goto M_ujc; Lb895: $datas["\x74\x79\x70\145"] = !emptyInArray($infos, "\x74\x79\x70\145") ? $infos["\x74\171\160\x65"] : Defs::FUND_TAX_VALUEADD_TYPE; goto vlVQ4; B7Z3F: $datas["\144\x61\164\145"] = !emptyInArray($infos, "\x64\x61\x74\145") ? $infos["\144\x61\x74\145"] : Defs::DEFAULT_DB_DATE_VALUE; goto EdW3m; wBlnp: d6SvF: goto Kk6jq; M_ujc: return true; goto Roim8; eFtud: $model = FundsFinanceTaxes::get($fftId); goto jEUA8; vlVQ4: $datas["\x61\155\157\x75\156\x74"] = !emptyInArray($infos, "\x61\155\157\165\x6e\x74") ? $infos["\x61\x6d\x6f\165\x6e\164"] : 0; goto ggq3x; EdW3m: $model->data($datas); goto CnjJ5; jEUA8: if ($model) { goto d6SvF; } goto KW3Jn; ggq3x: $datas["\164\x69\x74\154\x65"] = !emptyInArray($infos, "\x74\151\x74\154\145") ? $infos["\164\151\164\x6c\145"] : ''; goto B7Z3F; Kk6jq: $datas = []; goto Lb895; Roim8: } public function deleteFinanceTax($fftId) { goto Z3Hut; bmlgn: $model->delete(); goto mvJ6J; vBWAw: return false; goto COCCh; mvJ6J: return true; goto osIDB; COCCh: KLzm7: goto bmlgn; TnXrc: if ($model) { goto KLzm7; } goto vBWAw; Z3Hut: $model = FundsFinanceTaxes::get($fftId); goto TnXrc; osIDB: } public function loadFinanceEnterprises($fundId) { goto HDnA8; T1plK: return ["\x74\x6f\x74\141\x6c" => count($records), "\x72\x6f\x77\163" => $records, "\x66\x6f\x6f\x74\x65\162" => [["\x66\146\x65\x5f\151\x64" => 0, "\x74\151\164\x6c\x65" => "\346\200\xbb\xe8\xae\xa1", "\x61\x6d\157\165\x6e\x74" => $totalAmount]]]; goto NSjQd; mKcZ0: foreach ($records as &$record) { $totalAmount += $record["\x61\155\157\165\156\x74"]; oq21y: } goto uuyFu; tqi_8: $totalAmount = 0.0; goto mKcZ0; uuyFu: LoPuK: goto T1plK; HDnA8: $records = Db::table("\146\165\x6e\x64\x73\137\x66\x69\156\x61\x6e\143\x65\x5f\x65\156\164\145\162\160\162\x69\x73\145\163")->alias("\106\x46\105")->join("\145\x6e\x74\145\162\x70\162\x69\163\x65\x73\x20\105", "\x46\x46\105\x2e\145\156\x74\x65\162\160\x72\x69\163\x65\x5f\x69\x64\x3d\x45\56\151\x64", "\114\x45\x46\124")->where("\146\165\156\x64\137\x69\x64", $fundId)->order("\x66\146\145\x5f\151\144\x20\144\145\x73\x63")->field("\x46\106\105\x2e\x2a\x2c\105\56\156\141\155\x65")->select(); goto tqi_8; NSjQd: } public function getEnterpriseStatisticByFund($fundId) { goto yVX37; LDdfc: return ["\x63\157\x75\156\x74" => $count, "\141\155\157\165\156\x74" => $amount]; goto bhIat; Wx36h: w7ON5: goto LDdfc; yVX37: $count = 0; goto emg6L; emg6L: $records = Db::table("\146\x75\x6e\x64\x73\137\145\x6e\x74\x65\162\160\162\151\x73\145\x73")->where("\x66\x75\x6e\x64\137\x69\144", $fundId)->order("\151\144\40\x64\x65\x73\143")->field(true)->select(); goto qOGei; qOGei: $count = count($records); goto lF9ja; OkhwZ: $amount = 0; goto Wx36h; ko3im: $amount = Db::table("\x66\165\156\x64\163\137\x66\x69\x6e\141\156\x63\145\x5f\145\156\164\145\x72\160\x72\x69\163\145\163")->where("\146\165\x6e\144\x5f\151\x64", $fundId)->order("\146\x66\x65\137\x69\x64\40\x64\145\x73\x63")->field(true)->sum("\x61\x6d\157\165\156\164"); goto o5Zm1; lF9ja: $amount = 0; goto ko3im; o5Zm1: if (!($amount === null)) { goto w7ON5; } goto OkhwZ; bhIat: } public function getFinanceEnterpriseInfos($ffeId) { goto p2Tx6; WZsFV: return $infos; goto ptHbI; TnCpE: if ($infos) { goto ggV24; } goto mchzz; YvQQj: ggV24: goto WZsFV; mchzz: return false; goto YvQQj; p2Tx6: $infos = Db::table("\x66\x75\x6e\144\x73\137\146\151\x6e\141\156\143\145\137\x65\x6e\x74\x65\x72\160\162\x69\163\145\163")->where("\146\146\x65\x5f\x69\x64", $ffeId)->field(true)->find(); goto TnCpE; ptHbI: } public function addFinanceEnterprise($fundId, $infos) { goto Lym36; H16Nh: return $ffeId; goto NPwsT; vonN2: $datas["\145\x6e\x74\x65\162\160\162\x69\x73\x65\137\x69\144"] = !emptyInArray($infos, "\145\156\164\145\x72\160\162\x69\x73\145\x5f\151\x64") ? $infos["\x65\156\164\145\x72\160\x72\151\163\145\137\x69\144"] : 0; goto JTL7r; IbV3p: $model->save(); goto GbYNG; gIFLM: $model->data($datas); goto IbV3p; CR67I: $datas["\x74\x69\164\154\x65"] = !emptyInArray($infos, "\164\151\164\154\x65") ? $infos["\164\151\x74\154\145"] : ''; goto yz9UV; GbYNG: $ffeId = $model->ffe_id; goto H16Nh; Lym36: $datas = []; goto QXtxg; AQLxm: $datas["\x61\x6d\x6f\165\x6e\x74"] = !emptyInArray($infos, "\x61\x6d\x6f\x75\x6e\x74") ? $infos["\x61\155\x6f\165\156\x74"] : 0; goto CR67I; JTL7r: $model = model("\106\x75\x6e\144\x73\106\151\156\141\x6e\x63\145\x45\x6e\x74\145\162\160\162\151\x73\145\163"); goto gIFLM; QXtxg: $datas["\146\165\x6e\144\137\x69\144"] = $fundId; goto AQLxm; yz9UV: $datas["\144\141\x74\145"] = !emptyInArray($infos, "\144\141\164\145") ? $infos["\144\141\164\x65"] : Defs::DEFAULT_DB_DATE_VALUE; goto vonN2; NPwsT: } public function editFinanceEnterprise($ffeId, $infos) { goto CP9pf; KO7aF: $datas["\141\155\x6f\165\x6e\x74"] = !emptyInArray($infos, "\141\155\x6f\x75\156\164") ? $infos["\x61\155\157\165\156\164"] : 0; goto Hue3E; YRxpN: $model = FundsFinanceEnterprises::get($ffeId); goto Sb1PA; CP9pf: $datas = []; goto KO7aF; QMq76: $datas["\145\x6e\x74\x65\162\x70\x72\x69\x73\145\x5f\151\144"] = !emptyInArray($infos, "\x65\x6e\164\145\x72\x70\x72\x69\163\x65\137\x69\144") ? $infos["\145\156\x74\145\x72\160\162\151\163\x65\137\x69\144"] : 0; goto YRxpN; Sb1PA: if ($model) { goto nbquj; } goto RCjeS; epN3i: $model->data($datas); goto juIMH; Hue3E: $datas["\164\151\x74\x6c\x65"] = !emptyInArray($infos, "\x74\x69\164\154\x65") ? $infos["\x74\151\164\x6c\x65"] : ''; goto yYOzi; juIMH: $model->save(); goto hV7td; RCjeS: return false; goto Gt0j_; yYOzi: $datas["\x64\x61\164\145"] = !emptyInArray($infos, "\144\141\x74\145") ? $infos["\x64\141\164\145"] : Defs::DEFAULT_DB_DATE_VALUE; goto QMq76; hV7td: return true; goto cc4Nu; Gt0j_: nbquj: goto epN3i; cc4Nu: } public function deleteFinanceEnterprise($ffeId) { goto ZTESI; tsSXK: return false; goto z2Dwu; DmSV1: $model->delete(); goto Ji3pF; z2Dwu: wNFtK: goto DmSV1; nG8iE: if ($model) { goto wNFtK; } goto tsSXK; ZTESI: $model = FundsFinanceEnterprises::get($ffeId); goto nG8iE; Ji3pF: return true; goto Kh0D2; Kh0D2: } }
