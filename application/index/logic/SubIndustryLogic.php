<?php
 namespace app\index\logic; use app\index\service\RequestContext; use think\Db; class SubIndustryLogic extends Base { const TABLE = "\x73\x75\x62\137\151\156\144\165\163\x74\162\x79"; public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $order = "\151\x64\x20\x64\x65\x73\143") { goto xfWKo; bAQup: if (!empty($count)) { goto RAqKf; } goto RABCf; oylz5: if (empty($search["\x6e\141\155\x65"])) { goto ny6vL; } goto tuPD0; CR5_5: RAqKf: goto CzNAN; tuPD0: $where["\x6e\x61\x6d\x65"] = ["\x6c\x69\153\145", "\x25" . $search["\156\x61\155\x65"] . "\x25"]; goto RMGUh; RMGUh: ny6vL: goto SKYY3; CzNAN: $items = Db::table(self::TABLE)->where($where)->page($page, $rows)->order($order)->select(); goto xVt93; xVt93: return ["\164\x6f\164\141\x6c" => $count, "\162\157\x77\x73" => $items]; goto R8Je2; RABCf: return []; goto CR5_5; SKYY3: $count = Db::table(self::TABLE)->where($where)->count(); goto bAQup; xfWKo: $where = ["\144\145\154\145\x74\145\x64" => 0]; goto oylz5; R8Je2: } public function getRow($id) { goto d3DMX; e7ekd: JYpxe: goto b1_Gf; d3DMX: if (!empty($id)) { goto JYpxe; } goto GMb7c; GMb7c: return false; goto e7ekd; b1_Gf: $row = Db::table(self::TABLE)->where("\151\144", $id)->find(); goto izxiz; izxiz: return $row; goto BzUur; BzUur: } public function getDefaultRow() { return ["\x6e\141\x6d\145" => '', "\x64\x65\x73\143\x72\x69\160\164\151\x6f\156" => '', "\151\x64" => 0, "\143\157\x72\x65\x5f\144\141\164\141" => '']; } public function saveRow($id, $data) { goto yGKw4; l9HH4: T5N3d: goto lyLB7; L_VGj: unset($data["\145\156\164\145\x72\160\x72\151\163\145\x73"]); goto sTq7q; gW3Mv: if (!$id) { goto BOKBp; } goto jc7nw; w9cn_: if (!empty($id)) { goto CX8qN; } goto YzjRQ; WJY48: cpbQf: goto gW3Mv; VuXmA: $id = Db::table(self::TABLE)->insert($data, false, true); goto w9cn_; eWQG6: BOKBp: goto TgIx2; jc7nw: Db::table(self::TABLE)->where("\151\x64", $id)->update($data); goto B6u1a; sTq7q: $data["\143\162\x65\x61\x74\x65\144\x5f\142\x79"] = RequestContext::I()->loginUserId; goto VuXmA; z2l_C: if (!$eids) { goto T5N3d; } goto rOyQY; aaFLs: exception("\350\xa1\214\xe4\xb8\x9a\345\x90\215\347\247\xb0\xe4\270\215\350\203\275\xe4\270\272\xe7\251\272"); goto WJY48; TgIx2: $eids = $data["\145\x6e\x74\145\162\160\x72\151\163\145\163"]; goto L_VGj; B6u1a: return $id; goto eWQG6; YzjRQ: exception("\xe6\267\xbb\345\x8a\240\xe5\xa4\261\350\264\245"); goto WgoBd; lyLB7: return $id; goto Cj4fu; WgoBd: CX8qN: goto z2l_C; rOyQY: $this->addEnterprises($id, $eids); goto l9HH4; yGKw4: if (!(isset($data["\x6e\141\x6d\145"]) && empty($data["\x6e\141\x6d\x65"]))) { goto cpbQf; } goto aaFLs; Cj4fu: } public function addEnterprises($iid, $eids) { goto YZRwl; YZRwl: $eids = explode("\x2c", $eids); goto O5urD; O5urD: foreach ($eids as $eid) { goto El4NH; El4NH: if (!Db::table("\x73\165\x62\137\x69\x6e\144\x75\163\164\x72\171\137\145\x6e\x74\145\x72\x70\x72\x69\163\145")->where(["\x69\x69\x64" => $iid, "\145\151\x64" => $eid])->value("\x69\x64")) { goto qHJXo; } goto A2pUr; LW0uR: DYjDn: goto EsRAm; vAAVp: qHJXo: goto Aq5Ba; A2pUr: goto DYjDn; goto vAAVp; Aq5Ba: Db::table("\x73\165\x62\137\x69\156\144\x75\163\x74\x72\171\x5f\x65\156\x74\145\162\160\162\151\163\x65")->insert(["\151\x69\144" => $iid, "\145\x69\x64" => $eid]); goto LW0uR; EsRAm: } goto pY4dz; pY4dz: PmHMf: goto dFA00; dFA00: } public function replaceEnterpriseSubIndustry($eid, $iid_old, $iid_new) { goto ESSJG; ggjya: $this->addEnterprises($iid_new, $eid); goto WZcNO; Ec732: Db::table("\x73\x75\142\x5f\151\x6e\x64\165\x73\x74\162\171\x5f\x65\156\164\x65\162\x70\162\151\163\145")->where(["\x69\151\x64" => $iid_old, "\145\151\144" => $eid])->delete(); goto NYLdL; ESSJG: if (!($iid_old && $iid_old != $iid_new)) { goto Oo1Ug; } goto Ec732; NYLdL: Oo1Ug: goto ggjya; WZcNO: } public function delete($id) { $result = Db::table(self::TABLE)->where("\x69\144", $id)->setField("\x64\x65\x6c\x65\x74\145\x64", 1); return $result > 0 ? true : false; } public function loadChainTreeDatas($subIndustryId, $parentId = 0, $appendNum = false) { goto q6Iip; q6Iip: $treeDatas = []; goto an2hO; an2hO: $treeDatas[] = $this->loadChainTreeDataRecursively($subIndustryId, $parentId, $appendNum); goto DREpV; DREpV: return $treeDatas; goto f0q7f; f0q7f: } protected function loadChainTreeDataRecursively($subIndustryId, $parentId = 0, $appendNum = false) { goto IhlwA; Ahea3: X2FQw: goto DUNtL; gxacF: OTupa: goto p8H00; ipPSU: goto T_KYu; goto gxacF; d8FPC: S5eaP: goto fAaye; IhlwA: if ($parentId == 0) { goto OTupa; } goto Iw8VC; h78uX: XPxTQ: goto yb3gE; hHfCx: NL0S0: goto IwTd5; fk2Dg: T_KYu: goto MSUQa; sUsgH: $text = $nodeText; goto MsF5N; dxLzJ: foreach ($chains as $key => $chain) { goto M00Gn; obicw: $treeNodeDatas["\143\150\151\154\144\162\145\x6e"][] = $childNodeDatas; goto bOuAE; g30yd: if (!$childNodeDatas) { goto i6bnC; } goto obicw; AkwAY: $childNodeDatas = $this->loadChainTreeDataRecursively($subIndustryId, $id, $appendNum); goto g30yd; bOuAE: i6bnC: goto xr7s5; M00Gn: $id = (int) $chain["\x69\144"]; goto AkwAY; xr7s5: UVsgX: goto sBetb; sBetb: } goto h78uX; KYS2W: BvdTm: goto bwkED; MsF5N: goto NL0S0; goto WYvIQ; FROXs: $text = $nodeText . "\x5b" . $memberCount . "\x5d"; goto hHfCx; WYvIQ: Iogdj: goto FROXs; p8H00: if ($appendNum) { goto BvdTm; } goto fNhZ3; yb3gE: return $treeNodeDatas; goto E1z9H; Iw8VC: $nodeText = Db::table("\163\165\x62\137\151\156\x64\165\x73\164\162\x79\137\143\x68\x61\x69\156")->where(["\x73\x75\142\x5f\151\x6e\x64\x75\x73\164\x72\171\x5f\x69\144" => $subIndustryId, "\x69\144" => $parentId])->value("\x6e\141\x6d\145"); goto AFV42; MSUQa: $chains = Db::table("\163\x75\x62\x5f\151\156\x64\165\x73\164\x72\x79\x5f\143\x68\x61\151\x6e")->where(["\x73\x75\x62\x5f\x69\x6e\144\165\x73\164\162\171\x5f\x69\144" => $subIndustryId, "\x70\x61\162\x65\x6e\164\x5f\x69\144" => $parentId])->field("\151\144\54\x6e\x61\155\145\54\160\x61\x72\x65\156\x74\137\x69\144")->select(); goto dxLzJ; jSKGH: if ($appendNum) { goto Iogdj; } goto sUsgH; Oq46w: goto S5eaP; goto KYS2W; fAaye: $treeNodeDatas = ["\151\144" => 0, "\x74\145\170\x74" => $text, "\x69\x63\x6f\x6e\103\x6c\163" => "\x66\141\40\146\141\55\143\150\141\151\x6e", "\163\x74\141\164\145" => "\157\160\145\156", "\x63\150\151\154\144\162\145\156" => [], "\145\x6e\x74\145\x72\x70\162\151\x73\x65\137\143\157\165\x6e\164" => 0]; goto fk2Dg; z_4fc: return null; goto Ahea3; IwTd5: $treeNodeDatas = ["\151\144" => $parentId, "\164\x65\170\x74" => $text, "\x69\143\157\156\103\154\x73" => "\146\141\x20\x66\x61\x2d\x63\151\162\x63\x6c\145", "\x73\164\141\164\145" => "\x6f\x70\x65\156", "\x63\x68\x69\154\144\x72\x65\156" => [], "\145\156\x74\145\x72\x70\162\x69\x73\145\x5f\143\157\x75\156\164" => $memberCount]; goto ipPSU; AFV42: if (!($nodeText === null)) { goto X2FQw; } goto z_4fc; DUNtL: $memberCount = Db::table("\x73\x75\142\x5f\151\156\144\x75\163\x74\162\171\137\143\150\141\x69\x6e\137\145\156\x74\145\x72\160\162\x69\163\x65")->where("\x73\165\142\x5f\x69\x6e\144\165\163\x74\x72\171\137\143\150\x61\151\156\x5f\151\x64", $parentId)->count(); goto jSKGH; fNhZ3: $text = "\xe4\272\xa7\344\xb8\x9a\351\x93\276"; goto Oq46w; bwkED: $text = "\344\xba\247\344\xb8\232\xe9\223\276"; goto d8FPC; E1z9H: } public function addChain($subIndustryId, $name, $parentId) { goto Tnv1w; xy5cA: return $result != 1 ? false : true; goto eAwYZ; Tnv1w: $data = array("\156\x61\x6d\x65" => $name, "\160\x61\162\145\x6e\x74\137\x69\x64" => $parentId, "\163\x75\142\x5f\x69\156\x64\x75\x73\164\162\171\x5f\x69\x64" => $subIndustryId); goto FHpNi; FHpNi: $result = Db::table("\163\165\142\x5f\x69\x6e\144\x75\x73\x74\x72\171\137\143\x68\x61\151\x6e")->insert($data); goto xy5cA; eAwYZ: } public function updateChain($subIndustryChainId, $name) { goto VXNE8; eOmkf: return true; goto Z4Fop; VXNE8: $data = array("\156\x61\155\x65" => $name); goto DtDLX; DtDLX: Db::table("\x73\x75\142\137\151\156\144\x75\163\164\162\171\x5f\x63\150\141\x69\156")->where("\151\144", $subIndustryChainId)->update($data); goto eOmkf; Z4Fop: } public function deleteChain($subIndustryChainId) { goto ALwaz; VanLO: if (!Db::table("\x73\x75\142\137\x69\x6e\144\165\163\164\x72\171\x5f\x63\150\x61\151\x6e")->where("\x70\141\x72\145\x6e\x74\x5f\151\144", $subIndustryChainId)->find()) { goto vBwSK; } goto DIlES; LJ4QB: if (!Db::table("\x73\x75\142\x5f\151\x6e\x64\165\163\164\x72\171\x5f\x63\150\x61\x69\x6e\x5f\x65\156\164\x65\x72\160\x72\151\163\x65")->where("\x73\165\x62\137\x69\x6e\144\x75\163\164\162\171\137\143\150\141\x69\x6e\137\x69\144", $subIndustryChainId)->find()) { goto TXDjr; } goto UUMYQ; e7YRg: $result = Db::table("\x73\x75\x62\x5f\151\x6e\144\x75\x73\164\x72\171\137\143\x68\141\x69\x6e")->where("\151\x64", $subIndustryChainId)->delete(); goto O8X3l; YiQAH: rR9mZ: goto VanLO; vjZ5e: return false; goto YiQAH; O8X3l: return $result != 1 ? false : true; goto pU320; SpM1q: TXDjr: goto e7YRg; algL3: vBwSK: goto LJ4QB; ALwaz: if (!($subIndustryChainId == 0)) { goto rR9mZ; } goto vjZ5e; DIlES: return false; goto algL3; UUMYQ: return false; goto SpM1q; pU320: } }
