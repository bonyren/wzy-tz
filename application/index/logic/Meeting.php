<?php
 namespace app\index\logic; use think\Db; use think\Request; class Meeting extends Base { const TABLE = "\155\145\145\164\151\156\147\163"; const MEETING_NORMAL_TYPE = 1; const MEETING_DD_OPEN_TYPE = 2; const MEETING_INVEST_DECISION_TYPE = 3; const TYPES = array(self::MEETING_NORMAL_TYPE => array("\x69\144" => self::MEETING_NORMAL_TYPE, "\154\x61\x62\x65\x6c" => "\xe6\231\256\351\x80\x9a\xe4\274\x9a\350\256\256"), self::MEETING_DD_OPEN_TYPE => array("\x69\144" => self::MEETING_DD_OPEN_TYPE, "\154\141\x62\145\x6c" => "\xe7\xab\213\xe9\xa1\xb9\344\274\x9a\xe8\xae\256"), self::MEETING_INVEST_DECISION_TYPE => array("\x69\x64" => self::MEETING_INVEST_DECISION_TYPE, "\x6c\141\142\145\x6c" => "\346\212\225\345\x86\xb3\344\xbc\232\xe8\256\256")); const TYPES_HTML = array(self::MEETING_NORMAL_TYPE => "\x3c\163\x70\141\x6e\40\143\154\141\x73\163\x3d\x22\x62\x61\x64\x67\x65\x20\x62\141\144\147\145\55\x6c\151\x67\150\164\42\x3e\xe6\231\256\351\x80\232\344\xbc\232\xe8\256\256\74\x2f\x73\x70\141\156\76", self::MEETING_DD_OPEN_TYPE => "\x3c\x73\x70\141\156\40\143\154\141\163\x73\x3d\42\x62\x61\x64\147\x65\40\142\x61\x64\147\145\x2d\151\156\146\x6f\42\x3e\xe7\253\x8b\xe9\241\271\344\xbc\232\xe8\256\256\74\57\163\160\141\156\76", self::MEETING_INVEST_DECISION_TYPE => "\x3c\163\x70\x61\x6e\40\143\154\x61\163\x73\75\42\x62\x61\144\147\145\40\142\x61\x64\x67\x65\x2d\x70\x72\151\155\141\x72\x79\x22\76\346\x8a\x95\345\206\xb3\xe4\274\x9a\350\256\256\x3c\x2f\163\x70\141\x6e\76"); const STATUS_PLANNED = 1; const STATUS_IN_PROGRESS = 2; const STATUS_ENDED_PASS = 3; const STATUS_ENDED_REJECT = 4; const STATUS_DEFS = array(self::STATUS_PLANNED => "\344\274\232\xe8\256\256\345\217\221\350\xb5\xb7", self::STATUS_IN_PROGRESS => "\344\274\232\350\xae\256\xe8\277\x9b\350\xa1\214\xe4\270\xad", self::STATUS_ENDED_PASS => "\344\274\232\350\xae\xae\xe9\x80\232\xe8\xbf\x87", self::STATUS_ENDED_REJECT => "\xe4\274\x9a\350\xae\256\344\xb8\215\351\200\232\xe8\277\207"); const STATUS_HTML = array(self::STATUS_PLANNED => "\x3c\163\160\x61\x6e\40\x63\x6c\x61\x73\x73\75\42\x62\x61\144\147\x65\x20\142\141\144\147\145\55\x73\x65\143\x6f\156\144\x61\162\x79\42\x3e\344\274\232\350\xae\256\xe5\217\x91\xe8\265\267\74\x2f\x73\x70\141\x6e\x3e", self::STATUS_IN_PROGRESS => "\74\163\x70\x61\156\x20\x63\x6c\141\163\163\75\x22\x62\x61\x64\x67\x65\40\x62\x61\144\x67\x65\x2d\x70\162\x69\x6d\141\x72\171\x22\76\344\xbc\232\xe8\xae\256\xe8\277\x9b\350\xa1\214\xe4\xb8\255\x3c\57\x73\x70\x61\x6e\76", self::STATUS_ENDED_PASS => "\74\163\160\x61\x6e\40\x63\154\x61\163\163\x3d\42\142\141\x64\x67\145\x20\x62\x61\144\x67\x65\x2d\163\165\143\x63\145\163\163\42\x3e\344\274\232\xe8\256\256\xe9\200\x9a\xe8\277\x87\74\57\x73\x70\x61\156\76", self::STATUS_ENDED_REJECT => "\x3c\x73\x70\141\156\40\x63\154\141\x73\163\x3d\42\x62\x61\x64\147\x65\40\x62\x61\x64\x67\145\x2d\x64\x61\x6e\147\x65\162\42\76\344\xbc\232\350\xae\xae\xe4\xb8\x8d\xe9\200\x9a\350\xbf\207\74\x2f\163\x70\x61\x6e\x3e"); public static function getTypes($type_id = 0) { goto cfGdd; SsPCC: Yq9vM: goto eWYYI; RBV5k: return $types[$type_id]; goto SsPCC; BhvqM: if (!$type_id) { goto Yq9vM; } goto RBV5k; cfGdd: $types = self::TYPES; goto BhvqM; eWYYI: return $types; goto CG82D; CG82D: } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = "\x6d\x2e\x69\x64", $order = "\x64\x65\163\143", $filters = array()) { goto mUrwB; kECQS: A2_sg: goto K1XGr; RkYUa: $where["\155\x2e\163\164\141\164\x75\x73"] = ["\151\156", $filters["\x73\164\x61\164\x75\x73"]]; goto kECQS; d_ljj: if (!empty($count)) { goto BhhB2; } goto uD4My; kN5PP: YyExt: goto H29yN; X5si7: if (empty($filters["\x73\164\141\x74\165\x73"])) { goto A2_sg; } goto RkYUa; ca757: if (empty($search["\x73\164\141\164\165\x73"])) { goto uwy0_; } goto t6uDJ; D649B: SWnTS: goto X5si7; p05Mr: $items = $model_c->where($where)->field($field)->page($page, $rows)->order($order)->select(); goto pyeIO; Q3lOJ: $order = $sort . "\40" . $order; goto ufxhb; QnryK: if (empty($search["\164\171\160\145"])) { goto YyExt; } goto WyoB6; zjdrI: uwy0_: goto QnryK; WNpww: $field = "\155\x2e\52"; goto Q3lOJ; ouC_p: $where["\155\56\x72\x65\154\141\164\145\x5f\151\144"] = $search["\x72\x65\x6c\141\164\145\137\151\x64"]; goto orNyX; t6uDJ: $where["\x6d\56\163\x74\x61\x74\165\163"] = $search["\x73\164\141\164\165\x73"]; goto zjdrI; WyoB6: $where["\155\56\x74\171\x70\145"] = $search["\x74\171\160\x65"]; goto kN5PP; orNyX: suiBk: goto p1K13; uD4My: return []; goto D1M4w; D1M4w: BhhB2: goto p05Mr; HDODi: fWTaF: goto PsPyg; p1K13: if (empty($filters["\x72\145\x6c\141\x74\x65\137\151\x64"])) { goto SWnTS; } goto pB0eG; H29yN: if (empty($search["\162\145\x6c\141\x74\145\137\151\x64"])) { goto suiBk; } goto ouC_p; ufxhb: $where = ["\155\56\144\x65\154\x65\x74\145\x64" => 0]; goto ca757; PsPyg: return ["\x74\157\164\x61\x6c" => $count, "\162\157\167\x73" => $items]; goto I6i1w; pyeIO: foreach ($items as &$item) { $item["\162\145\154\x61\x74\x65\137\x69\164\x65\x6d"] = Db::table("\145\x6e\164\x65\x72\160\x72\151\163\x65\163")->where("\151\144", $item["\162\145\154\141\164\145\x5f\x69\x64"])->value("\156\x61\x6d\145"); GXIsX: } goto HDODi; wM4i3: $count = $model->where($where)->count(); goto d_ljj; K1XGr: $model_c = clone $model; goto wM4i3; pB0eG: $where["\x6d\56\x72\x65\x6c\141\x74\145\x5f\151\144"] = $filters["\162\145\154\141\164\x65\137\x69\x64"]; goto D649B; mUrwB: $model = Db::table(self::TABLE)->alias("\x6d"); goto WNpww; I6i1w: } public function getMeeting($meeting_id, $meeting = null) { goto yrLKR; UuD3o: return []; goto hR94N; hR94N: x8ZA8: goto it2jg; l7slq: V7qdF: goto apOr2; it2jg: if (!empty($meeting)) { goto qqdjs; } goto nHkgu; nHkgu: $meeting = Db::table(self::TABLE)->where("\x69\x64", $meeting_id)->find(); goto PhnqQ; apOr2: return $meeting; goto vucfw; yrLKR: if (!empty($meeting_id)) { goto x8ZA8; } goto UuD3o; X105s: if (!empty($meeting)) { goto V7qdF; } goto v2T9y; PhnqQ: qqdjs: goto X105s; v2T9y: return []; goto l7slq; vucfw: } public function getRelatedMeeting($type, $relate_id) { goto JvB5V; vh0Bj: goto VXh0t; goto W4h0R; JvB5V: $meeting = Db::table(self::TABLE)->where(["\164\x79\x70\145" => $type, "\162\x65\x6c\141\x74\x65\137\x69\144" => $relate_id, "\x64\145\154\x65\164\145\144" => 0])->order("\x69\x64\40\104\x45\x53\x43")->find(); goto u2W5r; xL1Wk: $meeting = $this->getMeeting($meeting["\151\x64"], $meeting); goto vh0Bj; NukFI: return $meeting; goto mGwU9; hzRjw: VXh0t: goto NukFI; HaTSJ: $meeting = []; goto hzRjw; u2W5r: if (empty($meeting)) { goto IyvhB; } goto xL1Wk; W4h0R: IyvhB: goto HaTSJ; mGwU9: } public function saveMeeting($id, $data, $callback = null) { goto G9qqA; FjiQZ: goto Plp6b; goto a_xcy; L9pWl: Db::table(self::TABLE)->where("\x69\x64", $id)->update($data); goto FjiQZ; gaaef: C0oDq: goto C53Ym; sjCJJ: return $id; goto ujMiD; UgcVI: $data["\143\x72\145\x61\x74\x65\x64\137\142\171"] = session("\x75\163\x65\x72\x69\x64"); goto jDs7f; L22d_: if (!(!empty($callback) && is_callable($callback))) { goto enxhm; } goto OmHqs; a_xcy: eyQ_R: goto eF7qZ; eF7qZ: $data["\144\141\x74\x65\137\x63\x72\x65\141\164\x65\144"] = date("\x59\55\x6d\55\x64\40\110\x3a\x69\72\163"); goto UgcVI; VQXmo: enxhm: goto sjCJJ; G9qqA: if (!(isset($data["\x74\x69\164\154\145"]) && empty($data["\164\151\164\x6c\x65"]))) { goto C0oDq; } goto aUhjq; aUhjq: exception("\xe8\257\267\345\241\253\345\206\231\344\xbc\x9a\xe8\256\256\344\270\xbb\xe9\xa2\230"); goto gaaef; jDs7f: $id = Db::table(self::TABLE)->insertGetId($data); goto BqOkM; C53Ym: if (empty($id)) { goto eyQ_R; } goto L9pWl; OmHqs: $callback($id); goto VQXmo; BqOkM: Plp6b: goto L22d_; ujMiD: } public function feedbackMeeting($meeting_id, $data) { goto aaZog; aaZog: Db::table(self::TABLE)->where("\x69\144", $meeting_id)->update($data); goto c9g3P; jTNDy: action("\105\x6e\x74\145\x72\160\162\151\x73\x65\x73\x2f\143\157\x6d\160\154\x65\164\145\115\145\145\164\x69\x6e\x67", ["\x6d\x65\145\164\x69\x6e\147\137\x69\x64" => $meeting_id]); goto LbuCB; LbuCB: WGWAB: goto zJ_IS; c9g3P: if (!($data["\x73\x74\x61\164\x75\163"] == self::STATUS_ENDED_PASS || $data["\163\x74\x61\164\x75\x73"] == self::STATUS_ENDED_REJECT)) { goto WGWAB; } goto jTNDy; zJ_IS: } public function delete($id) { $result = Db::table(self::TABLE)->where("\x69\144", $id)->setField("\144\x65\x6c\145\x74\x65\144", 1); return $result > 0 ? true : false; } public function setProjectMeeting($data) { goto IcfJ0; wazYx: unset($data["\145\156\164\x65\162\x70\x72\x69\163\145\x5f\151\144"]); goto VRPPI; VRPPI: return Meeting::I()->saveMeeting(0, $data, function ($meeting_id) use($data) { goto XRO6O; fOK8J: BaNL2: goto IEmz1; XRO6O: if (!empty($data["\x69\x6e\x76\x65\x73\x74\x6d\x65\x6e\164\x5f\x69\x64"])) { goto BaNL2; } goto mLm4H; mLm4H: model("\105\x6e\164\145\162\x70\x72\x69\163\145\x73")->save(["\x73\164\x65\x70\x5f\163\164\141\x74\145" => 1, "\x69\163\x74\157\160" => 0], ["\151\144" => $data["\x72\x65\x6c\x61\164\x65\x5f\x69\x64"]]); goto ksPDY; cUDc2: F4D6V: goto Oe1iy; IEmz1: Db::table("\x69\x6e\x76\145\x73\164\x6d\x65\156\x74")->where("\151\144", $data["\151\156\166\145\163\x74\x6d\x65\x6e\164\x5f\x69\x64"])->setField("\155\145\x65\x74\151\x6e\x67\x5f\151\144", $meeting_id); goto cUDc2; ksPDY: goto F4D6V; goto fOK8J; Oe1iy: }); goto NsCil; FrONk: exception("\xe6\x97\240\346\x95\210\xe5\x8f\202\346\x95\260"); goto WVLVg; WVLVg: JCuXb: goto Rtx80; IcfJ0: if (!(empty($data["\x65\156\164\x65\x72\160\162\151\x73\145\x5f\151\x64"]) || empty($data["\x74\171\x70\x65"]))) { goto JCuXb; } goto FrONk; Rtx80: $data["\x72\145\154\x61\164\x65\137\x69\x64"] = $data["\145\156\164\145\x72\160\x72\151\x73\145\x5f\151\144"]; goto wazYx; NsCil: } public function updateProjectMeeting($meeting_id, $data) { goto GJIpD; uGy1R: VXvaZ: goto P3JVK; GJIpD: if (!(empty($data["\x65\x6e\164\145\162\x70\162\151\x73\145\x5f\x69\x64"]) || empty($data["\164\x79\160\145"]))) { goto VXvaZ; } goto t9Wcm; t9Wcm: exception("\xe6\227\xa0\346\225\210\345\217\202\346\225\260"); goto uGy1R; ae6OH: return Meeting::I()->saveMeeting($meeting_id, $data, function ($meeting_id) use($data) { }); goto bDeBB; P3JVK: $data["\162\145\x6c\x61\164\145\137\151\x64"] = $data["\145\156\x74\145\162\x70\162\151\x73\x65\137\151\144"]; goto FXG3I; FXG3I: unset($data["\x65\x6e\x74\145\162\x70\x72\151\163\145\x5f\151\x64"]); goto ae6OH; bDeBB: } }
