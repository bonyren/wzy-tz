<?php
 namespace app\index\logic; use think\Db; use think\Request; class Meeting extends Base { const TABLE = "\x6d\145\145\164\x69\x6e\x67\x73"; const MEETING_NORMAL_TYPE = 1; const MEETING_DD_OPEN_TYPE = 2; const MEETING_INVEST_DECISION_TYPE = 3; const TYPES = array(self::MEETING_NORMAL_TYPE => array("\151\144" => self::MEETING_NORMAL_TYPE, "\154\x61\142\x65\154" => "\346\231\xae\xe9\x80\x9a\344\274\x9a\350\256\xae"), self::MEETING_DD_OPEN_TYPE => array("\151\x64" => self::MEETING_DD_OPEN_TYPE, "\154\141\142\145\x6c" => "\xe7\xab\213\351\xa1\271\344\274\x9a\xe8\xae\xae"), self::MEETING_INVEST_DECISION_TYPE => array("\151\x64" => self::MEETING_INVEST_DECISION_TYPE, "\154\141\x62\145\154" => "\xe6\x8a\225\xe5\x86\xb3\344\274\x9a\xe8\xae\xae")); const TYPES_HTML = array(self::MEETING_NORMAL_TYPE => "\x3c\x73\x70\x61\x6e\40\x63\x6c\141\x73\163\75\x22\142\141\x64\147\145\x20\142\x61\144\x67\x65\55\154\x69\x67\150\x74\42\x3e\346\231\256\xe9\x80\x9a\344\274\232\xe8\256\256\74\x2f\x73\160\141\x6e\x3e", self::MEETING_DD_OPEN_TYPE => "\x3c\x73\160\x61\x6e\x20\x63\154\x61\x73\163\x3d\x22\x62\x61\x64\147\145\x20\x62\141\144\147\x65\x2d\x69\x6e\146\x6f\42\76\xe7\253\x8b\xe9\xa1\271\xe4\xbc\232\350\256\256\x3c\57\163\160\x61\x6e\76", self::MEETING_INVEST_DECISION_TYPE => "\x3c\163\160\x61\156\x20\x63\154\x61\163\163\75\x22\142\x61\144\147\x65\x20\x62\x61\x64\147\x65\55\x70\x72\151\x6d\141\162\x79\x22\76\346\212\225\xe5\206\xb3\344\274\232\350\xae\256\x3c\x2f\163\x70\141\156\76"); const STATUS_PLANNED = 1; const STATUS_IN_PROGRESS = 2; const STATUS_ENDED_PASS = 3; const STATUS_ENDED_REJECT = 4; const STATUS_DEFS = array(self::STATUS_PLANNED => "\344\274\232\350\xae\xae\xe5\217\221\350\xb5\267", self::STATUS_IN_PROGRESS => "\344\xbc\x9a\350\256\xae\xe8\xbf\233\350\241\x8c\xe4\xb8\xad", self::STATUS_ENDED_PASS => "\xe4\xbc\x9a\350\256\256\xe9\x80\232\350\xbf\207", self::STATUS_ENDED_REJECT => "\344\274\232\xe8\256\xae\344\xb8\x8d\351\200\x9a\xe8\xbf\207"); const STATUS_HTML = array(self::STATUS_PLANNED => "\74\x73\160\x61\x6e\40\x63\154\x61\x73\x73\x3d\42\142\141\144\x67\x65\x20\142\x61\x64\x67\x65\55\x73\x65\x63\157\156\144\x61\x72\171\x22\x3e\344\274\x9a\xe8\xae\xae\345\x8f\x91\xe8\265\267\74\57\x73\x70\141\156\76", self::STATUS_IN_PROGRESS => "\74\x73\x70\141\156\40\x63\154\141\163\163\75\x22\142\141\144\x67\145\x20\142\141\144\147\145\55\x70\162\x69\155\x61\162\171\x22\76\xe4\274\x9a\350\256\256\350\277\x9b\350\241\214\344\xb8\255\74\57\x73\160\141\x6e\76", self::STATUS_ENDED_PASS => "\x3c\163\160\x61\156\x20\x63\x6c\141\163\x73\75\x22\x62\141\144\147\145\40\x62\x61\144\147\145\55\x73\165\x63\x63\x65\163\x73\x22\76\xe4\xbc\232\350\256\256\351\x80\x9a\350\277\x87\x3c\57\163\x70\141\x6e\x3e", self::STATUS_ENDED_REJECT => "\x3c\163\x70\141\156\40\x63\154\x61\x73\x73\75\42\x62\x61\x64\147\145\x20\x62\141\144\147\145\x2d\x64\x61\156\147\x65\162\x22\x3e\xe4\274\x9a\xe8\256\xae\xe4\270\215\351\x80\232\350\xbf\x87\x3c\57\x73\x70\x61\156\76"); public static function getTypes($type_id = 0) { goto RGZ8b; Exxm7: iiKm9: goto QKkxk; QKkxk: return $types; goto swv0y; StaP3: return $types[$type_id]; goto Exxm7; RGZ8b: $types = self::TYPES; goto OiGfw; OiGfw: if (!$type_id) { goto iiKm9; } goto StaP3; swv0y: } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = "\155\x2e\151\144", $order = "\x64\145\x73\143", $filters = array()) { goto gsI9g; UyNFt: if (empty($search["\x74\x79\160\x65"])) { goto mLbLV; } goto tAo8D; mD0vX: $where = ["\155\56\144\x65\x6c\145\164\x65\x64" => 0]; goto NnhX3; BIsCQ: if (empty($search["\162\x65\x6c\x61\x74\145\x5f\x69\x64"])) { goto SVPy0; } goto uodX6; jHwXn: if (empty($filters["\163\164\141\164\x75\x73"])) { goto C7i4f; } goto bpfG9; FD8j2: return ["\164\x6f\x74\x61\154" => $count, "\x72\157\x77\x73" => $items]; goto dSrkg; FFHqO: SVPy0: goto UGk41; iH6bY: K5_7_: goto ErIEo; gp7W4: $count = $model->where($where)->count(); goto VVYiR; ErIEo: $items = $model_c->where($where)->field($field)->page($page, $rows)->order($order)->select(); goto vKeLY; UGk41: if (empty($filters["\x72\145\x6c\141\164\x65\137\x69\x64"])) { goto JP1Fr; } goto EnPsf; fXF1l: $order = $sort . "\40" . $order; goto mD0vX; aiyPy: PI13Y: goto FD8j2; NnhX3: if (empty($search["\x73\x74\x61\164\165\x73"])) { goto mZmoR; } goto eIHDL; HKKB0: mLbLV: goto BIsCQ; AN1c7: C7i4f: goto UJ0Ip; vKeLY: foreach ($items as &$item) { $item["\x72\145\x6c\141\x74\x65\137\x69\x74\145\155"] = Db::table("\x65\156\x74\145\x72\x70\x72\x69\163\x65\163")->where("\x69\144", $item["\162\145\154\x61\164\145\x5f\x69\144"])->value("\x6e\141\x6d\x65"); j0TtQ: } goto aiyPy; tlAFS: JP1Fr: goto jHwXn; P_nbY: return []; goto iH6bY; VVYiR: if (!empty($count)) { goto K5_7_; } goto P_nbY; bpfG9: $where["\155\56\163\164\141\x74\165\163"] = ["\x69\156", $filters["\163\164\141\164\x75\163"]]; goto AN1c7; uodX6: $where["\x6d\56\162\145\x6c\141\x74\x65\x5f\x69\144"] = $search["\162\145\x6c\x61\x74\x65\137\x69\144"]; goto FFHqO; UJ0Ip: $model_c = clone $model; goto gp7W4; EnPsf: $where["\155\56\x72\x65\154\141\x74\x65\137\x69\x64"] = $filters["\x72\x65\154\x61\164\x65\137\x69\144"]; goto tlAFS; eIHDL: $where["\x6d\56\163\x74\x61\x74\x75\x73"] = $search["\x73\x74\x61\164\x75\x73"]; goto su7IG; tAo8D: $where["\x6d\x2e\164\171\x70\x65"] = $search["\x74\x79\160\x65"]; goto HKKB0; smnNj: $field = "\x6d\x2e\x2a"; goto fXF1l; su7IG: mZmoR: goto UyNFt; gsI9g: $model = Db::table(self::TABLE)->alias("\155"); goto smnNj; dSrkg: } public function getMeeting($meeting_id, $meeting = null) { goto YLbFh; AwGIH: if (!empty($meeting)) { goto dBaEc; } goto Y1H92; YqoLN: return []; goto kdCEK; YLbFh: if (!empty($meeting_id)) { goto k1xpU; } goto YqoLN; HfpyC: bDkhr: goto AwGIH; HCCPH: dBaEc: goto VUOup; kdCEK: k1xpU: goto sgVh2; xmApp: $meeting = Db::table(self::TABLE)->where("\x69\144", $meeting_id)->find(); goto HfpyC; VUOup: return $meeting; goto ZAjEo; Y1H92: return []; goto HCCPH; sgVh2: if (!empty($meeting)) { goto bDkhr; } goto xmApp; ZAjEo: } public function getRelatedMeeting($type, $relate_id) { goto uLj3s; fz2gc: MRz2H: goto Enwzg; ksVQo: LgrFp: goto vRmN1; IEmMK: $meeting = $this->getMeeting($meeting["\x69\144"], $meeting); goto tmd2x; tmd2x: goto MRz2H; goto ksVQo; vRmN1: $meeting = []; goto fz2gc; HRTf3: if (empty($meeting)) { goto LgrFp; } goto IEmMK; uLj3s: $meeting = Db::table(self::TABLE)->where(["\164\171\x70\145" => $type, "\162\145\154\x61\x74\x65\x5f\x69\x64" => $relate_id, "\x64\145\154\x65\x74\x65\x64" => 0])->order("\151\144\40\104\105\x53\x43")->find(); goto HRTf3; Enwzg: return $meeting; goto sS_kM; sS_kM: } public function saveMeeting($id, $data, $callback = null) { goto PWVY4; wnwrG: $callback($id); goto BdGKy; DAD3x: gwRqc: goto oZ7wj; oZ7wj: if (empty($id)) { goto GhhV5; } goto uJydv; PWVY4: if (!(isset($data["\x74\151\x74\154\145"]) && empty($data["\164\151\x74\154\x65"]))) { goto gwRqc; } goto E_hDE; Rbobm: $data["\144\x61\164\x65\137\143\162\145\x61\x74\x65\144"] = date("\x59\x2d\x6d\x2d\x64\40\110\72\x69\72\163"); goto MUJ_4; E_hDE: exception("\350\xaf\267\345\241\xab\345\206\x99\344\xbc\232\xe8\xae\xae\344\xb8\xbb\xe9\242\230"); goto DAD3x; MUJ_4: $data["\143\x72\x65\x61\x74\x65\x64\137\x62\171"] = session("\165\x73\x65\x72\x69\x64"); goto wf3qc; oa3QD: goto xeZDw; goto W3mYm; BdGKy: exwwB: goto Xw2AG; uJydv: Db::table(self::TABLE)->where("\151\x64", $id)->update($data); goto oa3QD; W3mYm: GhhV5: goto Rbobm; Xw2AG: return $id; goto QFTcs; jj6jd: if (!(!empty($callback) && is_callable($callback))) { goto exwwB; } goto wnwrG; wf3qc: $id = Db::table(self::TABLE)->insertGetId($data); goto u9gYd; u9gYd: xeZDw: goto jj6jd; QFTcs: } public function feedbackMeeting($meeting_id, $data) { goto NEQLe; BlmYj: yqEVi: goto Ac3de; Vo2Og: action("\x45\156\x74\145\162\160\162\x69\163\x65\x73\57\x63\157\155\x70\x6c\145\x74\145\x4d\145\x65\x74\151\x6e\x67", ["\155\x65\145\x74\151\x6e\147\x5f\x69\x64" => $meeting_id]); goto BlmYj; jsv7C: if (!($data["\163\x74\x61\164\x75\x73"] == self::STATUS_ENDED_PASS || $data["\163\164\x61\164\x75\163"] == self::STATUS_ENDED_REJECT)) { goto yqEVi; } goto Vo2Og; NEQLe: Db::table(self::TABLE)->where("\x69\x64", $meeting_id)->update($data); goto jsv7C; Ac3de: } public function delete($id) { $result = Db::table(self::TABLE)->where("\151\x64", $id)->setField("\x64\x65\x6c\145\164\x65\144", 1); return $result > 0 ? true : false; } public function setProjectMeeting($data) { goto xG5e4; xG5e4: if (!(empty($data["\x65\156\164\145\162\x70\162\x69\x73\x65\137\151\144"]) || empty($data["\164\171\160\x65"]))) { goto B_wHj; } goto M3szj; QrJeU: B_wHj: goto NNqxN; ZwkRD: return Meeting::I()->saveMeeting(0, $data, function ($meeting_id) use($data) { goto sGOth; gHph2: sTnZL: goto kgLhd; ftmg2: model("\x45\156\x74\x65\x72\160\162\x69\163\145\x73")->save(["\163\x74\x65\x70\137\163\x74\x61\164\145" => 1, "\x69\163\164\x6f\160" => 0], ["\x69\x64" => $data["\162\x65\x6c\141\x74\145\x5f\x69\144"]]); goto dyA9O; sGOth: if (!empty($data["\x69\156\166\x65\163\164\155\x65\156\164\137\x69\144"])) { goto sTnZL; } goto ftmg2; dyA9O: goto y8tzO; goto gHph2; of7PM: y8tzO: goto uuYlf; kgLhd: Db::table("\x69\156\166\x65\x73\164\x6d\x65\x6e\x74")->where("\151\x64", $data["\151\156\166\x65\x73\164\155\x65\156\x74\x5f\151\x64"])->setField("\x6d\x65\x65\x74\151\156\147\x5f\151\x64", $meeting_id); goto of7PM; uuYlf: }); goto C5qke; UZmL1: unset($data["\x65\156\164\x65\162\x70\x72\x69\163\x65\137\x69\x64"]); goto ZwkRD; NNqxN: $data["\162\145\x6c\141\164\x65\x5f\151\144"] = $data["\145\156\164\145\162\x70\x72\x69\x73\145\137\151\x64"]; goto UZmL1; M3szj: exception("\346\x97\xa0\xe6\225\x88\345\217\202\346\x95\xb0"); goto QrJeU; C5qke: } public function updateProjectMeeting($meeting_id, $data) { goto pDoA2; qEqFD: return Meeting::I()->saveMeeting($meeting_id, $data, function ($meeting_id) use($data) { }); goto kcWJj; iUvhf: V72I0: goto kfJzK; kfJzK: $data["\162\x65\x6c\x61\164\145\x5f\151\144"] = $data["\145\x6e\164\145\x72\160\x72\x69\x73\x65\x5f\x69\144"]; goto d6tkZ; d6tkZ: unset($data["\145\x6e\x74\145\x72\160\162\x69\x73\145\137\151\x64"]); goto qEqFD; pDoA2: if (!(empty($data["\145\156\x74\x65\x72\160\162\151\163\145\x5f\151\144"]) || empty($data["\164\x79\160\145"]))) { goto V72I0; } goto l5t3C; l5t3C: exception("\346\227\240\346\225\x88\345\x8f\x82\xe6\x95\xb0"); goto iUvhf; kcWJj: } }
