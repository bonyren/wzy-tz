<?php
 namespace app\index\logic; use app\index\model\Setting; use app\index\service\RequestContext; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use think\Url; use app\index\model\Admins as AdminsModel; use app\index\logic\Defs; class Admins extends Base { protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = "\141\x64\x6d\151\x6e\x5f\x69\x64", $order = "\x64\x65\x73\143") { goto cIyCG; mSk4Z: $totalCount = Db::table("\141\x64\155\x69\156\163")->where($conditions)->count(); goto yuAaJ; BntyK: $order = "\x41\56\x61\144\155\151\x6e\x5f\x69\x64\x20" . $order; goto EHL66; EHL66: nxaXm: goto Ep7v5; yuAaJ: $records = Db::table("\141\x64\x6d\x69\x6e\163")->alias("\101")->join("\141\144\x6d\151\x6e\x5f\x72\157\x6c\145\40\x52", "\101\x2e\x72\157\x6c\x65\137\151\x64\x3d\x52\x2e\x72\x6f\154\x65\x5f\x69\x64", "\114\105\x46\124")->where($conditions)->limit($limit)->order($order)->field("\x41\x2e\x2a\x2c\122\56\x72\x6f\154\x65\137\x6e\x61\155\x65")->select(); goto pfXMN; cIyCG: $limit = ($page - 1) * $rows . "\54" . $rows; goto mqm4Y; Ep7v5: $conditions = []; goto mSk4Z; rwvrF: $order = "\101\56\x61\144\x6d\x69\x6e\x5f\x69\x64\x20\144\145\163\143"; goto N9xis; BR4_K: DeBYv: goto BntyK; N9xis: goto nxaXm; goto BR4_K; mqm4Y: if ($sort == "\141\144\155\151\156\137\x69\144") { goto DeBYv; } goto rwvrF; pfXMN: return ["\x74\157\x74\x61\x6c" => $totalCount, "\162\157\167\163" => $records]; goto gtD6Q; gtD6Q: } protected function password($password, $encrypt = '') { goto PXXEV; ALnGv: $pwd["\160\x61\x73\163\x77\157\162\144"] = md5(md5(trim($password)) . $pwd["\x65\156\x63\162\171\160\x74"]); goto aWCEN; aWCEN: return $encrypt ? $pwd["\x70\141\x73\x73\x77\x6f\162\x64"] : $pwd; goto xkDxc; pAD3O: $pwd["\145\x6e\143\162\x79\160\164"] = $encrypt ? $encrypt : \think\helper\Str::random(6); goto ALnGv; PXXEV: $pwd = array(); goto pAD3O; xkDxc: } public function addAdmin($infos) { goto fnvJv; TX5bx: $datas["\154\x6f\147\151\x6e\x5f\160\x61\x73\163\x77\x6f\162\x64"] = $passwordInfos["\x70\x61\163\x73\x77\x6f\162\x64"]; goto ETA27; xNI1M: $datas["\143\162\145\141\x74\x65\144"] = date("\x59\55\155\x2d\x64\x20\110\x3a\151\72\x73"); goto MBtwo; RRT9a: $datas["\x6c\x6f\x67\x69\x6e\x5f\x6e\x61\x6d\x65"] = isset($infos["\x6c\157\147\x69\156\x5f\x6e\x61\155\145"]) ? $infos["\x6c\157\x67\x69\156\137\x6e\x61\x6d\x65"] : ''; goto UUaQQ; iLIBY: $datas["\144\151\x73\141\142\154\x65\x64"] = isset($infos["\x64\x69\x73\x61\x62\x6c\x65\x64"]) ? (int) $infos["\144\151\163\141\142\154\x65\144"] : AdminsModel::eAdminEnableStatus; goto xNI1M; MBtwo: $datas["\x70\x61\163\163\167\x6f\162\144\137\x63\150\x61\x6e\x67\145\144"] = date("\131\x2d\x6d\55\144"); goto GQGX2; ZnO25: $datas = []; goto RRT9a; ETA27: $datas["\x6c\157\x67\151\156\137\x65\156\143\162\171\x70\x74"] = $passwordInfos["\145\x6e\143\x72\x79\160\164"]; goto xcBAm; GZ7nP: $datas["\x73\165\x70\145\162\x5f\x75\x73\145\162"] = isset($infos["\x73\165\x70\145\162\137\165\163\x65\x72"]) ? (int) $infos["\x73\165\x70\145\x72\x5f\x75\x73\145\x72"] : AdminsModel::eAdminCommonRole; goto iLIBY; d7Dp_: $datas["\162\x65\141\154\156\x61\155\x65"] = isset($infos["\x72\145\x61\154\156\141\155\145"]) ? $infos["\162\x65\x61\x6c\156\141\x6d\145"] : ''; goto FCu2t; dXNyq: $adminsModel->save($datas); goto azNPg; FCu2t: $datas["\145\x6d\141\151\154"] = isset($infos["\x65\x6d\x61\x69\x6c"]) ? $infos["\x65\x6d\141\x69\154"] : ''; goto GZ7nP; GQGX2: $passwordInfos = $this->password($datas["\x6c\x6f\x67\x69\x6e\x5f\160\x61\163\163\167\x6f\162\144"]); goto TX5bx; azNPg: return true; goto wAIK8; UUaQQ: $datas["\154\x6f\x67\x69\156\137\x70\x61\x73\163\167\157\x72\x64"] = isset($infos["\x6c\157\147\151\156\x5f\160\x61\x73\x73\x77\157\162\144"]) ? $infos["\154\x6f\147\x69\x6e\137\160\x61\x73\163\167\157\x72\x64"] : ''; goto d7Dp_; xcBAm: $datas["\x72\157\154\145\x5f\151\x64"] = isset($infos["\163\165\x70\x65\x72\x5f\165\x73\145\x72"]) ? 0 : (int) $infos["\162\157\x6c\x65\x5f\151\x64"]; goto dXNyq; fnvJv: $adminsModel = new AdminsModel(); goto ZnO25; wAIK8: } public function editAdmin($adminId, $infos) { goto rtfdI; liA4M: $datas = []; goto AqZhZ; RXyBT: $datas["\163\x75\x70\145\x72\x5f\165\163\x65\x72"] = isset($infos["\163\x75\x70\x65\x72\x5f\165\x73\145\x72"]) ? (int) $infos["\x73\x75\160\145\162\137\x75\x73\145\162"] : AdminsModel::eAdminCommonRole; goto mGmhL; AqZhZ: $datas["\x6c\157\147\x69\x6e\x5f\156\141\x6d\145"] = isset($infos["\x6c\x6f\147\151\x6e\137\x6e\141\155\145"]) ? $infos["\x6c\157\147\x69\156\x5f\x6e\141\155\145"] : ''; goto Vx9SJ; XUuuq: $adminsModel->save(); goto nh_JP; Dis8c: $datas["\x72\x65\141\x6c\156\x61\155\x65"] = isset($infos["\162\x65\x61\x6c\x6e\141\155\145"]) ? $infos["\162\145\141\x6c\156\141\155\145"] : ''; goto RXyBT; f3yJv: if ($adminsModel) { goto yl6pw; } goto tNQ1d; qznr3: yl6pw: goto liA4M; nh_JP: return true; goto DoLvx; tNQ1d: return false; goto qznr3; rtfdI: $adminsModel = AdminsModel::get($adminId); goto f3yJv; tflF9: $datas["\162\x6f\x6c\x65\137\151\x64"] = isset($infos["\163\x75\160\x65\x72\x5f\165\163\x65\162"]) ? 0 : (int) $infos["\x72\x6f\x6c\x65\x5f\x69\x64"]; goto SVvAC; Vx9SJ: $datas["\x65\x6d\141\151\154"] = isset($infos["\x65\x6d\141\x69\154"]) ? $infos["\x65\x6d\141\x69\x6c"] : ''; goto Dis8c; mGmhL: $datas["\144\x69\x73\x61\x62\x6c\145\x64"] = isset($infos["\144\151\163\141\142\x6c\145\x64"]) ? (int) $infos["\144\x69\x73\141\x62\x6c\x65\144"] : AdminsModel::eAdminEnableStatus; goto tflF9; SVvAC: $adminsModel->data($datas); goto XUuuq; DoLvx: } public function deleteAdmin($adminId) { goto cHg9q; EXeTg: return false; goto rjeYe; cHg9q: $adminsModel = AdminsModel::get($adminId); goto hHatd; rjeYe: Z7deO: goto s9YSh; hHatd: if ($adminsModel) { goto Z7deO; } goto EXeTg; s9YSh: $adminsModel->delete(); goto vyR2l; vyR2l: return true; goto uBspK; uBspK: } public function changeAdminPwd($adminId, $infos) { goto DWAST; ZWoxd: $passwordInfos = $this->password($newPassword); goto YNTTj; JSROV: return true; goto kqyos; ZdfIi: return false; goto cibKp; YNTTj: $datas["\x6c\x6f\x67\151\x6e\137\x70\x61\x73\x73\167\x6f\x72\144"] = $passwordInfos["\x70\x61\163\x73\167\x6f\162\144"]; goto VNXz3; pinI8: $adminsModel->save($datas); goto JSROV; VNXz3: $datas["\154\157\x67\x69\x6e\x5f\145\x6e\143\x72\171\160\164"] = $passwordInfos["\x65\x6e\x63\162\171\x70\164"]; goto pinI8; cibKp: AU6ke: goto pDPfJ; DWAST: $adminsModel = AdminsModel::get($adminId); goto vr6YS; vr6YS: if ($adminsModel) { goto AU6ke; } goto ZdfIi; OrCKe: $datas = []; goto ZWoxd; pDPfJ: $newPassword = isset($infos["\x6c\157\x67\x69\156\x5f\x70\x61\163\x73\x77\x6f\x72\x64"]) ? $infos["\x6c\x6f\x67\151\156\x5f\x70\141\x73\163\x77\157\162\144"] : ''; goto OrCKe; kqyos: } public function getAdminInfos($adminId) { $adminsModel = AdminsModel::get($adminId); return $adminsModel; } public function login($username, $password) { goto Sy34U; HJlxr: a0MyY: goto ASiQF; Jqnym: NcM5k: goto O807s; UmTgM: return false; goto Jqnym; aLWLE: Session::set("\165\x73\145\162\x69\x64", $adminsModel->admin_id); goto DEXry; MlOs2: return false; goto HJlxr; DEXry: Session::set("\165\x73\x65\162\x6e\x61\155\145", $adminsModel->login_name); goto nqFFw; Q_Zpc: Session::set("\165\x73\145\x72\x72\x6f\154\145\151\x64", $adminsModel->role_id); goto eN4qo; O807s: $encryptPassword = $this->password($password, $adminsModel->login_encrypt); goto JXlI6; ftzHN: $loginLogsLogic = \app\index\logic\LoginLogs::newObj(); goto yZYnB; ovYT8: Session::set("\154\x61\163\x74\x6c\x6f\x67\x69\x6e\164\151\x6d\145", time()); goto zbGJc; Sy34U: $adminsModel = AdminsModel::get(["\x6c\157\147\x69\156\137\x6e\141\155\145" => $username]); goto wCsUo; yZYnB: $loginLogsLogic->add($adminsModel->login_name, $adminsModel->admin_id, \app\index\logic\LoginLogs::LOGIN_USER_ADMIN_TYPE, truncateString(request()->header("\x75\x73\145\x72\55\141\147\x65\x6e\x74"), 100), request()->ip()); goto bEgWD; ASiQF: if (!($adminsModel->disabled != AdminsModel::eAdminEnableStatus)) { goto NcM5k; } goto UmTgM; s9_PQ: return false; goto Fxtpa; JXlI6: if (!($encryptPassword != $adminsModel->login_password)) { goto a34Eo; } goto s9_PQ; Fxtpa: a34Eo: goto aLWLE; wCsUo: if ($adminsModel) { goto a0MyY; } goto MlOs2; zbGJc: Session::set("\154\141\163\x74\x6c\x6f\x67\151\156\151\160", request()->ip()); goto ftzHN; eN4qo: Session::set("\163\165\160\x65\x72\137\165\x73\145\162", $adminsModel->super_user == AdminsModel::eAdminSuperRole); goto ovYT8; nqFFw: Session::set("\x72\x65\x61\x6c\x6e\141\155\145", $adminsModel->realname); goto Q_Zpc; bEgWD: return $adminsModel; goto UUh3c; UUh3c: } public function logout() { Session::clear(); } public function modifyAdminPwd($adminId, $oldPassword, $newPassword) { goto lyeaN; gKELX: if ($adminsModel) { goto dDWHw; } goto Jdnp1; b0Z8J: $encryptPassword = $this->password($oldPassword, $adminsModel->login_encrypt); goto YmC6S; jgkz2: $datas["\x6c\157\x67\x69\x6e\137\x70\141\163\x73\167\x6f\x72\144"] = $passwordInfos["\x70\x61\x73\163\x77\157\x72\144"]; goto FFjRY; FFjRY: $datas["\x6c\x6f\147\151\156\x5f\145\x6e\143\x72\171\x70\164"] = $passwordInfos["\x65\156\143\x72\x79\x70\x74"]; goto ce7km; SJjVK: return true; goto P9lo8; q2FxC: iNEPH: goto U_htL; lyeaN: $adminsModel = AdminsModel::get($adminId); goto gKELX; ce7km: $adminsModel->save($datas); goto SJjVK; ZWBsS: return false; goto q2FxC; U_htL: $datas = []; goto ph0uk; Jdnp1: return false; goto ZGiyd; ph0uk: $passwordInfos = $this->password($newPassword); goto jgkz2; ZGiyd: dDWHw: goto b0Z8J; YmC6S: if (!($encryptPassword != $adminsModel->login_password)) { goto iNEPH; } goto ZWBsS; P9lo8: } public function getAdminRolePairs() { return Db::table("\x61\144\x6d\151\156\137\x72\157\x6c\145")->column("\x72\x6f\154\145\x5f\x69\144\x2c\40\x72\157\154\145\x5f\156\x61\x6d\x65"); } protected function checkIfSelectedRecursively($id) { goto oC1Uj; CQI90: if (!$roleMenu) { goto rGZLO; } goto JcC8N; bNp6K: if (!empty($subIds)) { goto wBbbG; } goto dxS6m; Jagbi: foreach ($subIds as $key => $value) { goto RN8_h; DuTOm: rAbS_: goto X9aMV; AmBoC: $result = $this->checkIfSelectedRecursively($subId); goto EncGd; RN8_h: $subId = $value["\x69\144"]; goto AmBoC; X9aMV: Eno78: goto sCbWW; r5UTb: return true; goto DuTOm; EncGd: if (!$result) { goto rAbS_; } goto r5UTb; sCbWW: } goto F1aub; oC1Uj: if (!RequestContext::I()->loginSuperUser) { goto uloPy; } goto X_F6s; Uyxlh: return false; goto zrmfo; AlWRw: wBbbG: goto Jagbi; JcC8N: return true; goto gAlgQ; F1aub: sBVIA: goto Uyxlh; ESZrP: $roleMenu = db("\x61\144\155\151\x6e\137\x72\157\x6c\145\x5f\155\145\x6e\x75")->where(array("\x72\x6f\154\x65\137\151\x64" => RequestContext::I()->loginUserRoleId, "\x6d\145\x6e\x75\x5f\x69\144" => $id))->find(); goto CQI90; gAlgQ: rGZLO: goto Cj72L; FMxhU: uloPy: goto ESZrP; dxS6m: return false; goto AlWRw; Cj72L: $subIds = db("\155\145\x6e\x75")->where(array("\x70\x69\x64" => $id))->field("\151\x64")->select(); goto bNp6K; X_F6s: return true; goto FMxhU; zrmfo: } public function loadLeftMenuRecursively($pid, $ptext, &$nodes) { goto IlVkX; X8Cwx: return; goto MI39j; MI39j: TXiM7: goto JJU8C; JJU8C: foreach ($rows as $key => $value) { goto IDV5Z; P7GV_: Y4zs0: goto iR433; n37Xa: goto Ju7cI; goto JI9lO; Y9Uul: $node["\160\x61\x72\x61\x6d\x73"] = $value["\x70\141\162\141\155\x73"]; goto z1G8o; fPR_d: $node["\165\162\154"] = url($value["\x6d"] . "\57" . $value["\143"] . "\x2f" . $value["\x61"], $value["\x70\141\162\141\155\x73"]); goto d7Gb7; pY6b0: if (!(!empty($value["\155"]) && !empty($value["\143"]) && !empty($value["\x61"]))) { goto hMsyR; } goto fPR_d; KQZU7: $node["\x63"] = $value["\143"]; goto APKsK; gJ6B_: $node = array(); goto lEtaH; BTYcd: $node["\155"] = $value["\155"]; goto KQZU7; z1G8o: $node["\157\162\x64\145\x72\137\x69\x64"] = $value["\x6f\162\x64\x65\x72\137\151\x64"]; goto Ysjog; IDV5Z: $id = $value["\151\144"]; goto khUaT; GdaE1: $node["\x69\x63\157\x6e\103\154\x73"] = $value["\151\x63\x6f\156\x5f\x63\154\x73"]; goto UKMnS; khUaT: if ($this->checkIfSelectedRecursively($id)) { goto paasW; } goto n37Xa; d7Gb7: hMsyR: goto GdaE1; lEtaH: $node["\x69\144"] = $id; goto ZBBG1; JI9lO: paasW: goto gJ6B_; CSbom: $node["\x63\150\x69\x6c\x64\x72\x65\156"] = $subNodes; goto P7GV_; vWk71: $node["\164\145\170\x74"] = $value["\156\x61\155\145"]; goto BTYcd; Ysjog: $breadcrumb = empty($ptext) ? $value["\x6e\x61\x6d\x65"] : $ptext . "\40\x26\147\x74\x3b\x20" . $value["\x6e\141\155\x65"]; goto XK21f; UKMnS: $subNodes = array(); goto xBMI5; Jucxg: Ju7cI: goto E_Ytg; xBMI5: $this->loadLeftMenuRecursively($id, $breadcrumb, $subNodes); goto rsCrJ; iR433: $nodes[] = $node; goto Jucxg; APKsK: $node["\141"] = $value["\141"]; goto Y9Uul; rsCrJ: if (empty($subNodes)) { goto Y4zs0; } goto CSbom; ZBBG1: $node["\x6e\x61\x6d\145"] = $value["\x6e\141\155\x65"]; goto vWk71; XK21f: $node["\141\x74\x74\x72\x69\x62\165\164\x65\163"] = ["\x62\162\145\141\144\x63\x72\x75\155\142" => $breadcrumb]; goto pY6b0; E_Ytg: } goto wPMS0; wR2Qa: return; goto J19Uy; Gz_4O: if (!empty($rows)) { goto TXiM7; } goto X8Cwx; wPMS0: jePxW: goto wR2Qa; IlVkX: $rows = db("\155\x65\156\165")->where(array("\x70\151\144" => $pid))->field("\151\144\x2c\x70\151\144\54\154\x65\166\145\x6c\x2c\156\x61\155\145\x2c\x69\143\x6f\x6e\137\x63\x6c\163\x2c\x6d\54\x63\x2c\x61\54\x70\x61\162\141\155\163\54\x6f\162\x64\x65\162\137\x69\144")->order("\x6f\162\x64\x65\x72\137\x69\144\40\x41\x53\x43")->select(); goto Gz_4O; J19Uy: } public function getAdminsByIds($ids) { $admins = AdminsModel::where("\141\144\x6d\151\156\x5f\x69\x64", "\151\x6e", $ids)->column("\141\x64\x6d\x69\156\137\151\144\54\x6c\x6f\147\x69\156\x5f\156\x61\x6d\x65\x2c\x72\x65\x61\x6c\x6e\x61\x6d\x65\54\145\155\141\x69\x6c", "\x61\x64\x6d\151\x6e\x5f\x69\144"); return $admins; } public function getAllUsers($index_field = "\x61\x64\155\x69\156\137\151\144") { goto ob2kF; y3u39: uKQJD: goto qr42W; qr42W: $users = AdminsModel::column("\141\144\155\151\156\x5f\x69\x64\54\154\x6f\x67\x69\156\137\x6e\x61\x6d\x65\54\x72\x65\x61\154\156\x61\x6d\145\54\145\x6d\x61\x69\x6c", "\x61\144\155\x69\x6e\137\x69\144"); goto wXAJC; ob2kF: if ($index_field == "\141\x64\x6d\x69\x6e\137\x69\x64") { goto uKQJD; } goto Ez0xm; wXAJC: cUDA6: goto rrWDj; N3py_: goto cUDA6; goto y3u39; rrWDj: return $users; goto E4IAL; Ez0xm: $users = AdminsModel::field("\x61\144\x6d\151\x6e\137\151\x64\54\x6c\157\x67\x69\156\x5f\x6e\x61\155\x65\x2c\162\145\141\x6c\x6e\141\155\145\54\145\155\141\151\154")->select(); goto N3py_; E4IAL: } }
