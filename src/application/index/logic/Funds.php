<?php
 namespace app\index\logic; use app\index\model\Setting; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs; use app\index\service\EventLogs; class Funds extends Base { const FUND_ALL_STATUS = 0; const FUND_COLLECT_STATUS = 1; const FUND_INVEST_STATUS = 2; const FUND_MANAGE_STATUS = 3; const FUND_EXIT_STATUS = 4; public static $fundStatusDefs = array(self::FUND_COLLECT_STATUS => "\345\x8b\x9f\351\x9b\x86\xe4\xb8\255", self::FUND_INVEST_STATUS => "\346\x8a\225\xe8\xb5\x84\344\xb8\255", self::FUND_MANAGE_STATUS => "\xe7\xae\xa1\347\220\206\xe4\xb8\255", self::FUND_EXIT_STATUS => "\xe5\xb7\xb2\346\263\xa8\351\224\200"); public static $fundStatusHtmlDefs = array(self::FUND_COLLECT_STATUS => "\x3c\x73\160\141\x6e\x20\x63\x6c\141\163\163\75\42\142\x61\x64\x67\x65\40\x62\141\144\x67\x65\55\160\x72\x69\x6d\141\162\x79\42\76\345\x8b\x9f\xe9\x9b\x86\xe4\270\xad\x3c\57\163\x70\x61\x6e\76", self::FUND_INVEST_STATUS => "\74\163\160\x61\x6e\40\143\x6c\141\x73\163\75\x22\x62\141\144\147\145\40\142\141\x64\x67\x65\x2d\163\145\143\157\x6e\144\141\162\x79\42\x3e\xe6\x8a\225\350\xb5\204\xe4\270\xad\74\x2f\x73\x70\141\x6e\76", self::FUND_MANAGE_STATUS => "\74\163\x70\x61\x6e\x20\143\x6c\141\163\163\75\42\142\x61\144\x67\145\40\x62\141\x64\x67\145\55\163\165\143\x63\x65\x73\x73\42\x3e\347\256\241\347\x90\x86\xe4\xb8\255\x3c\x2f\x73\160\x61\156\76", self::FUND_EXIT_STATUS => "\x3c\163\160\x61\156\40\143\x6c\x61\163\163\75\42\142\x61\144\x67\x65\x20\142\x61\144\147\145\55\x64\145\x66\x61\165\154\164\x22\x3e\xe5\xb7\262\346\263\250\xe9\x94\200\74\x2f\x73\160\141\x6e\x3e"); protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = "\146\165\x6e\144\x5f\x69\144", $order = "\x61\x73\x63", $status = \app\index\logic\Funds::FUND_ALL_STATUS) { goto RwmKh; NaUty: $records = $clone->page($page, $rows)->order($order)->field("\146\56\52")->select(); goto VU2US; wmZRx: $totalCount = $model->count(); goto Qf0x_; RwmKh: $model = Db::table("\x66\x75\x6e\x64\163")->alias("\x66"); goto dbu3q; K2QbH: return []; goto zjFZa; VGgKF: akhAQ: goto pbFrz; Xdipb: $order = "\x66\56\146\x75\x6e\144\x5f\x69\144\x20" . $order; goto H4Rqd; oHVs1: nWNTy: goto W8pyj; zjFZa: D2Jsq: goto NaUty; W8pyj: if (!(isset($search["\160\x5f\x69\x64"]) && $search["\x70\x5f\151\144"])) { goto hUx0l; } goto qMwJt; hK7Oa: $conditions["\x66\160\x2e\160\x5f\x69\144"] = $search["\x70\x5f\151\x64"]; goto CVD8G; DMwTE: $conditions["\146\56\x73\164\141\164\165\x73"] = $status; goto oHVs1; H4Rqd: AhX0V: goto U4cED; pbFrz: if (!$status) { goto nWNTy; } goto DMwTE; XHg3I: $order = "\146\x2e\x66\x75\156\144\137\151\x64\x20\x61\163\x63"; goto AXTlt; d95BS: return ["\164\157\x74\141\x6c" => $totalCount, "\162\x6f\x77\x73" => $records]; goto bd1Fn; yiTs5: $model->where($conditions); goto kUaQ1; CVD8G: hUx0l: goto yiTs5; kGXiY: kfOGs: goto Xdipb; kUaQ1: $clone = clone $model; goto wmZRx; qMwJt: $model->join("\x66\165\156\x64\163\137\x70\x61\x72\164\x6e\x65\162\x73\40\x66\160", "\146\56\146\165\x6e\144\x5f\x69\144\x3d\146\x70\x2e\x66\x75\156\144\x5f\151\144"); goto hK7Oa; AXTlt: goto AhX0V; goto kGXiY; DuH4f: $conditions["\x66\56\156\141\155\145"] = ["\154\151\153\145", "\45" . $search["\156\141\x6d\x65"] . "\x25"]; goto VGgKF; VU2US: foreach ($records as &$record) { goto vwXxV; p0WPl: if (!($status == self::FUND_INVEST_STATUS || $status == self::FUND_MANAGE_STATUS || $status == self::FUND_ALL_STATUS)) { goto kiM4B; } goto iZo2L; qgoDd: sgdhC: goto eEiIl; fp7w_: $size = $record["\163\151\172\x65"]; goto U9mBH; U9mBH: if ((float) $size) { goto etvd8; } goto xda9A; iZo2L: $size = $record["\x73\x69\x7a\145"]; goto REiXo; P5QuU: JwTrg: goto fp7w_; fWQ0U: goto JwTrg; goto TXs1h; KpAw3: $actualSize = 0.0; goto bK0sF; fyWYK: etvd8: goto udve5; N0ihP: $progressLog = Db::table("\160\x72\157\x67\162\145\163\x73\x5f\x6c\157\147\x73")->alias("\120")->join("\x61\144\155\x69\x6e\x73\40\101", "\120\x2e\141\144\155\151\x6e\x5f\151\144\x3d\101\x2e\141\144\x6d\151\156\137\151\144", "\114\105\106\x54")->where(["\120\56\x65\x78\164\145\x72\x6e\x61\154\137\151\144" => $fundId, "\120\x2e\143\x61\164\x65\x67\157\x72\171" => \app\index\logic\ProgressLogs::EVENT_LOG_FUND_MANAGE_CATEGORY])->order("\x50\x2e\155\x6f\144\x69\x66\x69\x65\144\x20\144\145\163\x63")->field("\x50\x2e\x74\x69\164\x6c\145\x2c\x20\120\x2e\145\x6e\164\162\171\54\x20\120\56\145\156\x74\145\x72\x65\x64\54\x20\x41\56\x72\145\141\x6c\156\x61\x6d\145")->find(); goto qaxWA; vwXxV: $fundId = $record["\x66\x75\156\x64\137\151\x64"]; goto Q1IaZ; Qi4Ol: $record["\160\x72\157\147\162\145\163\x73\137\154\x6f\x67"] = "\x2d"; goto fWQ0U; cFnst: if (!($actualSize === null)) { goto hz3Q6; } goto KpAw3; Jbjg7: $actualPaidAmount = 0.0; goto EsOwZ; XNARm: $record["\x61\143\164\165\x61\x6c\137\x73\x69\172\145"] = $actualSize; goto PjmKQ; qaxWA: if ($progressLog) { goto HpObW; } goto Qi4Ol; EsOwZ: IOAuU: goto SVy3A; eEiIl: $record["\x69\x6e\x76\x65\163\164\x5f\x70\x72\157\147\x72\145\x73\x73\x5f\166\x61\154\165\145"] = round($finishSize / $size * 100); goto uP_9b; udve5: $record["\x63\157\x6c\x6c\145\x63\x74\137\x70\162\157\x67\162\x65\163\x73\137\x76\x61\154\x75\145"] = round($actualSize / $size * 100); goto YXyES; YXyES: bzlS7: goto WpV_9; RC8d3: if (!($status == self::FUND_COLLECT_STATUS || $status == self::FUND_ALL_STATUS)) { goto GCWQ8; } goto N0ihP; S32eP: $record["\160\162\157\147\x72\x65\163\163\137\x6c\157\147"] = $progressLog["\164\151\164\x6c\145"] . "\x20\74\x73\x70\141\x6e\x20\143\x6c\x61\163\x73\75\42\154\x61\142\145\154\40\154\141\142\145\x6c\x2d\x70\x72\151\155\141\162\171\42\76" . $progressLog["\x72\x65\x61\154\x6e\x61\155\145"] . "\74\57\x73\160\x61\x6e\x3e\40\55\x20\74\163\x70\141\156\40\143\x6c\x61\163\163\x3d\42\142\141\x64\147\x65\40\x62\141\x64\147\145\55\163\145\143\157\156\144\x61\162\x79\x22\x3e" . $progressLog["\145\156\x74\145\162\x65\x64"] . "\74\57\163\x70\x61\156\76"; goto P5QuU; BnK5n: if ($finishSize) { goto WsJZI; } goto xQs0M; PjmKQ: $actualPaidAmount = Db::table("\x66\165\x6e\x64\x73\137\x66\151\156\141\156\x63\x65\x5f\x63\x6f\x6e\x74\162\x69\x62\x75\x74\x65\x73")->where("\146\x66\143\x5f\151\x64", "\x69\x6e", function ($query) use($fundId) { $query->table("\x66\x75\156\x64\163\x5f\160\141\x72\x74\156\x65\162\163\x5f\x70\x61\x69\144")->alias("\106\120\x50")->join("\146\165\156\x64\163\x5f\160\141\162\164\x6e\145\x72\x73\x20\106\x50", "\106\x50\120\56\x66\160\137\151\144\75\106\x50\x2e\x66\x70\137\x69\x64")->where("\106\x50\56\x66\165\x6e\x64\137\151\x64", $fundId)->field("\x46\x50\x50\56\x66\x66\143\137\x69\x64"); })->sum("\141\x6d\x6f\165\x6e\x74"); goto IURYL; bK0sF: hz3Q6: goto XNARm; uP_9b: ZmQv6: goto LkL_K; xQs0M: $finishSize = 0; goto jSzY_; t3zf7: kiM4B: goto YvGQY; REiXo: $finishSize = Db::table("\x66\x75\156\144\163\x5f\145\156\164\x65\162\x70\162\x69\163\x65\163")->alias("\x46\105")->join("\146\x75\156\x64\163\137\x66\151\156\x61\x6e\x63\145\x5f\x65\x6e\164\x65\162\160\162\151\x73\x65\163\x20\106\x46\x45", "\x46\x45\x2e\146\x66\145\x5f\151\144\75\x46\x46\x45\x2e\x66\x66\x65\137\151\144")->where(["\x46\x45\x2e\x66\165\156\144\137\151\x64" => $record["\x66\x75\156\x64\x5f\x69\x64"]])->sum("\x46\106\105\x2e\141\x6d\x6f\x75\x6e\164"); goto BnK5n; LkL_K: $record["\x69\156\x76\145\163\164\137\x73\151\172\145"] = $finishSize; goto t3zf7; TXs1h: HpObW: goto S32eP; YvGQY: bHDk3: goto A41KH; WpV_9: GCWQ8: goto p0WPl; jSzY_: WsJZI: goto OPYPd; SVy3A: $record["\141\x63\164\165\x61\x6c\x5f\x70\x61\x69\144\x5f\163\x69\x7a\145"] = $actualPaidAmount; goto RC8d3; IURYL: if ($actualPaidAmount) { goto IOAuU; } goto Jbjg7; xda9A: $record["\x63\157\154\154\145\x63\164\x5f\160\162\x6f\x67\x72\x65\163\163\137\x76\141\x6c\x75\x65"] = 0; goto hnH86; hnH86: goto bzlS7; goto fyWYK; DStdB: $record["\151\x6e\x76\145\x73\x74\x5f\160\x72\x6f\x67\162\145\x73\x73\137\x76\141\x6c\x75\145"] = 0; goto q2P3J; OPYPd: if ((float) $size) { goto sgdhC; } goto DStdB; Q1IaZ: $actualSize = Db::table("\146\x75\x6e\144\163\x5f\x70\141\x72\x74\x6e\145\162\163")->where("\x66\x75\156\144\137\x69\x64", $fundId)->sum("\141\x6d\x6f\x75\156\x74"); goto cFnst; q2P3J: goto ZmQv6; goto qgoDd; A41KH: } goto ohBBa; ohBBa: nVNvU: goto d95BS; U4cED: $conditions = []; goto e3MYr; e3MYr: if (emptyInArray($search, "\156\141\x6d\145")) { goto akhAQ; } goto DuH4f; Qf0x_: if (!empty($totalCount)) { goto D2Jsq; } goto K2QbH; dbu3q: if ($sort == "\146\x75\156\144\137\x69\144") { goto kfOGs; } goto XHg3I; bd1Fn: } public function addFund($infos) { goto gGPBm; GqlaP: $fundsModel->invest_period = !emptyInArray($infos, "\x69\x6e\166\145\163\164\x5f\x70\145\x72\x69\x6f\x64") ? $infos["\151\x6e\x76\145\x73\x74\x5f\160\145\162\x69\x6f\144"] : 0; goto pnSEZ; ctiAv: $fundsModel->exit_fee_ratio = !emptyInArray($infos, "\145\x78\151\164\x5f\x66\145\145\x5f\162\x61\x74\151\157") ? $infos["\145\x78\x69\x74\137\x66\145\x65\x5f\162\x61\x74\x69\157"] : 0.0; goto r2yqf; EcNym: $fundsModel->partnership_start_date = !emptyInArray($infos, "\160\x61\x72\164\156\145\x72\x73\x68\151\160\x5f\163\x74\x61\x72\164\137\144\x61\x74\145") ? $infos["\160\x61\162\164\x6e\x65\162\163\x68\151\x70\137\163\x74\141\x72\x74\x5f\x64\x61\164\x65"] : Defs::DEFAULT_DB_DATETIME_VALUE; goto GJyE2; xYbUb: $fundsModel->establish_date = !emptyInArray($infos, "\145\x73\x74\141\142\x6c\151\x73\x68\x5f\144\x61\x74\x65") ? $infos["\145\x73\x74\x61\x62\154\x69\x73\150\x5f\144\141\x74\x65"] : Defs::DEFAULT_DB_DATETIME_VALUE; goto tWspn; I7YlN: $fundsModel->alias = !emptyInArray($infos, "\x61\x6c\151\141\x73") ? $infos["\141\x6c\151\x61\x73"] : ''; goto RK3_s; ygVOj: $fundsModel->name = !emptyInArray($infos, "\x6e\x61\155\145") ? $infos["\x6e\x61\x6d\145"] : ''; goto I7YlN; GJyE2: $fundsModel->partnership_end_date = !emptyInArray($infos, "\160\x61\x72\x74\x6e\145\x72\163\x68\x69\x70\137\145\x6e\144\137\144\141\x74\145") ? $infos["\160\x61\x72\x74\156\145\x72\x73\x68\x69\x70\x5f\x65\156\x64\137\144\141\x74\x65"] : Defs::DEFAULT_DB_DATETIME_VALUE; goto xYbUb; RK3_s: $fundsModel->code = !emptyInArray($infos, "\143\157\144\145") ? $infos["\143\157\144\x65"] : ''; goto xJcFQ; gGPBm: $fundsModel = model("\106\165\x6e\144\x73"); goto ygVOj; YkXiq: $fundsModel->size = !emptyInArray($infos, "\x73\x69\172\x65") ? $infos["\x73\151\x7a\x65"] : 0.0; goto EcNym; qbtZi: $newFundId = $fundsModel->fund_id; goto eIMbu; r2yqf: $fundsModel->extend_period = !emptyInArray($infos, "\145\x78\164\x65\156\144\x5f\160\x65\162\151\x6f\144") ? $infos["\145\170\164\x65\x6e\x64\137\x70\x65\x72\x69\157\x64"] : 0; goto rRfIt; tWspn: $fundsModel->over_date = !emptyInArray($infos, "\x6f\166\x65\x72\x5f\144\x61\x74\x65") ? $infos["\157\x76\145\162\x5f\144\x61\x74\145"] : Defs::DEFAULT_DB_DATETIME_VALUE; goto GqlaP; DhAvk: $fundsModel->exit_period = !emptyInArray($infos, "\x65\170\x69\x74\x5f\x70\145\x72\x69\x6f\144") ? $infos["\145\170\151\x74\x5f\160\145\x72\151\157\x64"] : 0; goto ctiAv; pnSEZ: $fundsModel->invest_fee_ratio = !emptyInArray($infos, "\x69\156\166\145\163\x74\x5f\x66\x65\x65\x5f\x72\x61\x74\x69\x6f") ? $infos["\x69\x6e\x76\145\x73\x74\x5f\146\x65\145\x5f\162\141\164\151\x6f"] : 0.0; goto DhAvk; hupyP: $fundsModel->save(); goto qbtZi; xJcFQ: $fundsModel->reg_place = !emptyInArray($infos, "\x72\x65\147\x5f\x70\154\141\x63\x65") ? $infos["\x72\145\147\x5f\x70\x6c\x61\x63\x65"] : ''; goto YkXiq; eIMbu: EventLogs::recordFund($newFundId, "\346\x96\xb0\345\242\x9e"); goto t4uF9; rRfIt: $fundsModel->status = !emptyInArray($infos, "\x73\x74\141\x74\x75\x73") ? $infos["\163\x74\x61\x74\x75\163"] : self::FUND_COLLECT_STATUS; goto hupyP; t4uF9: return true; goto u9zjm; u9zjm: } public function editFund($fundId, $infos) { goto WWAvr; gN0ED: $fundsModel->partnership_start_date = !emptyInArray($infos, "\160\x61\x72\x74\x6e\x65\162\163\150\x69\x70\137\163\164\x61\162\164\x5f\144\141\x74\x65") ? $infos["\160\141\x72\x74\156\x65\x72\163\150\x69\x70\137\163\x74\141\162\164\x5f\144\141\x74\x65"] : Defs::DEFAULT_DB_DATETIME_VALUE; goto cK81Z; igWsk: $fundsModel->code = !emptyInArray($infos, "\x63\157\144\145") ? $infos["\143\157\144\145"] : ''; goto wYIAY; lRmAR: $fundsModel->status = !emptyInArray($infos, "\163\x74\141\x74\165\x73") ? $infos["\163\x74\141\164\165\163"] : self::FUND_COLLECT_STATUS; goto RPJtf; wYIAY: $fundsModel->reg_place = !emptyInArray($infos, "\x72\x65\147\x5f\160\154\141\143\x65") ? $infos["\162\x65\x67\137\160\x6c\x61\143\145"] : ''; goto amjTy; zL6yP: $fundsModel->over_date = !emptyInArray($infos, "\157\x76\x65\x72\137\144\x61\x74\x65") ? $infos["\157\166\145\162\x5f\x64\141\164\145"] : Defs::DEFAULT_DB_DATETIME_VALUE; goto VqCLa; GGEdS: exception("\346\227\240\346\xb3\x95\xe6\x89\xbe\xe5\210\xb0\xe8\xaf\xa5\xe5\x9f\xba\xe9\x87\221"); goto v0VYl; WWAvr: $fundsModel = \app\index\model\Funds::get($fundId); goto Imxws; TXJWq: $fundsModel->alias = !emptyInArray($infos, "\141\154\x69\141\x73") ? $infos["\x61\x6c\x69\x61\x73"] : ''; goto igWsk; qqVny: $fundsModel->invest_fee_ratio = !emptyInArray($infos, "\151\156\x76\x65\163\x74\x5f\146\x65\x65\137\x72\141\164\x69\157") ? $infos["\151\x6e\x76\145\x73\164\137\146\x65\145\137\x72\x61\164\151\157"] : 0.0; goto b3Xjt; etFiL: EventLogs::recordFund($fundId, "\344\xbf\256\xe6\224\271"); goto NI45W; RPJtf: $fundsModel->save(); goto etFiL; v0VYl: return; goto vQ22l; VqCLa: $fundsModel->invest_period = !emptyInArray($infos, "\x69\x6e\x76\145\163\164\137\160\x65\x72\x69\x6f\x64") ? $infos["\x69\156\166\145\x73\x74\137\160\x65\162\x69\157\144"] : 0; goto qqVny; dxojc: $fundsModel->name = !emptyInArray($infos, "\x6e\141\155\145") ? $infos["\156\x61\155\145"] : ''; goto TXJWq; UIbu3: $fundsModel->extend_period = !emptyInArray($infos, "\145\x78\x74\x65\x6e\144\137\x70\x65\x72\x69\157\144") ? $infos["\x65\x78\x74\145\x6e\x64\137\x70\145\162\x69\157\144"] : 0; goto lRmAR; b3Xjt: $fundsModel->exit_period = !emptyInArray($infos, "\145\x78\151\164\137\x70\x65\162\151\157\x64") ? $infos["\x65\x78\151\164\137\160\x65\162\151\x6f\x64"] : 0; goto WAVvY; WAVvY: $fundsModel->exit_fee_ratio = !emptyInArray($infos, "\145\170\x69\x74\137\x66\145\145\137\x72\141\164\x69\157") ? $infos["\145\170\151\x74\x5f\x66\x65\145\137\x72\141\x74\151\x6f"] : 0.0; goto UIbu3; cK81Z: $fundsModel->partnership_end_date = !emptyInArray($infos, "\160\141\162\164\156\x65\162\163\x68\151\160\x5f\145\156\144\137\144\x61\164\145") ? $infos["\160\141\162\164\x6e\x65\x72\x73\x68\x69\x70\137\x65\156\144\137\x64\x61\x74\145"] : Defs::DEFAULT_DB_DATETIME_VALUE; goto cMZ75; cMZ75: $fundsModel->establish_date = !emptyInArray($infos, "\x65\163\164\141\x62\x6c\151\x73\x68\x5f\144\141\164\145") ? $infos["\x65\x73\164\141\142\154\151\163\150\137\144\141\x74\145"] : Defs::DEFAULT_DB_DATETIME_VALUE; goto zL6yP; Imxws: if ($fundsModel) { goto eWJsn; } goto GGEdS; amjTy: $fundsModel->size = !emptyInArray($infos, "\163\x69\172\145") ? $infos["\163\151\x7a\145"] : 0.0; goto gN0ED; vQ22l: eWJsn: goto dxojc; NI45W: } public function deleteFund($fundId) { goto ULwnD; RTdbt: exception("\346\x97\xa0\346\263\x95\346\211\xbe\345\x88\xb0\xe8\257\245\xe5\237\xba\xe9\x87\221"); goto vqqCi; vqqCi: goto SriHS; goto NXuzN; NXuzN: VlSHq: goto XuEN0; fIKD4: if ($fundsModel) { goto VlSHq; } goto RTdbt; XuEN0: $fundsModel->delete(); goto JbKmR; ULwnD: $fundsModel = \app\index\model\Funds::get($fundId); goto fIKD4; JbKmR: SriHS: goto kWsRY; kWsRY: } public function getFundInfos($fundId) { goto T33Va; Rezh9: $actualSize = Db::table("\146\165\x6e\x64\163\x5f\160\x61\162\x74\x6e\x65\162\x73")->where("\x66\x75\x6e\x64\137\x69\x64", $fundId)->sum("\x61\155\157\x75\156\164"); goto GpO9X; vnGra: return $infos; goto Gvgx5; GpO9X: if (!($actualSize === null)) { goto MrUKA; } goto KcHNE; lPZsw: PiH1s: goto Rezh9; QSQ46: if ($infos) { goto PiH1s; } goto tm_1P; T33Va: $infos = Db::table("\146\x75\156\144\163")->where("\146\165\x6e\x64\x5f\151\144", $fundId)->field(true)->find(); goto QSQ46; t1v9u: MrUKA: goto d5mgg; tm_1P: return false; goto lPZsw; d5mgg: $infos["\x61\x63\x74\165\141\154\x5f\x73\151\172\145"] = $actualSize; goto vnGra; KcHNE: $actualSize = 0.0; goto t1v9u; Gvgx5: } public function changeStatus($fundId, $fromStatus, $toStatus) { Db::table("\146\x75\156\x64\163")->where("\146\x75\156\144\x5f\151\144", $fundId)->update(["\x73\164\141\x74\x75\163" => $toStatus]); return true; } }
