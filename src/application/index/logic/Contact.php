<?php
 namespace app\index\logic; use app\index\model\Contacts; use think\Db; use app\index\service\RequestContext; class Contact extends Base { const GENDER = array("\xe5\x85\x88\347\224\x9f", "\345\245\263\xe5\xa3\xab"); const MODULE = "\103\x6f\x6e\164\x61\143\x74\x73"; private $model; protected function __construct() { $this->model = new Contacts(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $order = "\143\56\x69\144\40\144\145\x73\143") { goto iIR9i; iIR9i: $model = Db::table("\x63\157\156\x74\x61\143\164\163")->alias("\x63"); goto r0S4X; QUsFj: $where["\143\x2e\x6e\141\x6d\x65"] = ["\154\151\x6b\145", "\x25{$search["\156\x61\155\145"]}\45"]; goto zPOeD; EK7Sb: $model->join("\x75\163\145\162\163\137\162\145\x63\157\x72\144\x73\x20\162", "\143\x2e\151\x64\75\x72\x2e\x72\145\x63\157\162\144\x5f\151\144"); goto psOQG; wDHdl: if (!(isset($search["\156\141\x6d\x65"]) && $search["\x6e\141\x6d\x65"])) { goto HM6_w; } goto QUsFj; UDpPk: $where["\162\56\165\x73\x65\162\137\x69\144"] = RequestContext::I()->loginUserId; goto EK7Sb; qbtr5: $where["\162\x2e\x6d\x6f\x64\165\154\145"] = self::MODULE; goto UDpPk; fxH9q: return ["\164\157\164\x61\x6c" => $count, "\162\157\167\x73" => $items]; goto CLdCO; k8eRp: return []; goto bMjsx; JU4lN: $count = $model->count(); goto o8DDi; ZFb2Q: $items = $clone->join("\145\x6e\x74\x65\x72\160\162\x69\163\145\x73\137\x66\157\165\156\x64\145\162\163\x20\145\146", "\x65\x66\56\143\x6f\156\164\x61\x63\164\x5f\151\x64\75\x63\56\151\x64", "\114\105\x46\124")->field("\x63\56\52\54\145\x66\56\145\x6e\x74\145\162\x70\x72\151\163\x65\x5f\x69\144")->page($page, $rows)->order($order)->select(); goto fxH9q; FsYRa: $clone = clone $model; goto JU4lN; r0S4X: $where = ["\x63\56\144\x65\x6c\145\164\145\x64" => 0]; goto wDHdl; o8DDi: if (!empty($count)) { goto bKiSH; } goto k8eRp; Gl1H9: $model->where($where); goto FsYRa; psOQG: M5WgL: goto Gl1H9; zPOeD: HM6_w: goto rHACW; bMjsx: bKiSH: goto ZFb2Q; rHACW: if (!(isset($search["\x6d\x69\156\145"]) && $search["\155\x69\156\x65"])) { goto M5WgL; } goto qbtr5; CLdCO: } public function getContact($id) { goto gzp6C; Oj6Vm: return []; goto jOsZj; jOsZj: W1iH6: goto Y3PcC; Y3PcC: $row = $this->model->where("\x69\x64", $id)->find(); goto ld6jg; ld6jg: return $row ?: []; goto X_hnm; gzp6C: if (!empty($id)) { goto W1iH6; } goto Oj6Vm; X_hnm: } public function saveContact($id, $data) { goto Q8UZu; lOpCz: $data["\141\144\144\151\x74\x69\x6f\156\141\x6c\137\141\x73\163\x69\x67\x6e\x65\162\x73"] = ''; goto jARfB; YsV2z: if (!(isset($data["\x61\x67\x65"]) && empty($data["\x61\x67\145"]))) { goto zeWjW; } goto AQSm4; FeTp0: if (!is_array($data["\141\144\144\x69\164\151\x6f\x6e\141\154\x5f\x61\163\163\151\x67\x6e\145\162\163"])) { goto iIEZv; } goto rk0bA; jARfB: AD7Es: goto XoLbj; Yv4MK: jzDA2: goto S_3_M; CmITX: Tag::I()->setEntityTags($id, $data["\164\141\147\163"]); goto iWzi_; upJwH: VhoIB: goto F83My; dr5ka: sg2n2: goto YsV2z; AQSm4: $data["\x61\147\x65"] = null; goto I0oUE; qhOC7: zQJBY: goto lOpCz; Q8UZu: if (!(isset($data["\x6e\x61\x6d\145"]) && empty($data["\156\x61\x6d\145"]))) { goto sg2n2; } goto lXitl; ZpAdg: iIEZv: goto qtZbq; L9gJl: if (!is_array($data["\x61\163\x73\151\x67\x6e\145\x72"])) { goto jzDA2; } goto YUwdP; mzV0B: goto AD7Es; goto qhOC7; YUwdP: $data["\x61\163\x73\x69\x67\156\145\x72"] = join("\54", $data["\x61\163\163\151\147\156\145\162"]); goto Yv4MK; qtZbq: $assigners .= "\54" . $data["\x61\x64\x64\x69\x74\151\157\x6e\x61\154\137\x61\163\163\x69\147\x6e\145\x72\163"]; goto mzV0B; S_3_M: $assigners = $data["\x61\x73\163\x69\147\x6e\145\162"]; goto mbaBL; gs6GC: $this->model->allowField(true)->save($data, ["\x69\144" => $id]); goto f9kY3; Hde0a: $data["\x63\162\x65\141\164\x65\144\x5f\x62\171"] = session("\165\163\145\x72\151\144"); goto FIz8k; k5OlN: $id = $this->model->id; goto upJwH; f9kY3: goto VhoIB; goto WWJbE; F83My: UserRecord::I()->setRecordUsers(self::MODULE, $id, $assigners, $primary_assigner); goto jSscQ; lXitl: exception("\350\257\267\xe5\241\xab\345\206\x99\xe5\x88\233\xe5\247\x8b\xe4\272\272\345\xa7\223\345\220\215"); goto dr5ka; iWzi_: jajZU: goto gIEqj; gIEqj: return $id; goto PBshv; XoLbj: if (empty($id)) { goto HWm6L; } goto gs6GC; KxNdh: $primary_assigner = $data["\141\163\x73\151\x67\156\145\162"]; goto L9gJl; mbaBL: if (empty($data["\141\x64\x64\151\164\x69\x6f\156\141\x6c\137\141\163\163\x69\x67\156\x65\x72\163"])) { goto zQJBY; } goto FeTp0; WWJbE: HWm6L: goto Hde0a; FIz8k: $this->model->allowField(true)->save($data); goto k5OlN; I0oUE: zeWjW: goto KxNdh; rk0bA: $data["\x61\x64\x64\151\x74\151\x6f\156\141\x6c\x5f\141\x73\163\151\147\156\145\x72\x73"] = join("\x2c", $data["\x61\144\144\151\164\151\157\x6e\141\x6c\x5f\141\x73\x73\x69\x67\x6e\145\x72\x73"]); goto ZpAdg; jSscQ: if (!$data["\164\141\147\x73"]) { goto jajZU; } goto CmITX; PBshv: } public function delete($id) { $result = $this->model->where("\151\144", $id)->setField("\x64\x65\154\x65\164\145\144", 1); return $result > 0 ? true : false; } public function password($id, $password, $username = '') { goto DoVtU; ZaexB: RTDkM: goto n9Ep3; sHdnD: if (empty($username)) { goto RTDkM; } goto XdjXh; eUc3y: exception("\xe8\264\xa6\345\217\267\xe9\207\215\345\xa4\x8d\357\274\x8c\350\257\xb7\xe6\x9b\xb4\xe6\x8d\xa2"); goto GC5mU; GC5mU: tKNLv: goto Op2VC; DoVtU: $update = ["\160\141\x73\163\x77\x6f\162\x64" => md5($password)]; goto sHdnD; n9Ep3: Db::table("\143\x6f\156\164\x61\143\x74\163")->where("\151\x64", $id)->update($update); goto omp3s; kkdtT: if (!$exists) { goto tKNLv; } goto eUc3y; XdjXh: $exists = Db::table("\x63\x6f\x6e\x74\141\143\x74\x73")->where(["\151\144" => ["\x6e\145\x71", $id], "\165\163\x65\x72\x6e\141\x6d\x65" => $username])->value("\x69\144"); goto kkdtT; Op2VC: $update["\165\x73\145\x72\x6e\141\x6d\x65"] = $username; goto ZaexB; omp3s: } }
