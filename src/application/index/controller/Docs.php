<?php
 namespace app\index\controller; use think\Db; use think\Log; use think\Debug; use app\index\logic\Upload; class Docs extends Common { public function _initialize() { parent::_initialize(); } public function index($owned = 0) { $this->assign("\157\167\156\x65\144", $owned); return $this->fetch(); } public function files($category = 1, $page = 1, $rows = DEFAULT_PAGE_ROWS, $search = array(), $owned = 0) { goto oBx5l; D7lJX: if ($category == 1) { goto WukBt; } goto pMJG_; enyB7: whI3d: goto PRFh2; KbJVM: return $this->fetch(); goto oMwey; I2v7e: WukBt: goto wb9ve; oBx5l: if (!$this->request->isGet()) { goto T3Xni; } goto VAdlh; y01Fv: goto whI3d; goto I2v7e; PRFh2: return json($files); goto mrAjN; pMJG_: if (!($category == 2)) { goto K5nOz; } goto QA0VN; KT4Se: $files = []; goto D7lJX; zTY3V: $this->assign("\157\167\x6e\145\144", $owned); goto KbJVM; VAdlh: $this->assign("\x63\x61\164\x65\147\x6f\162\171", $category); goto zTY3V; wb9ve: $files = $this->_loadEnterpriseFiles($page, $rows, $search, $owned); goto enyB7; QA0VN: $files = $this->_loadFundFiles($page, $rows, $search, $owned); goto Wl7Wu; Wl7Wu: K5nOz: goto y01Fv; oMwey: T3Xni: goto KT4Se; mrAjN: } protected function _loadEnterpriseFiles($page = 1, $rows = DEFAULT_PAGE_ROWS, $search = array(), $owned = 0) { goto eUYEP; BXN0a: foreach ($enterprises as $enterprise) { goto TiYCX; pkaX9: $enterpriseFile = ["\151\x64" => $enterpriseId, "\156\141\x6d\x65" => $enterpriseName, "\x74\171\x70\x65" => '', "\x73\151\172\145" => '', "\x65\x6e\164\145\x72\145\x64" => '', "\165\163\x65\162" => '', "\163\x74\x61\x74\x65" => "\143\154\x6f\163\x65\x64", "\x63\x68\151\154\144\162\145\156" => []]; goto tUkw3; x14L3: $totalFiles[] = $enterpriseFile; goto ac11X; BcqTM: $enterpriseName = $enterprise["\x6e\x61\155\x65"]; goto pkaX9; ac11X: gE_RV: goto tBXGQ; t5dKv: foreach ($categories as $category) { goto zad9s; nQ5JX: $files = Db::table("\141\x74\x74\x61\143\150\155\145\x6e\164\x73")->where("\x65\170\164\145\x72\156\x61\x6c\137\x69\144", $enterpriseId)->where("\x61\x74\164\141\x63\x68\155\145\x6e\x74\x5f\164\x79\x70\145", $category["\141\x74\164\x61\x63\150\155\x65\x6e\x74\x5f\x74\x79\160\145"])->where("\151\x73\144\151\x72", "\75", 0)->order("\141\164\164\x61\143\x68\155\x65\156\164\137\151\144\x20\x61\163\x63")->field("\52")->select(); goto DXcfz; WQnku: mLccj: goto MQdX5; Na35h: $categoryFile = ["\x69\144" => $categoryId, "\x6e\141\x6d\x65" => $categoryName, "\164\171\160\x65" => '', "\163\x69\x7a\x65" => '', "\145\x6e\x74\145\162\x65\144" => '', "\x75\x73\x65\x72" => '', "\143\150\x69\x6c\x64\x72\145\156" => []]; goto nQ5JX; ZYHCd: Mgpvl: goto v816B; zad9s: $categoryId = $enterpriseId . "\x5f" . $category["\x61\164\164\x61\x63\x68\x6d\145\156\x74\137\x74\x79\160\x65"]; goto LSsO6; v816B: $enterpriseFile["\143\150\151\x6c\144\x72\x65\x6e"][] = $categoryFile; goto WQnku; DXcfz: foreach ($files as $file) { goto Axn9D; dJR8c: $pathParts = pathinfo($file["\163\x61\166\145\x5f\x6e\x61\155\145"]); goto nEDQz; x0D1K: $type = ''; goto dJR8c; M2OeZ: $user = Db::table("\x61\144\155\x69\156\163")->where("\141\x64\x6d\x69\156\137\151\144", $file["\165\163\x65\x72\x5f\x69\x64"])->value("\162\145\x61\154\x6e\141\155\x65"); goto dLclv; R2ejm: $categoryFile["\143\x68\x69\x6c\144\162\145\156"][] = ["\x69\144" => $attachId, "\156\141\155\145" => $attachName, "\x74\x79\x70\x65" => $type, "\x73\151\x7a\145" => $file["\x73\151\x7a\145"], "\145\x6e\164\145\x72\145\x64" => $file["\x65\156\164\145\162\145\x64"], "\x75\x73\145\x72" => $user]; goto kz19Y; Co3LV: jyqtw: goto k3yaP; Cs7Cl: if (!($file["\165\x73\145\x72\x5f\x74\171\x70\x65"] == 1)) { goto JrNuy; } goto M2OeZ; dLclv: JrNuy: goto x0D1K; rPDL1: $attachName = $file["\x6f\162\151\147\151\x6e\141\x6c\x5f\x6e\141\155\145"]; goto L2S1h; dO4dn: $type = "\74\x73\x70\141\x6e\40\143\x6c\141\163\x73\75\x22" . Upload::$attachFileTypeDefs[strtolower($pathParts["\145\x78\164\x65\156\163\151\157\x6e"])]["\x69\143\157\156"] . "\x22\76\x20" . Upload::$attachFileTypeDefs[strtolower($pathParts["\145\x78\x74\145\x6e\163\151\x6f\x6e"])]["\154\x61\142\x65\154"] . "\x3c\x2f\163\160\x61\156\76"; goto Co3LV; U3fR8: if (!isset(Upload::$attachFileTypeDefs[strtolower($pathParts["\x65\170\x74\x65\156\163\151\x6f\x6e"])])) { goto jyqtw; } goto dO4dn; nEDQz: if (!$pathParts) { goto NGVio; } goto U3fR8; k3yaP: NGVio: goto R2ejm; Axn9D: $attachId = $categoryId . "\x5f" . $file["\x61\x74\x74\141\x63\150\x6d\145\x6e\164\137\x69\144"]; goto rPDL1; kz19Y: rNu_m: goto lHJlw; L2S1h: $user = ''; goto Cs7Cl; lHJlw: } goto ZYHCd; LSsO6: $categoryName = Upload::$attachTypeDefs[$category["\141\x74\x74\x61\x63\x68\155\x65\x6e\164\x5f\164\171\x70\x65"]]["\154\141\x62\145\154"]; goto Na35h; MQdX5: } goto c6oCS; tUkw3: $categories = Db::table("\x61\x74\164\x61\x63\x68\x6d\x65\156\x74\x73")->where("\x65\170\x74\145\x72\156\x61\154\137\x69\x64", $enterpriseId)->where("\141\x74\164\x61\x63\x68\155\145\156\x74\137\164\x79\x70\145", "\142\x65\164\167\x65\x65\156", [1, 99])->where("\x69\x73\x64\151\x72", "\75", 0)->group("\141\x74\164\141\143\150\x6d\x65\x6e\x74\x5f\x74\171\160\145")->order("\x61\x74\164\x61\143\x68\155\145\x6e\x74\137\x74\171\x70\x65\x20\141\x73\143")->field("\x61\164\164\141\x63\x68\x6d\x65\x6e\x74\x5f\164\x79\160\x65")->select(); goto t5dKv; TiYCX: $enterpriseId = $enterprise["\x69\144"]; goto BcqTM; c6oCS: TSFYI: goto x14L3; tBXGQ: } goto g3xk3; AUwrc: $total = Db::table("\x65\x6e\x74\145\x72\x70\162\x69\x73\145\163")->alias("\x45")->join("\141\164\164\x61\143\x68\x6d\x65\x6e\164\x73\x20\x41", "\x41\x2e\x65\170\164\x65\162\156\x61\154\137\x69\x64\x3d\105\x2e\x69\144")->where("\x41\x2e\x61\164\164\x61\x63\150\x6d\145\x6e\164\137\x74\x79\160\x65", "\142\145\164\167\145\x65\156", [1, 99])->where("\x41\56\x69\163\144\151\x72", "\x3d", 0)->where($conditions)->group("\x45\56\151\144")->count(); goto gq5rW; eUYEP: $conditions = []; goto q69LH; Yms62: $conditions["\x45\56\x6e\x61\155\x65"] = ["\154\151\153\x65", "\45" . $search["\x6e\141\x6d\x65"] . "\x25"]; goto uX4BM; TuOsU: $totalFiles = []; goto AUwrc; g3xk3: wu_lN: goto Fpq_x; q69LH: if (emptyInArray($search, "\x6e\141\155\x65")) { goto iHKXS; } goto Yms62; gq5rW: $enterprises = Db::table("\145\x6e\x74\145\162\x70\162\x69\x73\145\x73")->alias("\105")->join("\141\164\164\141\143\150\x6d\145\x6e\164\163\x20\x41", "\101\56\145\x78\164\145\x72\156\141\x6c\x5f\x69\144\x3d\105\x2e\x69\x64")->where("\x41\x2e\141\x74\164\x61\x63\150\x6d\x65\156\164\x5f\164\x79\x70\145", "\x62\145\x74\x77\145\145\156", [1, 99])->where("\101\56\x69\x73\x64\x69\162", "\x3d", 0)->where($conditions)->group("\105\x2e\x69\144")->page($page, $rows)->order("\x45\56\x69\144\40\x61\x73\143")->field("\101\56\x2a\54\x45\x2e\151\x64\54\x45\56\x6e\x61\x6d\x65")->select(); goto BXN0a; Fpq_x: return ["\x74\x6f\164\x61\154" => $total, "\162\157\x77\163" => $totalFiles]; goto CxfEn; uX4BM: iHKXS: goto TuOsU; CxfEn: } protected function _loadFundFiles($page = 1, $rows = DEFAULT_PAGE_ROWS, $search = array(), $owned = 0) { goto oNjZT; e1LUo: foreach ($funds as $fund) { goto LJPRX; KfoAF: RQYqa: goto b1Bc4; Rc5zL: $fundName = $fund["\156\x61\155\145"]; goto ZcMmO; v5BHP: $categories = Db::table("\141\x74\x74\141\x63\150\x6d\145\x6e\164\x73")->where("\x65\x78\164\145\x72\x6e\x61\154\137\x69\x64", $fundId)->where("\x61\164\x74\x61\143\150\x6d\x65\156\x74\x5f\164\x79\x70\145", "\x62\145\164\167\x65\x65\156", [100, 199])->where("\151\163\144\x69\x72", "\x3d", 0)->group("\141\x74\164\141\x63\x68\x6d\145\x6e\x74\137\x74\171\x70\x65")->order("\x61\164\x74\x61\x63\x68\x6d\x65\156\164\137\x74\171\160\x65\x20\141\163\143")->field("\141\164\164\141\143\x68\155\x65\x6e\x74\x5f\164\171\x70\x65")->select(); goto Ugx0y; LJPRX: $fundId = $fund["\146\x75\156\144\x5f\151\x64"]; goto Rc5zL; b1Bc4: $totalFiles[] = $fundFile; goto bFKbc; Ugx0y: foreach ($categories as $category) { goto MPWnL; W04GQ: mJTVa: goto bitZm; Le7So: $categoryFile = ["\x69\144" => $categoryId, "\156\x61\155\x65" => $categoryName, "\x74\x79\x70\x65" => '', "\x73\x69\x7a\145" => '', "\145\156\164\145\x72\145\144" => '', "\165\163\145\162" => '', "\143\150\x69\x6c\144\x72\x65\x6e" => []]; goto hDKVb; ICjNB: foreach ($files as $file) { goto fmzaX; aQikM: $type = "\x3c\x73\160\x61\156\x20\x63\x6c\141\163\163\x3d\42" . Upload::$attachFileTypeDefs[strtolower($pathParts["\x65\170\164\x65\156\x73\151\x6f\156"])]["\151\x63\157\156"] . "\x22\x3e\40" . Upload::$attachFileTypeDefs[strtolower($pathParts["\145\x78\x74\145\x6e\x73\151\x6f\x6e"])]["\x6c\141\142\145\154"] . "\x3c\x2f\x73\160\x61\x6e\76"; goto c88K_; k29WD: su0IX: goto Tgn2H; g7pUl: pAaYR: goto TAGGU; fmzaX: $attachId = $categoryId . "\137" . $file["\141\164\164\x61\143\150\x6d\x65\x6e\164\137\x69\x64"]; goto XMQQe; f8pMB: $user = Db::table("\141\144\155\151\x6e\x73")->where("\x61\x64\x6d\x69\x6e\x5f\x69\x64", $file["\x75\x73\x65\x72\137\x69\x64"])->value("\x72\x65\x61\x6c\x6e\x61\x6d\145"); goto g7pUl; TAGGU: $type = ''; goto p8bBO; c88K_: dqW86: goto k29WD; YF3AK: if (!$pathParts) { goto su0IX; } goto w3P1f; XMQQe: $attachName = $file["\x6f\162\151\147\151\156\141\x6c\x5f\156\x61\155\145"]; goto A5tb5; A5tb5: $user = ''; goto aDpQr; Tgn2H: $categoryFile["\143\150\151\154\x64\x72\145\156"][] = ["\151\x64" => $attachId, "\156\x61\x6d\145" => $attachName, "\x74\x79\160\x65" => $type, "\163\x69\x7a\x65" => $file["\163\151\x7a\x65"], "\x65\156\164\145\x72\145\144" => $file["\145\x6e\x74\145\x72\x65\144"], "\x75\x73\145\162" => $user]; goto geXZo; geXZo: Sov3y: goto cUCs2; w3P1f: if (!isset(Upload::$attachFileTypeDefs[strtolower($pathParts["\145\170\x74\x65\x6e\163\151\157\156"])])) { goto dqW86; } goto aQikM; aDpQr: if (!($file["\x75\x73\145\162\137\x74\x79\x70\x65"] == 1)) { goto pAaYR; } goto f8pMB; p8bBO: $pathParts = pathinfo($file["\163\x61\x76\x65\x5f\x6e\x61\155\x65"]); goto YF3AK; cUCs2: } goto Iht8X; Iht8X: Nxw22: goto KX_fz; MPWnL: $categoryId = $fundId . "\x5f" . $category["\141\164\x74\x61\x63\x68\x6d\145\x6e\164\x5f\x74\171\x70\145"]; goto Y1xzw; hDKVb: $files = Db::table("\x61\x74\x74\141\x63\150\155\x65\x6e\164\x73")->where("\x65\170\164\145\162\x6e\x61\x6c\x5f\151\144", $fundId)->where("\141\x74\164\x61\143\x68\155\145\156\x74\x5f\164\171\160\x65", $category["\141\x74\164\x61\x63\x68\155\x65\x6e\x74\x5f\x74\171\x70\x65"])->where("\x69\163\144\x69\x72", "\x3d", 0)->order("\141\x74\164\x61\143\x68\x6d\x65\156\x74\137\x69\144\x20\x61\x73\143")->field("\52")->select(); goto ICjNB; Y1xzw: $categoryName = Upload::$attachTypeDefs[$category["\x61\x74\x74\x61\143\150\155\x65\156\x74\x5f\164\x79\160\145"]]["\154\141\142\145\154"]; goto Le7So; KX_fz: $fundFile["\x63\150\151\x6c\x64\162\x65\x6e"][] = $categoryFile; goto W04GQ; bitZm: } goto KfoAF; ZcMmO: $fundFile = ["\151\x64" => $fundId, "\x6e\141\155\145" => $fundName, "\x74\x79\160\x65" => '', "\x73\151\172\x65" => '', "\145\156\164\x65\x72\x65\x64" => '', "\x75\163\145\x72" => '', "\x73\164\141\x74\145" => "\143\154\x6f\163\x65\x64", "\x63\150\151\154\144\x72\x65\x6e" => []]; goto v5BHP; bFKbc: vbXUK: goto wNL30; wNL30: } goto yu8Rg; xRNHH: $totalFiles = []; goto nDZr6; yu8Rg: aaJ9o: goto RsjoV; SETUN: $conditions["\106\x2e\156\x61\155\x65"] = ["\x6c\151\x6b\145", "\45" . $search["\156\141\155\145"] . "\x25"]; goto C5IW5; lKmO1: if (emptyInArray($search, "\156\x61\155\145")) { goto BYpwk; } goto SETUN; nDZr6: $total = Db::table("\146\165\156\144\x73")->alias("\106")->join("\141\x74\x74\141\143\150\155\x65\x6e\164\163\40\x41", "\x41\x2e\x65\x78\x74\x65\x72\x6e\141\154\137\151\144\75\106\56\146\165\156\x64\137\151\144")->where("\x41\56\141\x74\x74\141\x63\x68\x6d\145\x6e\x74\x5f\x74\x79\x70\x65", "\x62\x65\164\x77\145\145\x6e", [100, 199])->where("\x41\x2e\x69\x73\144\x69\162", "\x3d", 0)->where($conditions)->group("\x46\56\146\x75\x6e\144\x5f\x69\x64")->count(); goto rXyti; oNjZT: $conditions = []; goto lKmO1; RsjoV: return ["\x74\157\164\141\154" => $total, "\162\157\167\x73" => $totalFiles]; goto TjMYy; C5IW5: BYpwk: goto xRNHH; rXyti: $funds = Db::table("\146\x75\x6e\x64\x73")->alias("\106")->join("\x61\x74\x74\x61\x63\150\155\145\156\x74\x73\40\x41", "\x41\x2e\x65\170\164\x65\x72\x6e\141\154\x5f\x69\x64\x3d\106\x2e\x66\165\x6e\144\x5f\151\x64")->where("\101\x2e\141\x74\164\141\x63\150\x6d\145\156\x74\x5f\x74\171\160\x65", "\x62\x65\164\167\x65\x65\x6e", [100, 199])->where("\101\x2e\x69\x73\x64\x69\162", "\75", 0)->where($conditions)->group("\106\56\x66\165\x6e\144\x5f\151\144")->page($page, $rows)->order("\106\x2e\x66\x75\x6e\x64\x5f\x69\144\x20\141\x73\143")->field("\101\x2e\52\54\106\x2e\146\165\x6e\x64\x5f\151\x64\x2c\106\x2e\156\x61\155\x65")->select(); goto e1LUo; TjMYy: } }
