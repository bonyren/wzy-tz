<?php
 namespace app\index\controller; use app\index\logic\Defs; use think\Controller; use think\Db; use think\Log; use think\Debug; use app\index\model\Setting; class System extends Common { public function setting() { goto fAduF; gvS_c: return ajaxError("\xe5\xa4\xb1\350\264\xa5"); goto MkPJw; xkeV3: $this->assign("\x75\x72\154\x48\162\x65\146\163", $urlHrefs); goto VoJcJ; w40dk: return json($data); goto sh5xm; D2qix: return ajaxSuccess("\346\223\x8d\xe4\275\x9c\xe6\210\220\xe5\212\237"); goto bsWmV; fAduF: if (request()->isPost()) { goto FkNfX; } goto YDdye; kFHVp: Np4VN: goto gB4Wz; JsJoT: goto ixkHC; goto G5MEA; fvJJ2: if (input("\x67\x65\164\56\x64\x6f\163\165\x62\155\151\164")) { goto cf627; } goto pRO18; pRO18: $data = array_values($settingModel->getSetting()); goto w40dk; G5MEA: FkNfX: goto Bs8yH; YDdye: $urlHrefs = ["\163\145\164\164\151\156\x67" => url("\x73\145\164\164\151\x6e\x67"), "\x73\x65\x74\164\151\156\x67\123\x61\x76\145" => url("\163\145\164\164\151\x6e\x67", ["\x64\157\163\165\142\x6d\151\164" => 1]), "\163\x65\x74\164\151\156\147\104\145\x66\x61\x75\x6c\164" => url("\163\x65\x74\164\151\156\x67\104\145\146\141\165\x6c\164"), "\x73\x65\164\x74\x69\x6e\147\105\170\x70\x6f\162\164" => url("\163\145\x74\164\151\156\147\105\x78\x70\x6f\x72\164"), "\163\145\164\x74\x69\x6e\x67\111\x6d\160\x6f\162\x74" => url("\163\x65\x74\x74\151\x6e\x67\111\x6d\x70\x6f\162\x74"), "\151\x6d\160\157\x72\164\x55\x70\x6c\x6f\141\x64" => url("\x49\155\160\157\162\164\57\151\x6d\160\157\162\164"), "\x66\151\154\x65\x55\x70\154\157\x61\x64" => url("\125\x70\154\x6f\141\x64\x2f\x75\160\154\157\141\x64")]; goto xkeV3; fLoch: AEdSq: goto b60C4; MkPJw: goto nNm3t; goto fLoch; bsWmV: nNm3t: goto kFHVp; Bs8yH: $settingModel = model("\x53\145\164\164\151\156\147"); goto fvJJ2; RjTmm: $state = $settingModel->saveSetting(input("\x70\157\163\x74\56\x64\x61\164\x61\x2f\141")); goto dfGsV; sh5xm: goto Np4VN; goto aSj9X; dfGsV: if ($state) { goto AEdSq; } goto gvS_c; VoJcJ: return $this->fetch(); goto JsJoT; gB4Wz: ixkHC: goto mMRK5; b60C4: $settingModel->clearCache(); goto D2qix; aSj9X: cf627: goto RjTmm; mMRK5: } public function settingDefault() { goto ttG5Y; ttG5Y: if (!request()->isPost()) { goto cDYVM; } goto vJGu8; rLO2X: if (!$settingModel->count()) { goto yxjFt; } goto jF1zG; UEby8: $settingModel->clearCache(); goto pgWy_; Iov3m: return ajaxSuccess("\xe6\x93\215\xe4\xbd\x9c\346\x88\220\345\x8a\237"); goto H81Sr; Rn2FR: QVAgH: goto vOxS1; vJGu8: $settingModel = model("\123\145\x74\x74\151\x6e\147"); goto rLO2X; H81Sr: cDYVM: goto omQ3O; l5wml: if ($state) { goto hL4TL; } goto pvi_Q; vr6AN: goto QVAgH; goto nsTqK; vOxS1: yxjFt: goto Iov3m; pvi_Q: return ajaxError("\345\244\xb1\350\xb4\xa5"); goto vr6AN; nsTqK: hL4TL: goto UEby8; pgWy_: return ajaxSuccess("\346\x93\215\344\275\234\xe6\x88\x90\345\212\x9f"); goto Rn2FR; jF1zG: $state = $settingModel->where("\140\x6b\145\x79\140\40\x3c\x3e\40\47\47")->delete(); goto l5wml; omQ3O: } public function settingExport($filename = '') { goto TyMoS; SlxTU: ogKhu: goto xbEwH; GsjNi: $data = array("\164\171\160\x65" => "\163\145\x74\x74\x69\156\147"); goto RTa4u; woJH2: header("\x43\x6f\156\x74\x65\156\x74\55\x44\151\163\x70\x6f\x73\x69\164\151\x6f\156\72\40\x61\x74\x74\141\143\150\x6d\145\x6e\x74\x3b\40\x66\x69\x6c\x65\x6e\141\x6d\145\x3d\x22\x73\x79\x73\x74\145\x6d\x5f\163\x65\164\x74\151\x6e\147\x2e\x64\x61\x74\141\x22"); goto rDO7Q; Zk6Ws: $uniqid = uniqid(); goto ZUT1M; N3Tzv: return $this->fetch("\x63\x6f\155\155\157\156\57\x65\x72\x72\157\162"); goto tm6IA; rDO7Q: readfile($filename); goto prXF7; wOaVV: $data["\x76\145\162\x69\146\171"] = md5(var_export($data["\x64\x61\164\x61"], true) . $data["\x74\x79\160\x65"]); goto uN3dU; YGl96: ZKGNG: goto JX9Eu; RTa4u: $data["\x64\x61\x74\141"] = Db::table("\x73\x65\164\x74\x69\156\x67")->select(); goto wOaVV; befVa: if (file_exists($filename)) { goto jRfQH; } goto N3Tzv; rALnD: return ajaxSuccess("\xe6\x88\220\345\212\x9f", url("\x53\x79\163\164\145\x6d\x2f\x73\x65\164\x74\x69\x6e\147\x45\170\x70\x6f\162\x74", array("\146\x69\154\145\156\x61\155\145" => $uniqid))); goto SlxTU; Uh0oP: goto ZKGNG; goto bx2Q3; DQoOG: $filename = EXPORT_DIR . DS . $filename . "\x2e\x64\141\164\x61"; goto befVa; prXF7: unlink($filename); goto N0H0L; J3HEU: $filename = str_replace(array("\56", "\x2f", "\x5c"), '', $filename); goto DQoOG; bx2Q3: IoNP4: goto sWlB1; vUjCV: header("\x43\x6f\x6e\x74\145\x6e\164\55\164\171\x70\145\x3a\40\x61\160\160\154\151\143\141\164\x69\x6f\156\57\157\143\x74\145\x74\x2d\x73\164\162\145\x61\x6d"); goto woJH2; uN3dU: $data = base64_encode(gzdeflate(json_encode($data))); goto Zk6Ws; uVLfU: if (!file_put_contents($filename, $data)) { goto ogKhu; } goto rALnD; tm6IA: jRfQH: goto vUjCV; ZUT1M: $filename = EXPORT_DIR . DS . $uniqid . "\x2e\144\141\164\141"; goto uVLfU; xbEwH: return ajaxError("\xe5\244\xb1\350\xb4\245"); goto YGl96; N0H0L: exit; goto Uh0oP; TyMoS: if (request()->isPost()) { goto IoNP4; } goto J3HEU; sWlB1: $settingModel = model("\x53\145\x74\164\x69\156\147"); goto GsjNi; JX9Eu: } public function settingImport($filename = '') { goto A4_Pw; UVRLM: try { $data = gzinflate(base64_decode($content)); } catch (\Exception $e) { } goto PUwgE; YpCxI: if (!($data["\166\x65\162\151\x66\x79"] != md5(var_export($data["\x64\141\164\x61"], true) . $data["\164\171\160\145"]))) { goto bb4z4; } goto qsqiR; wZNbH: TxZhN: goto YpCxI; fJonU: Yv_CU: goto l2jSq; Es5D5: return ajaxError("\345\244\xb1\xe8\xb4\xa5"); goto IIz1J; WyLEN: y6ssx: goto DXqmO; RkWfa: bb4z4: goto G8dLb; AFOnn: try { $data = json_decode($data, true); } catch (\Exception $e) { } goto vKyYT; bBE7Y: goto Yv_CU; goto WyLEN; IIz1J: cIgQX: goto GH4sK; DXqmO: $filePath = IMPORT_DIR . DS . $filename; goto tvENL; y0EoC: d9J4O: goto gUHJB; ep6S3: return ajaxError("\xe5\244\261\xe8\264\245"); goto eOo5t; W042G: return ajaxError("\345\xa4\261\xe8\xb4\245"); goto RkWfa; IFdG5: return ajaxError("\345\244\261\350\264\xa5"); goto bBE7Y; eOo5t: rZ4Pl: goto AFOnn; pcocy: Log::error("\146\151\154\145\x3a\x20{$filePath}\x20\x69\x73\40\156\x6f\x74\40\x65\170\151\x73\x74"); goto Es5D5; mEZyP: unlink($filePath); goto ep6S3; ymZz0: Log::error("\x66\151\x6c\145\72\x20{$filePath}\x2c\x20\146\141\151\x6c\x65\x64\40\164\157\40\144\x65\x63\157\x64\x65\40\151\x74"); goto pgkhI; pgkhI: return ajaxError("\xe5\244\xb1\xe8\264\xa5"); goto wZNbH; vKyYT: if (!(!is_array($data) || !isset($data["\164\171\160\x65"]) || $data["\x74\171\160\145"] != "\x73\145\164\164\151\x6e\147" || !isset($data["\166\145\x72\151\x66\171"]) || !isset($data["\x64\141\x74\141"]))) { goto TxZhN; } goto AR482; AgGWd: Log::error("\x73\145\x74\164\151\x6e\147\111\155\x70\x6f\162\x74\54\x20\x66\151\x6c\145\72\x20{$filePath}\54\40\146\x61\x69\154\x65\144\x20\164\x6f\40\166\x65\x72\151\146\x79\x20\x69\x74\54\x20\x76\x65\162\x69\x66\x79\72\40{$data["\x76\145\162\x69\146\x79"]}"); goto W042G; Pe0Gt: $settingModel->clearCache(); goto DKZrF; qsqiR: unlink($filePath); goto AgGWd; DKZrF: asort($data["\144\x61\164\141"]); goto PnoY_; iCFqB: $settingModel->where("\x60\x6b\x65\171\140\x20\74\x3e\x20\x27\47")->delete(); goto Pe0Gt; G8dLb: $settingModel = model("\123\145\x74\x74\151\156\x67"); goto iCFqB; l9Nzy: Log::error("\146\151\x6c\x65\72\x20{$filePath}\54\x20\x66\x61\x69\x6c\x65\x64\40\164\157\x20\144\x65\143\162\171\160\x74\40\x69\x74"); goto mEZyP; AR482: unlink($filePath); goto ymZz0; PnoY_: foreach ($data["\x64\x61\x74\141"] as $add) { goto CxYyI; ido2a: XNtYx: goto To7tM; CxYyI: $settingModel->key = $add["\153\145\x79"]; goto L7Ibq; GWZIq: $settingModel->isUpdate(false)->save(); goto ido2a; L7Ibq: $settingModel->value = $add["\166\141\154\165\x65"]; goto GWZIq; To7tM: } goto y0EoC; Q_2xu: return ajaxSuccess("\xe6\x93\x8d\xe4\xbd\x9c\346\x88\x90\xe5\x8a\x9f"); goto fJonU; PUwgE: if (isset($data)) { goto rZ4Pl; } goto l9Nzy; tvENL: if (file_exists($filePath)) { goto cIgQX; } goto pcocy; GH4sK: $content = file_get_contents($filePath); goto UVRLM; A4_Pw: if (request()->isPost()) { goto y6ssx; } goto IFdG5; gUHJB: unlink($filePath); goto Q_2xu; l2jSq: } public function dbBackups() { goto AXkcQ; TjujT: $backupFiles = []; goto gaIAu; A6YUg: closedir($handle); goto xssN3; N7PY0: $backupPath = systemSetting("\x44\x42\137\102\x41\x43\113\x55\120\137\120\101\124\x48"); goto svUaN; AXkcQ: if (!$this->request->isGet()) { goto If_lW; } goto UgiUX; Nj1x4: If_lW: goto XDYak; XCvmp: if (!systemSetting("\104\x42\x5f\102\101\103\113\125\x50\137\x50\x41\x54\x48")) { goto lkJIM; } goto N7PY0; UgiUX: return $this->fetch(); goto Nj1x4; yJNec: gPafw: goto Nj8w1; xssN3: J7saf: goto IXO6z; WUxct: ntvAL: goto A6YUg; qI42w: $backupFiles[] = ["\156\x61\x6d\x65" => $file, "\144\141\x74\x65" => date("\131\x2d\155\55\x64", strtotime($backupDate))]; goto bPGgy; LCbv0: return json($backupFiles); goto WHBE7; EuLEG: $slices = explode("\x2e", $file); goto l_0Qs; l_0Qs: $backupDate = explode("\x23", $slices[0])[1]; goto qI42w; gaIAu: if (!(is_dir($backupPath) && file_exists($backupPath) && ($handle = opendir($backupPath)))) { goto J7saf; } goto yJNec; iHSH4: array_multisort($backupFiles, SORT_DESC, $dates); goto LCbv0; XDYak: $backupPath = ROOT_PATH . "\x64\142" . DS . "\142\141\143\x6b\x75\160"; goto XCvmp; PO7BR: goto gPafw; goto WUxct; IXO6z: $dates = array_column($backupFiles, "\144\x61\164\145"); goto iHSH4; Nj8w1: if (!(false !== ($file = readdir($handle)))) { goto ntvAL; } goto ZB9J_; svUaN: lkJIM: goto TjujT; ZB9J_: if (!($file != "\x2e" && $file != "\x2e\x2e")) { goto U68nK; } goto EuLEG; bPGgy: U68nK: goto PO7BR; WHBE7: } public function docs($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = "\x65\170\164\145\162\x6e\141\154\x5f\151\x64", $order = "\144\x65\163\x63", $owned = 0) { goto EXyNX; fY5PH: $order = "\145\x78\164\x65\x72\x6e\141\154\x5f\151\144\x20" . $order; goto zMLu6; JZVGK: U_lqM: goto BUNiw; BUNiw: if (emptyInArray($search, "\x61\164\x74\x61\143\150\155\145\x6e\164\x5f\164\171\160\x65")) { goto R_uXA; } goto Mjd6O; vHnFO: $order = "\x65\170\x74\145\x72\x6e\141\154\137\x69\144\x20\x64\145\x73\143"; goto dX8y8; EtvrF: $total = Db::table("\x61\x74\x74\x61\143\150\x6d\145\156\164\163")->where($conditions)->group("\x61\164\x74\x61\x63\150\x6d\145\156\164\x5f\164\171\160\145\54\x20\145\170\164\x65\x72\156\x61\x6c\x5f\151\x64")->count(); goto BD9uB; zMLu6: f7S6q: goto gUJqE; VyiIN: return json(["\164\x6f\x74\x61\154" => $total, "\162\157\167\x73" => $records]); goto YID8j; lKTlA: n6SvS: goto fY5PH; BD9uB: $records = Db::table("\x61\x74\x74\141\143\150\x6d\x65\156\164\163")->where($conditions)->group("\x61\164\164\x61\143\150\x6d\x65\156\164\137\x74\171\x70\145\x2c\40\x65\170\164\x65\162\156\x61\154\137\151\144")->limit($limit)->order($order)->field("\141\164\164\x61\143\x68\x6d\145\x6e\164\x5f\164\x79\x70\145\x2c\40\x65\x78\x74\x65\162\156\x61\154\137\151\x64")->select(); goto DgsW9; kT03k: if ($sort == "\145\170\164\x65\x72\x6e\141\x6c\x5f\x69\144") { goto n6SvS; } goto vHnFO; HZhvD: return $this->fetch(); goto n1Vpo; Vvek3: $limit = ($page - 1) * $rows . "\54" . $rows; goto kT03k; ViURR: $conditions["\x75\163\145\162\137\151\x64"] = \app\index\service\RequestContext::I()->loginUserId; goto JZVGK; cns3p: R_uXA: goto EtvrF; jOJFG: $this->assign("\165\x72\x6c\110\162\x65\x66\x73", $urlHrefs); goto HZhvD; EXyNX: if (!request()->isGet()) { goto qkkHX; } goto Doe1p; daCSg: if (!$owned) { goto U_lqM; } goto ViURR; gUJqE: $conditions = ["\163\164\x61\x74\x75\x73" => Defs::ATTACHMENT_OK]; goto daCSg; dX8y8: goto f7S6q; goto lKTlA; n1Vpo: qkkHX: goto Vvek3; DgsW9: foreach ($records as &$record) { goto UoCQ5; Kka8O: $record["\x65\x78\x74\145\162\156\x61\154\x5f\x6e\141\x6d\x65"] = Db::table("\145\x6e\164\x65\162\160\162\x69\163\145\x73")->where(["\x69\x64" => $record["\145\170\164\x65\162\x6e\x61\154\137\151\x64"]])->value("\x6e\141\x6d\145"); goto Qgc5k; luMuD: LyLap: goto BzdUL; UoCQ5: if ($record["\141\x74\164\141\x63\x68\155\x65\156\164\137\164\x79\x70\x65"] < \app\index\logic\Upload::ATTACH_FUND_PARTNER_AGREEMENT) { goto haI5V; } goto U2qMH; d8zBX: haI5V: goto Kka8O; PTQ1r: c9j0W: goto qt3oy; izptA: $record["\145\170\164\x65\162\x6e\141\x6c\137\x6e\x61\x6d\x65"] = "\xe6\x9c\252\345\256\232\xe4\xb9\211"; goto S1p7T; S1p7T: uyQWz: goto TupLx; BzdUL: $record["\x65\x78\164\145\162\x6e\141\x6c\137\x6e\x61\155\145"] = Db::table("\x63\150\141\x6e\x67\145\137\x6c\157\147\x73")->alias("\x43\x4c")->join("\x66\165\x6e\x64\x73\40\106", "\x43\114\56\145\x78\164\x65\162\x6e\141\154\x5f\x69\x64\75\106\x2e\x66\165\156\144\x5f\x69\144", "\x4c\105\106\124")->where(["\103\114\56\x69\x64" => $record["\145\170\x74\x65\x72\x6e\141\x6c\x5f\151\144"]])->value("\x63\157\x6e\143\x61\164\50\x46\56\x6e\141\x6d\145\54\x20\x27\40\55\40\47\54\40\103\114\56\x64\x65\163\143\x29"); goto PTQ1r; Dwgto: if (!($record["\x65\x78\x74\145\x72\156\141\x6c\x5f\x6e\x61\155\x65"] === null)) { goto uyQWz; } goto izptA; zR9e_: $record["\145\x78\164\x65\x72\x6e\x61\x6c\137\156\141\x6d\x65"] = Db::table("\146\x75\156\x64\x73")->where(["\x66\165\x6e\x64\137\151\x64" => $record["\x65\x78\164\x65\x72\156\141\x6c\x5f\x69\144"]])->value("\x6e\x61\x6d\145"); goto lGGBF; U2qMH: if ($record["\x61\x74\x74\x61\143\x68\155\145\x6e\x74\137\x74\x79\160\x65"] == \app\index\logic\Upload::ATTACH_FUND_CHANGE_LOGS) { goto LyLap; } goto zR9e_; lGGBF: goto c9j0W; goto luMuD; Qgc5k: Y0c08: goto Dwgto; TupLx: fxzdG: goto k1tFl; qt3oy: goto Y0c08; goto d8zBX; k1tFl: } goto hWsmN; hWsmN: XTFGe: goto VyiIN; Doe1p: $urlHrefs = ["\x64\x6f\x63\x73" => url("\151\x6e\x64\145\170\57\123\171\163\x74\x65\x6d\x2f\144\157\143\163", ["\157\x77\x6e\x65\144" => $owned]), "\x64\145\x6c\x65\x74\x65" => url("\x69\x6e\144\145\170\57\x53\171\163\164\145\155\x2f\x64\x6f\x63\x73\104\145\x6c\145\164\x65")]; goto jOJFG; Mjd6O: $conditions["\141\164\164\x61\143\150\x6d\145\156\164\137\164\x79\x70\145"] = $search["\x61\x74\x74\x61\143\x68\155\x65\x6e\164\137\x74\x79\x70\145"]; goto cns3p; YID8j: } public function docsDelete($attachmentType, $externalId) { return ajaxSuccess("\346\x88\x90\xe5\212\237"); } }
