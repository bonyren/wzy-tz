<?php
 namespace app\index\controller; use think\Db; use app\common\CommonDefs; use app\index\logic\ProgressLogs as ProgressLogsLogic; use app\index\logic\Upload as UploadLogic; class ProgressLogs extends Common { public function index($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = "\160\162\x6f\147\162\145\x73\x73\x5f\154\x6f\x67\x5f\151\x64", $order = "\x64\145\163\143", $category = ProgressLogsLogic::PROGRESS_LOG_ALL_CATEGORY, $externalId = 0, $readOnly = 0, $src = CommonDefs::MODULE_ADMIN) { goto rXgFx; nVroX: $uniqid = generateUniqid(); goto NREXs; vIgSf: TfUzC: goto nVroX; NREXs: $urlHrefs = ["\x69\156\144\x65\x78" => url("\151\156\x64\x65\x78\57\x50\162\x6f\147\x72\x65\163\x73\114\157\147\x73\57\x69\156\x64\x65\170", ["\x63\141\164\145\147\157\162\171" => $category, "\145\170\164\145\162\x6e\141\154\111\x64" => $externalId, "\x73\162\143" => $src]), "\x61\x64\x64" => url("\x69\x6e\x64\145\x78\57\x50\x72\157\147\x72\145\x73\163\114\157\147\163\x2f\141\x64\x64", ["\143\141\x74\145\147\x6f\x72\171" => $category, "\x65\x78\164\145\162\x6e\141\x6c\x49\x64" => $externalId, "\x73\x72\143" => $src]), "\144\x65\154\x65\x74\x65" => url("\x69\156\x64\x65\170\57\x50\x72\157\147\x72\145\x73\163\114\157\147\163\57\144\x65\154\145\164\145"), "\141\x74\164\141\x63\150\x6d\145\156\x74\163" => url("\x69\x6e\x64\x65\x78\x2f\x55\160\154\x6f\x61\x64\57\x61\164\164\141\x63\150\145\x73", ["\x73\162\143" => $src, "\x61\x74\x74\141\x63\x68\155\x65\156\x74\x54\171\160\x65" => UploadLogic::ATTACH_PROGRESS_LOGS, "\145\170\164\x65\162\156\x61\x6c\x49\144" => 0, "\165\x69\x53\164\171\154\145" => \app\index\controller\Upload::ATTACHES_UI_LIGHT_STYLE, "\x63\141\154\154\142\x61\x63\153" => "\x70\x72\x6f\x67\162\145\x73\163\114\x6f\147\163\115\x6f\x64\x75\x6c\x65\137" . $uniqid . "\x2e\x6f\x6e\x41\164\x74\x61\143\150\x6d\x65\x6e\x74\x73\125\160\154\157\x61\x64\x65\144"])]; goto QMI4V; KO1bj: $this->assign("\x72\x65\141\144\117\156\x6c\x79", $readOnly); goto s7YXU; ar30i: $search["\x73\x72\143"] = $src; goto wRwyk; zBC8b: $bindValues = ["\x63\165\x72\x44\x61\164\x65" => date("\131\55\155\x2d\144")]; goto CHRPX; Azc8P: return json($progressLogsLogic->load($search, $page, $rows, $sort, $order, $category, $externalId)); goto vIgSf; CHRPX: $this->assign("\142\151\x6e\x64\x56\141\x6c\165\145\x73", $bindValues); goto dXqaT; wV8iz: $this->assign("\163\x72\143", $src); goto zBC8b; wRwyk: $progressLogsLogic = ProgressLogsLogic::newObj(); goto Azc8P; dXqaT: return $this->fetch(); goto aIELj; QMI4V: $this->assign("\x75\162\154\110\162\145\x66\x73", $urlHrefs); goto YYmE1; rXgFx: if (!request()->isPost()) { goto TfUzC; } goto ar30i; s7YXU: $this->assign("\x63\x61\x74\145\x67\x6f\x72\171", $category); goto wV8iz; YYmE1: $this->assign("\165\156\x69\161\151\144", $uniqid); goto KO1bj; aIELj: } public function light($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = "\x70\162\157\147\162\145\163\x73\137\x6c\157\x67\137\x69\x64", $order = "\144\x65\163\143", $category = ProgressLogsLogic::PROGRESS_LOG_ALL_CATEGORY, $externalId = 0, $readOnly = 0, $src = CommonDefs::MODULE_ADMIN) { goto n6FXN; FZ6n7: $this->assign("\162\145\x61\x64\x4f\x6e\x6c\x79", $readOnly); goto HnHk6; t1H4x: $this->assign("\x73\x72\x63", $src); goto lMZAx; UKNxx: $this->assign("\x63\x61\164\145\147\x6f\162\171", $category); goto t1H4x; A5ojF: $urlHrefs = ["\x69\x6e\x64\x65\x78" => url("\151\x6e\x64\x65\170\x2f\120\162\157\147\162\145\163\163\x4c\x6f\x67\163\x2f\151\156\144\x65\170", ["\x63\141\164\145\x67\157\162\x79" => $category, "\x65\170\164\145\x72\x6e\141\x6c\x49\144" => $externalId, "\163\x72\x63" => $src]), "\x61\x64\x64" => url("\151\156\144\x65\x78\x2f\x50\x72\x6f\147\x72\145\163\x73\x4c\x6f\147\163\57\x61\144\144", ["\143\141\164\145\x67\x6f\x72\171" => $category, "\x65\x78\x74\145\x72\156\x61\x6c\111\144" => $externalId, "\163\162\x63" => $src]), "\144\145\154\145\164\145" => url("\x69\x6e\x64\x65\x78\x2f\x50\162\x6f\x67\162\x65\x73\x73\x4c\x6f\x67\163\x2f\144\145\x6c\x65\164\x65")]; goto UKNxx; lMZAx: $this->assign("\165\x72\154\x48\162\145\x66\163", $urlHrefs); goto jUs28; n6FXN: $uniqid = generateUniqid(); goto A5ojF; jUs28: $this->assign("\165\x6e\151\x71\151\x64", $uniqid); goto FZ6n7; HnHk6: return $this->fetch(); goto WZMPJ; WZMPJ: } public function add($category, $externalId, $src = CommonDefs::MODULE_ADMIN) { goto bER_E; B2NZs: $this->assign("\142\151\156\144\x56\141\154\x75\145\163", $bindValues); goto tRv6R; OLKly: Y4nkS: goto UMmXl; otU3l: if ($result) { goto PbDoA; } goto dxiEZ; bF1hK: goto Y4nkS; goto UUQ0k; b_Nu4: $this->assign("\x63\141\164\x65\x67\157\162\171", $category); goto mbxgs; gOaJq: return ajaxSuccess("\xe6\210\x90\345\212\x9f"); goto OLKly; PsWuO: $infos = input("\x70\157\163\164\56\151\x6e\x66\x6f\163\57\x61"); goto Nv46W; Z2J8K: $result = $progressLogsLogic->add($category, $externalId, $infos); goto otU3l; bER_E: if (!$this->request->isPost()) { goto edFmG; } goto PsWuO; j0Iz_: $this->assign("\165\x72\x6c\x48\162\x65\x66\163", $urlHrefs); goto b_Nu4; dxiEZ: return ajaxError("\345\xa4\261\350\xb4\245"); goto bF1hK; lSXuj: $bindValues = ["\x63\165\162\x44\141\164\x65" => date("\131\x2d\155\x2d\144")]; goto B2NZs; oIE33: $this->assign("\x73\165\142\x74\171\160\x65\x73", $subtypes); goto lSXuj; sL0WH: $urlHrefs = ["\141\x74\x74\x61\143\x68\155\x65\x6e\x74\x73" => url("\151\156\144\145\170\57\x55\x70\x6c\157\141\144\57\x61\x74\164\141\143\150\x65\x73", ["\141\x74\164\141\x63\150\x6d\x65\x6e\x74\124\171\x70\145" => UploadLogic::ATTACH_PROGRESS_LOGS, "\163\x72\x63" => $src, "\x65\x78\x74\145\162\x6e\x61\154\x49\144" => 0, "\x75\151\123\164\171\x6c\145" => \app\index\controller\Upload::ATTACHES_UI_LIGHT_STYLE, "\143\141\154\154\x62\141\x63\153" => JVAR . "\x2e\x6f\x6e\x41\164\x74\x61\x63\x68\155\x65\x6e\x74\x73\x55\160\x6c\157\x61\144\145\x64"])]; goto qt4d4; uJZ_F: $uniqid = generateUniqid(); goto yPQmH; Nv46W: $infos["\x73\x72\x63"] = $src; goto MZg8s; MZg8s: $progressLogsLogic = ProgressLogsLogic::newObj(); goto Z2J8K; UUQ0k: PbDoA: goto gOaJq; yPQmH: $this->assign("\165\156\x69\x71\151\x64", $uniqid); goto sL0WH; qt4d4: $subtypes = array_filter(ProgressLogsLogic::$subtypes, function ($v) use($category) { goto wRVeh; GF92i: return true; goto A85qe; wRVeh: if (!($v["\143\141\x74\x65\147\x6f\162\x79"] == $category)) { goto ka9m_; } goto GF92i; A85qe: ka9m_: goto pr2kM; pr2kM: }); goto j0Iz_; UMmXl: edFmG: goto uJZ_F; mbxgs: $this->assign("\x73\162\x63", $src); goto oIE33; tRv6R: return $this->fetch(); goto cbhUz; cbhUz: } public function edit($id, $src = CommonDefs::MODULE_ADMIN) { goto h8eiC; Sh31P: $row = ProgressLogsLogic::I()->get($id); goto AyRE5; XJu2R: $data = input("\x70\157\x73\164\x2e\151\156\146\x6f\x73\57\141"); goto oNCK2; CvBMv: $this->assign("\163\x75\142\x74\x79\x70\x65\163", $subtypes); goto SYYMf; SPoFx: $subtypes = array_filter(ProgressLogsLogic::$subtypes, function ($v) use($category) { goto phM1y; yciTY: r05tp: goto kJSqm; phM1y: if (!($v["\x63\x61\164\x65\x67\157\162\171"] == $category)) { goto r05tp; } goto SetYj; SetYj: return true; goto yciTY; kJSqm: }); goto re2K0; izGso: YTF2s: goto Sh31P; SYYMf: $this->assign("\x61\x74\x74\141\x63\x68\155\145\x6e\x74\x5f\x75\x72\154", url("\x69\156\x64\145\170\x2f\125\160\x6c\157\x61\x64\57\141\164\x74\x61\143\x68\145\163", ["\163\162\143" => $src, "\x61\x74\x74\141\x63\150\155\x65\x6e\164\x54\x79\160\145" => UploadLogic::ATTACH_PROGRESS_LOGS, "\x65\x78\x74\x65\162\156\x61\x6c\x49\144" => $id, "\165\151\123\164\171\x6c\145" => \app\index\controller\Upload::ATTACHES_UI_LIGHT_STYLE])); goto A4JlE; oNCK2: $data["\x65\x78\164\x72\x61\x73"] = empty($data["\x65\x78\x74\x72\141\163"]) ? '' : json_encode($data["\145\x78\164\162\141\x73"], JSON_UNESCAPED_UNICODE); goto w5NF1; h8eiC: if (!$this->request->isPost()) { goto YTF2s; } goto XJu2R; AyRE5: $category = $row["\x63\141\164\x65\x67\157\x72\171"]; goto SPoFx; A4JlE: return $this->fetch(); goto EsDgo; w5NF1: Db::table("\160\x72\157\147\x72\x65\163\x73\x5f\154\x6f\147\163")->where("\160\162\157\x67\162\145\x73\163\137\154\x6f\x67\x5f\x69\x64", $id)->update($data); goto Gycov; re2K0: $this->assign("\162\157\x77", $row); goto CvBMv; Gycov: return ajaxSuccess("\344\xbf\256\xe6\224\xb9\346\x88\220\345\212\x9f"); goto izGso; EsDgo: } public function view($id) { goto qlh0n; ypxvU: $this->assign("\162\157\167", $row); goto JrZFk; SgyQd: return $this->fetch(); goto Rd4q_; JrZFk: $this->assign("\141\x74\164\141\143\x68\155\145\156\164\137\165\162\x6c", url("\x69\x6e\144\x65\x78\57\x55\160\154\x6f\141\x64\x2f\166\151\145\167\101\164\x74\x61\143\x68\145\x73", ["\x61\164\x74\141\x63\150\155\145\156\x74\124\171\160\145" => UploadLogic::ATTACH_PROGRESS_LOGS, "\145\170\164\145\162\156\141\x6c\x49\x64" => $id, "\165\151\123\164\x79\154\145" => \app\index\controller\Upload::ATTACHES_UI_LINK_STYLE])); goto SgyQd; qlh0n: $row = ProgressLogsLogic::I()->get($id); goto ypxvU; Rd4q_: } public function delete($progressLogId) { goto N97Yg; hANUe: return ajaxError("\xe5\xa4\xb1\350\xb4\245"); goto Shxlz; Shxlz: goto sPrvN; goto AbqC4; bcQY5: return ajaxSuccess("\346\210\220\345\212\x9f"); goto BbAYa; BbAYa: sPrvN: goto rCXxn; N97Yg: $progressLogsLogic = ProgressLogsLogic::newObj(); goto C4one; AbqC4: r7rGu: goto bcQY5; C4one: $result = $progressLogsLogic->delete($progressLogId); goto wrFMG; wrFMG: if ($result) { goto r7rGu; } goto hANUe; rCXxn: } }
