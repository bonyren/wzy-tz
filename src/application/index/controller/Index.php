<?php
 namespace app\index\controller; use app\index\logic\UsersFollow; use think\Log; use think\Url; use think\Cookie; use think\Session; use think\captcha\Captcha; use app\index\logic\Defs; use app\index\logic\Admins as AdminsLogic; use app\index\logic\Messages as MessagesLogic; use app\index\logic\Dashboard as DashboardLogic; class Index extends Common { public function sessionLife() { goto lrkNj; sd3U1: return ajaxError("\xe8\xaf\267\345\x85\210\xe7\x99\273\xe5\275\225", $loginUrl); goto FwBJa; FwBJa: IUfel: goto s_XpY; lrkNj: $loginUrl = url("\x69\x6e\144\x65\170\x2f\x49\x6e\x64\x65\170\x2f\x6c\x6f\x67\x69\156"); goto wudHj; wudHj: if (!($this->loginUserId === null)) { goto IUfel; } goto sd3U1; s_XpY: return ajaxSuccess("\346\210\x90\xe5\x8a\237"); goto vSwME; vSwME: } public function clearCache() { rrmdir(TEMP_PATH); return ajaxSuccess("\346\x93\215\xe4\275\234\346\x88\220\xe5\x8a\x9f"); } public function index() { goto lBOGw; lBOGw: $urlHrefs = array("\x6c\x6f\x61\144\x4c\x65\x66\164\x4d\x65\156\x75" => Url::build("\111\x6e\x64\145\170\57\x6c\x6f\x61\144\x4c\145\146\x74\115\145\x6e\x75"), "\154\x6f\147\x6f\x75\x74" => url("\x69\x6e\x64\145\x78\57\111\156\x64\x65\x78\57\154\157\x67\x6f\165\x74"), "\163\145\x73\x73\151\x6f\x6e\114\x69\x66\145" => url("\x69\x6e\x64\x65\170\57\x49\156\144\145\170\x2f\163\145\163\x73\x69\x6f\x6e\x4c\x69\x66\145"), "\143\x6c\145\141\162\103\141\143\150\145" => url("\x69\x6e\144\x65\x78\57\111\x6e\x64\145\170\x2f\143\154\x65\141\162\x43\141\x63\150\145"), "\155\157\144\151\x66\171\120\x77\144" => url("\x69\156\144\x65\x78\57\111\156\144\x65\x78\x2f\x6d\157\144\151\146\x79\120\167\144"), "\155\141\151\x6e" => url("\x69\x6e\x64\x65\x78\57\x49\156\144\x65\x78\x2f\155\x61\x69\156")); goto f6nYf; sGzqA: OLHvn: goto TzEvW; vcXY5: zCYNN: goto JY3f8; TzEvW: $menus = []; goto GB4K1; f6nYf: $loginUserInfos = ["\165\x73\145\x72\x6e\141\x6d\145" => $this->loginUserName, "\162\145\x61\x6c\156\x61\155\145" => $this->loginRealName, "\154\141\x73\x74\154\x6f\x67\151\156\164\151\x6d\145" => $this->loginTime, "\x6c\141\163\164\154\x6f\147\x69\x6e\x69\160" => $this->loginIp, "\x75\x6e\x72\x65\x61\144\x4d\145\x73\x73\x61\x67\145\103\x6f\165\x6e\164" => MessagesLogic::newObj()->unreadCount($this->loginUserId)]; goto T6_L4; mwM3H: if (isMobile()) { goto OLHvn; } goto WAk7d; GB4K1: AdminsLogic::newObj()->loadLeftMenuRecursively(0, '', $menus); goto Xmj1A; T6_L4: $this->assign("\x6c\157\147\151\156\x55\163\145\x72\111\156\x66\157\x73", $loginUserInfos); goto PSsfu; PSsfu: $this->assign("\165\162\x6c\110\x72\x65\146\163", $urlHrefs); goto mwM3H; VTYY5: goto zCYNN; goto sGzqA; Xmj1A: return $this->fetch("\x6d\x6f\x62\x69\x6c\x65", ["\x6d\x65\156\165\163" => $menus]); goto vcXY5; WAk7d: return $this->fetch(); goto VTYY5; JY3f8: } public function loadLeftMenu() { goto QWM5q; FnowX: return json($leftMenuDefs); goto iXL6M; nYTz3: AdminsLogic::newObj()->loadLeftMenuRecursively(0, '', $leftMenuDefs); goto FnowX; QWM5q: $leftMenuDefs = array(); goto nYTz3; iXL6M: } public function main() { goto Rv361; eC5Qw: return $this->fetch(); goto WWtVl; Z77sz: $this->assign("\x75\x72\154\x48\x72\x65\x66\x73", $urlHrefs); goto eC5Qw; cOwxM: $urlHrefs = ["\144\x61\163\150\x62\x6f\141\162\144" => url("\x69\x6e\144\145\x78\57\x44\141\x73\150\x62\x6f\x61\162\x64\57\144\x61\x73\150\142\157\141\162\144"), "\x66\x75\156\x64\x4c\x61\x74\145\163\x74" => url("\151\x6e\x64\145\x78\x2f\x44\x61\x73\x68\142\x6f\x61\x72\x64\x2f\146\165\x6e\144\114\141\164\145\x73\164"), "\145\x6e\x74\145\x72\160\162\151\x73\145\114\141\x74\x65\163\164" => url("\151\156\x64\145\170\x2f\104\x61\163\150\142\157\141\162\x64\57\x65\x6e\x74\145\x72\160\162\151\x73\x65\x4c\141\164\x65\x73\x74"), "\x70\162\157\x6a\145\143\164\105\x76\x65\156\x74\x73" => url("\x45\166\145\156\x74\x4c\157\147\x2f\x67\154\157\142\141\x6c\x73", ["\145\156\164\x69\x74\x79" => Defs::ENTITY_PROJECT]), "\146\x75\x6e\x64\105\166\x65\x6e\x74\x73" => url("\105\x76\x65\156\x74\114\x6f\x67\x2f\147\x6c\157\x62\141\154\x73", ["\145\156\x74\x69\x74\x79" => Defs::ENTITY_FUND])]; goto Z77sz; Rv361: $dashboardLogic = DashboardLogic::newObj(); goto nqISe; qV9pc: $this->assign("\142\151\156\x64\x56\141\154\x75\x65\163", $bindValues); goto cOwxM; nqISe: $bindValues = ["\163\164\141\x74\x69\x73\x74\151\143" => $dashboardLogic->loadStatistic()]; goto qV9pc; WWtVl: } public function timeline() { return json([["\x69\144" => 1, "\x74\151\155\x65" => "\70\346\x9c\x88\x31\70\xe6\227\245", "\x63\x6f\x6e\x74\x65\x6e\x74" => "\x53\101\101\x53\40\xe7\232\x84\xe4\xb8\200\xe5\x88\x87\345\207\x86\345\244\x87\345\267\xa5\xe4\275\x9c\xe4\xbc\274\344\271\x8e\xe9\203\xbd\xe5\267\262\345\210\xb0\344\xbd\215\343\200\202\xe5\x8f\221\345\270\x83\xe4\xb9\x8b\xe5\xbc\246\357\274\214\xe4\xb8\x80\350\247\246\xe5\x8d\xb3\xe5\x8f\x91\343\x80\x82\40\x3c\x62\x72\x3e\344\270\x8d\346\x9e\x89\xe8\277\221\347\231\xbe\xe4\270\xaa\xe6\x97\xa5\346\227\245\xe5\xa4\234\345\xa4\x9c\344\270\216\344\xb9\x8b\344\xb8\272\344\xbc\264\343\200\202\xe5\x9b\240\xe5\xb0\x8f\xe8\200\x8c\xe5\244\xa7\357\xbc\x8c\xe5\233\240\xe5\xbc\xb1\xe8\x80\x8c\345\274\xba\343\200\202"], ["\151\144" => 2, "\164\151\155\x65" => "\70\346\234\210\61\66\346\227\245", "\x63\x6f\x6e\164\x65\x6e\x74" => "\xe8\277\207\345\216\273"], ["\x69\x64" => 3, "\164\x69\x6d\145" => "\x37\xe6\x9c\210\61\66\xe6\227\xa5", "\143\157\x6e\x74\x65\156\164" => "\xe6\234\xaa\xe6\235\xa5"]]); } public function login() { goto YV3nP; CrJGL: Session::delete(["\x6c\x6f\147\151\x6e\137\143\141\x70\x74\143\x68\x61\137\x65\x6e\141\x62\x6c\145", "\x6c\x70"]); goto kqm_A; SFK2d: $username = input("\160\157\163\164\56\165\x73\145\162\156\141\155\x65\57\x73"); goto sYVFQ; mWg1j: OVg6n: goto CrJGL; MfSWG: $adminInfos = $adminsLogic->login($username, $password); goto dB1yC; FiXZt: QRgjA: goto SFK2d; ORRYf: if (!$this->loginUserId) { goto BNoXi; } goto k0hJt; dB1yC: if ($adminInfos) { goto OVg6n; } goto WpcU3; Y7NGA: Cookie::set("\154\157\x67\x69\156\x5f\x70\x61\163\163\167\157\162\x64", base64_encode($password), 3600 * 24 * 30); goto skC7g; DIav6: goto INrJ6; goto ToLAM; zXIwM: return $this->fetch(); goto FiXZt; WpcU3: Session::set("\x6c\x6f\147\x69\x6e\x5f\143\x61\160\x74\143\150\141\x5f\x65\x6e\x61\x62\154\x65", true); goto fIjqG; Ag22u: if ($captchaOk) { goto MUCSv; } goto V_4Ma; LyfoV: Cookie::set("\154\x6f\147\151\x6e\x5f\x73\141\166\145\x5f\x70\x61\163\163\167\157\x72\x64", 0); goto DIav6; YV3nP: if (!request()->isGet()) { goto QRgjA; } goto ORRYf; skC7g: Cookie::set("\154\x6f\147\x69\x6e\x5f\x73\x61\166\145\137\x70\x61\163\x73\167\x6f\162\x64", 1, 3600 * 24 * 30); goto y1JOk; ToLAM: hRWz2: goto qLm61; GGt55: $savePassword = input("\160\x6f\x73\x74\x2e\163\141\166\145\137\160\x61\163\x73\167\x6f\x72\144", null); goto v0uHn; B3TJ3: BNoXi: goto S7BOv; D1spm: Cookie::delete("\154\x6f\x67\x69\156\137\x70\141\163\163\167\x6f\162\144"); goto LyfoV; Cxng_: $captcha = new Captcha(); goto IhK6A; t1tnm: $captchaCode = input("\160\x6f\x73\164\56\143\141\x70\164\143\150\141\57\x73"); goto Cxng_; y1JOk: INrJ6: goto z94QP; syfuh: MUCSv: goto l5xha; V_4Ma: $this->error("\351\xaa\x8c\xe8\xaf\x81\347\240\201\xe9\x94\x99\350\xaf\257"); goto syfuh; k0hJt: $this->redirect("\151\x6e\x64\x65\x78\x2f\x49\x6e\x64\145\170\57\151\156\x64\145\170"); goto B3TJ3; l5xha: doY3e: goto GGt55; IhK6A: $captchaOk = $captcha->check($captchaCode, "\154\157\147\x69\156"); goto Ag22u; kqm_A: if ($savePassword) { goto hRWz2; } goto cDaLP; qLm61: Cookie::set("\154\x6f\x67\x69\x6e\137\165\x73\x65\162\156\141\x6d\145", base64_encode($username), 3600 * 24 * 30); goto Y7NGA; S7BOv: $this->assign("\x6c\157\x67\x69\x6e\x5f\x68\x65\141\144\x6c\151\156\x65", "\347\xae\241\347\x90\x86\xe5\221\230\347\x99\xbb\345\275\225\347\253\257"); goto fqJ8s; uLiMF: if (!Session::get("\x6c\x6f\147\151\156\x5f\x63\x61\160\164\x63\150\141\x5f\x65\156\141\x62\x6c\x65")) { goto doY3e; } goto t1tnm; iT5Lf: $this->assign("\165\x72\154\163", ["\143\x61\160\x74\x63\x68\141" => url("\x69\156\144\x65\170\x2f\x49\156\144\x65\x78\57\x63\x61\160\164\x63\150\x61", ["\x63\157\x64\145\137\x6c\145\x6e" => 4, "\146\x6f\x6e\164\x5f\163\x69\172\145" => 16, "\x77\x69\144\x74\150" => 130, "\x68\x65\x69\x67\150\x74" => 50, "\143\x6f\x64\145" => time()]), "\x6c\157\x67\151\156" => url("\151\156\x64\145\x78\57\111\156\x64\x65\x78\57\x6c\157\x67\x69\156")]); goto zXIwM; sYVFQ: $password = input("\160\157\163\x74\x2e\x70\x61\x73\x73\167\x6f\162\144\57\163"); goto uLiMF; fIjqG: $this->error("\xe7\224\250\346\210\267\345\220\x8d\xe5\257\x86\347\xa0\x81\xe9\x94\x99\350\257\257", "\151\156\144\x65\170\x2f\x49\156\x64\145\x78\x2f\x6c\157\x67\x69\156"); goto mWg1j; cDaLP: Cookie::delete("\x6c\x6f\x67\x69\x6e\137\x75\x73\145\162\156\x61\x6d\x65"); goto D1spm; fqJ8s: $this->assign("\x6c\157\147\151\156\x5f\x63\x61\160\x74\x63\150\x61\137\145\x6e\141\x62\x6c\145", Session::get("\x6c\157\x67\151\156\137\x63\x61\x70\x74\143\150\x61\137\145\156\141\x62\154\145")); goto iT5Lf; z94QP: $this->redirect("\x69\x6e\x64\145\x78\57\111\x6e\x64\145\170\x2f\x69\x6e\x64\145\170"); goto UFOQM; v0uHn: $adminsLogic = AdminsLogic::newObj(); goto MfSWG; UFOQM: } public function logout() { goto fxfTq; fxfTq: $adminsLogic = AdminsLogic::newObj(); goto sak1k; Auu2J: return ajaxSuccess("\346\x88\220\345\x8a\x9f", url("\151\x6e\144\145\x78\x2f\111\156\144\x65\170\x2f\x6c\x6f\147\151\156")); goto d8UTN; sak1k: $adminsLogic->logout(); goto Auu2J; d8UTN: } public function captcha() { goto QxHmN; iPkKa: $captcha->bg = array(255, 255, 255); goto mzyUQ; jthHQ: mSROc: goto zP2mc; vxzG2: CaAm4: goto sJFM6; sJFM6: if (!input("\x67\145\164\x2e\x77\x69\x64\164\x68")) { goto wisO5; } goto SXoGy; mzyUQ: if (!input("\147\145\x74\x2e\143\157\144\x65\137\154\x65\x6e")) { goto kueTO; } goto xC6EY; A7saK: $captcha->imageH = intval(input("\147\x65\164\x2e\150\x65\151\147\150\x74")); goto jthHQ; fbZqV: if (!input("\147\145\164\x2e\x68\145\151\147\150\164")) { goto mSROc; } goto A7saK; BBHqJ: kueTO: goto Rh44H; v3V9E: $captcha->useCurve = false; goto p2fEr; zP2mc: if (!($captcha->imageH <= 0)) { goto QGOvY; } goto aha6K; xC6EY: $captcha->length = intval(input("\147\x65\164\56\x63\157\x64\145\x5f\154\145\156")); goto BBHqJ; tK6ba: if (!input("\x67\x65\x74\56\146\157\x6e\164\x5f\x73\151\x7a\145")) { goto CaAm4; } goto S3Z9D; SXoGy: $captcha->imageW = intval(input("\147\x65\x74\x2e\167\x69\144\x74\150")); goto NKGi4; NKGi4: wisO5: goto uCpWU; PGKYM: return $captcha->entry("\154\x6f\147\x69\x6e"); goto pIjrH; QxHmN: $captcha = new Captcha(); goto v3V9E; t1nlI: $captcha->length = 4; goto k_eJt; Mjlx_: QGOvY: goto PGKYM; S3Z9D: $captcha->fontSize = intval(input("\147\145\164\x2e\146\157\x6e\x74\x5f\163\151\172\x65")); goto vxzG2; uCpWU: if (!($captcha->imageW <= 0)) { goto XvHSa; } goto YPZzf; p2fEr: $captcha->useNoise = false; goto iPkKa; YPZzf: $captcha->imageW = 130; goto wEVV7; k_eJt: pM5zT: goto tK6ba; aha6K: $captcha->imageH = 50; goto Mjlx_; wEVV7: XvHSa: goto fbZqV; Rh44H: if (!($captcha->length > 8 || $captcha->length < 2)) { goto pM5zT; } goto t1nlI; pIjrH: } public function modifyPwd() { goto cqrJa; FgtQo: $adminsLogic = AdminsLogic::newObj(); goto U2cJb; tvEGq: goto bT8i9; goto tJl5o; yEaGi: $adminInfos = $adminsLogic->getAdminInfos($this->loginUserId); goto aK0XY; aK0XY: if ($adminInfos) { goto qiCOn; } goto S2ZH5; tJl5o: O0VXd: goto SKIyq; SKIyq: $adminsLogic->logout(); goto Qz92I; VWACx: if ($result) { goto O0VXd; } goto uQY6g; c8TRq: $adminsLogic = AdminsLogic::newObj(); goto yEaGi; U2cJb: $result = $adminsLogic->modifyAdminPwd($this->loginUserId, $oldPassword, $newPassword); goto VWACx; qTYu1: $oldPassword = input("\x70\157\163\164\x2e\157\154\144\x5f\160\141\163\163\x77\x6f\162\144\x2f\163"); goto PGLAF; xtph4: bT8i9: goto bqWFG; Qz92I: return ajaxSuccess("\163\165\x63\143\x65\163\x73\x66\165\x6c\x2c\40\160\154\145\x61\163\145\40\x6c\x6f\x67\40\151\x6e\x20\141\x67\x61\x69\x6e\40\167\x69\164\150\x20\x6e\x65\x77\40\x70\x61\x73\x73\167\157\162\144", url("\x69\x6e\144\145\x78\x2f\111\x6e\144\x65\170\x2f\x6c\x6f\147\x69\x6e")); goto xtph4; cqrJa: if (!request()->isGet()) { goto aCvtg; } goto c8TRq; uQY6g: return ajaxError("\xe5\xa4\261\350\xb4\245"); goto tvEGq; mCVmg: aCvtg: goto qTYu1; nVf36: $this->assign("\151\156\x66\x6f", ["\165\163\x65\162\x6e\141\x6d\145" => $adminInfos["\x6c\x6f\147\x69\x6e\x5f\x6e\141\155\145"], "\x65\x6d\141\151\x6c" => $adminInfos["\145\155\141\151\154"]]); goto X3nUC; S2ZH5: return $this->fetch("\143\157\x6d\155\x6f\156\x2f\x65\162\x72\x6f\x72"); goto oij2E; PGLAF: $newPassword = input("\x70\x6f\163\164\x2e\x6e\x65\167\x5f\x70\x61\x73\x73\167\x6f\162\x64\x2f\x73"); goto FgtQo; oij2E: qiCOn: goto nVf36; X3nUC: return $this->fetch(); goto mCVmg; bqWFG: } public function follow($target_type, $target_id, $action) { goto MMrdU; MMrdU: if ($action) { goto T0I_c; } goto zxRQ6; QOyva: goto WrY_P; goto qyM6s; Hwca0: WrY_P: goto BxdQZ; BxdQZ: return ajaxSuccess(); goto KViuC; zxRQ6: UsersFollow::I()->cancelFollow($target_type, $target_id); goto QOyva; qyM6s: T0I_c: goto p2VBi; p2VBi: UsersFollow::I()->addFollow($target_type, $target_id); goto Hwca0; KViuC: } }
