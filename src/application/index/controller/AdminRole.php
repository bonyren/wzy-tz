<?php
 namespace app\index\controller; use app\index\service\Authorize; use think\Controller; use think\Log; use think\Debug; use think\Request; use think\Db; use app\common\CommonDefs; class AdminRole extends Common { public function adminRole($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = "\x72\157\154\x65\x5f\x69\144", $order = "\x64\x65\x73\143") { goto D5RyW; e1x70: $order = "\162\x6f\154\x65\x5f\151\x64\x20" . $order; goto r3ejQ; xgL4V: $this->assign("\165\x72\154\x48\x72\145\x66\x73", $urlHrefs); goto cuOZk; S3SrD: qUBjf: goto e1x70; cuOZk: return $this->fetch(); goto Sc38X; IU0Vh: if ($sort == "\162\157\x6c\145\137\x69\144") { goto qUBjf; } goto Ww5GC; Sc38X: bmJhM: goto s1L91; xZIoe: goto dll6Y; goto S3SrD; D5RyW: if (!request()->isGet()) { goto bmJhM; } goto Rte7W; cZgd8: return json(["\164\x6f\164\x61\x6c" => $totalCount, "\x72\x6f\x77\163" => $records]); goto aISpf; sg_ns: $records = Db::table("\141\x64\x6d\151\156\x5f\162\x6f\154\145")->order($order)->limit($limit)->field(true)->select(); goto cZgd8; lBSBQ: $totalCount = Db::table("\141\x64\x6d\151\x6e\x5f\x72\157\154\145")->count(); goto sg_ns; Ww5GC: $order = "\162\157\154\145\x5f\x69\x64\40\144\145\x73\x63"; goto xZIoe; Rte7W: $urlHrefs = ["\141\144\x6d\x69\156\x52\157\x6c\x65" => url("\151\156\144\x65\170\x2f\101\144\155\x69\x6e\x52\157\x6c\145\57\141\144\155\x69\156\x52\157\154\145"), "\x61\x64\x64" => url("\x69\156\x64\145\x78\57\x41\144\155\x69\156\x52\157\154\x65\x2f\141\x64\x64"), "\145\144\x69\x74" => url("\x69\x6e\144\x65\x78\x2f\101\x64\155\151\x6e\122\x6f\x6c\x65\57\145\144\x69\164"), "\144\x65\154\145\164\x65" => url("\x69\156\x64\145\x78\x2f\101\x64\155\x69\156\122\x6f\x6c\x65\57\144\145\154\145\164\x65"), "\x61\x75\164\150\157\162\151\172\x65" => url("\x69\156\x64\145\170\x2f\x41\x64\x6d\151\x6e\122\x6f\154\x65\57\141\x75\164\x68\x6f\x72\151\172\145")]; goto xgL4V; r3ejQ: dll6Y: goto lBSBQ; s1L91: $limit = ($page - 1) * $rows . "\54" . $rows; goto IU0Vh; aISpf: } public function add() { goto GS0gW; oDcs3: $infos = input("\x70\157\x73\164\x2e\151\156\146\x6f\x73\57\141"); goto yyQ5t; nXIhy: return ajaxSuccess("\346\210\220\xe5\212\x9f"); goto kMRO4; nsNvv: return $this->fetch(); goto ukcrW; yyQ5t: Db::table("\x61\x64\155\151\156\137\x72\157\x6c\145")->insert($infos); goto nXIhy; ukcrW: UNhpK: goto oDcs3; GS0gW: if (!request()->isGet()) { goto UNhpK; } goto nsNvv; kMRO4: } public function edit($roleId) { goto rpiAx; CF2kZ: u7eR1: goto CY82r; ZEW0s: Db::table("\141\144\x6d\x69\156\137\x72\x6f\154\145")->where("\162\157\154\x65\137\151\144", $roleId)->update($infos); goto TrC5U; rQAYK: return $this->fetch("\143\x6f\x6d\x6d\157\x6e\x2f\145\x72\162\157\x72"); goto CF2kZ; b2P4p: $infos = input("\160\157\163\x74\56\x69\156\146\x6f\163\x2f\x61"); goto ZEW0s; G2LYw: v7sP6: goto b2P4p; WzYhu: if ($infos) { goto u7eR1; } goto rQAYK; TrC5U: return ajaxSuccess("\346\210\220\xe5\212\237"); goto Q62Zh; dLm6s: return $this->fetch(); goto G2LYw; rpiAx: if (!request()->isGet()) { goto v7sP6; } goto ULbh8; CY82r: $bindValues = ["\151\156\146\x6f\x73" => $infos]; goto x_my2; ULbh8: $infos = Db::table("\x61\x64\155\x69\156\x5f\162\x6f\x6c\145")->where("\162\157\154\x65\137\151\144", $roleId)->field(true)->find(); goto WzYhu; x_my2: $this->assign("\x62\x69\x6e\x64\126\141\154\165\145\163", $bindValues); goto dLm6s; Q62Zh: } public function delete($roleId) { Db::table("\x61\x64\x6d\x69\x6e\x5f\162\x6f\154\145")->where("\x72\x6f\x6c\145\137\151\144", $roleId)->delete(); return ajaxSuccess("\346\x88\x90\xe5\x8a\237"); } public function authorize($roleId) { goto iMsEE; XDxf1: return $this->fetch("\x63\157\x6d\155\x6f\156\x2f\145\x72\x72\x6f\x72"); goto UXHUZ; RGTxj: $this->assign("\x62\x69\156\x64\x56\141\154\x75\145\x73", $bindValues); goto SrnZd; UXHUZ: w95kV: goto oj3HK; B8iWT: $infos = Db::table("\141\144\x6d\151\156\137\162\x6f\x6c\x65")->where("\x72\x6f\x6c\x65\137\151\x64", $roleId)->field(true)->find(); goto Zuyq6; K7iDO: \app\index\service\Authorize::I()->editRoleAuth($roleId, input("\160\x6f\x73\164\x2e")); goto MUob6; iMsEE: if (!request()->isGet()) { goto By3oa; } goto vNEcA; oj3HK: $bindValues = ["\151\x6e\x66\157\x73" => $infos]; goto RGTxj; wYlS5: By3oa: goto K7iDO; MUob6: return ajaxSuccess("\346\x88\x90\xe5\x8a\x9f"); goto Lgb3M; Zuyq6: if ($infos) { goto w95kV; } goto XDxf1; vNEcA: $urlHrefs = ["\162\x6f\154\x65\116\157\x64\145\163" => url("\151\156\x64\x65\170\x2f\x41\144\155\151\156\122\157\x6c\145\x2f\162\x6f\x6c\145\x41\x75\x74\150\124\162\145\145\116\x6f\144\145\163", ["\162\157\154\x65\111\x64" => $roleId])]; goto yJhCP; SrnZd: return $this->fetch(); goto wYlS5; yJhCP: $this->assign("\165\162\x6c\x48\x72\145\x66\x73", $urlHrefs); goto B8iWT; Lgb3M: } protected function loadLeftMenuRecursively($roleId, $pid, &$nodes) { goto fxjCf; HWhw7: return; goto G4cuc; tsvS8: foreach ($rows as $key => $value) { goto oneC5; QzMaR: JkFFc: goto XXIFi; fze0S: $subNodes = array(); goto QjCpY; XYYM2: p3ytm: goto Dpgcd; MjRyQ: $finalNode = array(array("\x69\x64" => $id . "\137" . CommonDefs::AUTHORIZE_READ_ONLY_TYPE, "\x74\145\170\x74" => "\345\217\252\xe8\xaf\xbb", "\x69\143\x6f\x6e\103\x6c\163" => "\x66\x61\40\x66\141\x2d\x65\x79\x65", "\x63\150\145\x63\x6b\145\144" => $roleMenu["\164\171\160\x65"] == CommonDefs::AUTHORIZE_READ_ONLY_TYPE ? true : false), array("\x69\144" => $id . "\137" . CommonDefs::AUTHORIZE_READ_WRITE_TYPE, "\x74\x65\x78\164" => "\xe8\257\xbb\xe5\206\x99", "\x69\143\157\x6e\x43\154\x73" => "\146\141\40\x66\141\x2d\x70\x65\156\x63\151\154", "\x63\150\145\x63\x6b\x65\x64" => $roleMenu["\x74\171\160\145"] == CommonDefs::AUTHORIZE_READ_WRITE_TYPE ? true : false), array("\151\144" => $id . "\x5f" . CommonDefs::AUTHORIZE_LIST_ONLY_TYPE, "\164\x65\170\164" => "\345\x88\227\350\xa1\250", "\151\143\x6f\156\103\154\163" => "\x66\x61\x20\146\x61\x2d\x6c\x69\163\164\x2d\165\x6c", "\143\150\x65\x63\x6b\x65\144" => $roleMenu["\x74\171\160\x65"] == CommonDefs::AUTHORIZE_LIST_ONLY_TYPE ? true : false)); goto KFhWA; KFhWA: $node["\x63\150\151\154\x64\162\x65\156"] = $finalNode; goto XYYM2; WUUdG: goto p3ytm; goto mJig1; Dpgcd: goto JkFFc; goto oCMFO; fvrTN: $node["\x69\x63\x6f\156\103\x6c\163"] = $value["\x69\x63\157\156\x5f\143\x6c\163"]; goto fze0S; UVACd: $node["\151\x64"] = $id; goto g1zEn; wGRdf: $node = array(); goto UVACd; i1j78: AOQXy: goto Fvlnf; a0sZL: $node["\x74\x65\170\x74"] = $value["\156\x61\155\145"]; goto fvrTN; oCMFO: mO2gR: goto Xwzys; XXIFi: $nodes[] = $node; goto i1j78; g1zEn: $node["\x6e\x61\x6d\x65"] = $value["\156\141\155\145"]; goto a0sZL; Xwzys: $node["\143\x68\151\x6c\x64\162\145\156"] = $subNodes; goto QzMaR; iKbje: $roleMenu = \app\index\service\Authorize::I()->check($roleId, $id); goto NJbZq; NJbZq: $node["\151\144"] = ''; goto broAe; Hd1ep: if (!empty($subNodes)) { goto mO2gR; } goto iKbje; QjCpY: $this->loadLeftMenuRecursively($roleId, $id, $subNodes); goto Hd1ep; oneC5: $id = $value["\151\144"]; goto wGRdf; mJig1: q6H3P: goto MjRyQ; IS3pl: $node["\x63\x68\x69\x6c\x64\162\x65\x6e"] = array(array("\x69\144" => $id . "\x5f" . CommonDefs::AUTHORIZE_READ_ONLY_TYPE, "\164\x65\170\164" => "\xe5\217\xaa\xe8\257\xbb", "\151\143\x6f\x6e\103\154\x73" => "\146\x61\x20\x66\141\55\x65\x79\x65"), array("\151\144" => $id . "\x5f" . CommonDefs::AUTHORIZE_READ_WRITE_TYPE, "\164\145\x78\164" => "\350\xaf\xbb\345\x86\x99", "\x69\143\x6f\156\x43\x6c\x73" => "\x66\141\40\146\x61\x2d\160\x65\x6e\143\x69\x6c"), array("\151\144" => $id . "\137" . CommonDefs::AUTHORIZE_LIST_ONLY_TYPE, "\x74\x65\x78\x74" => "\xe5\x88\227\350\xa1\250", "\x69\143\157\x6e\103\154\x73" => "\146\141\40\x66\141\55\154\x69\x73\164\55\165\154")); goto WUUdG; broAe: if ($roleMenu) { goto q6H3P; } goto IS3pl; Fvlnf: } goto QmJse; fxjCf: $rows = Db::table("\155\145\156\x75")->where(array("\x70\x69\144" => $pid))->field("\151\x64\x2c\160\151\144\x2c\x6c\x65\166\x65\x6c\x2c\x6e\x61\155\x65\54\x69\143\157\156\x5f\x63\x6c\163\x2c\x63\x2c\141\54\160\141\x72\141\155\163")->order("\x6f\x72\x64\x65\x72\137\151\x64\40\x41\123\x43")->select(); goto i9Kz5; QmJse: m439u: goto P_qEN; G4cuc: AQ6VP: goto tsvS8; i9Kz5: if (!empty($rows)) { goto AQ6VP; } goto HWhw7; P_qEN: } public function roleAuthTreeNodes($roleId) { goto mA8_v; cyjR1: $this->loadLeftMenuRecursively($roleId, 0, $nodes); goto IVa6H; IVa6H: $returnRows = [["\151\x64" => "\60", "\x74\x65\x78\164" => "\xe6\240\271\350\x8a\x82\347\x82\271", "\x69\x63\x6f\x6e\x43\154\163" => "\146\141\40\146\141\55\x6e\141\x76\151\x63\x6f\x6e", "\143\150\151\154\144\162\x65\156" => $nodes]]; goto dJd4e; mA8_v: $nodes = array(); goto cyjR1; dJd4e: return json($returnRows); goto Z5jwL; Z5jwL: } }
