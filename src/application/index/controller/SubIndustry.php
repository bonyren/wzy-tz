<?php
 namespace app\index\controller; use app\index\logic\Enterprise; use app\index\logic\SubIndustryLogic; use think\Db; class SubIndustry extends Common { public function index($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS) { goto zE8LM; jPnFK: return json($data); goto yqNvr; aBbMf: U1t0T: goto apREu; zE8LM: if (!$this->request->isGet()) { goto U1t0T; } goto EMBY3; EMBY3: return $this->fetch(); goto aBbMf; apREu: $data = SubIndustryLogic::I()->load($search, $page, $rows); goto jPnFK; yqNvr: } public function edit($id = 0) { goto lnPlc; awvKb: IeLPU: goto krhGi; NcLMM: $row = SubIndustryLogic::I()->getRow($id); goto t7YP6; krhGi: $data = input("\160\157\163\164\x2e\x64\141\164\141\57\x61"); goto t8Sba; R60Vu: return $this->fetch("\141\144\x64"); goto WcZV2; lnPlc: if (!$this->request->isGet()) { goto IeLPU; } goto h2FqC; t7YP6: $this->assign("\162\157\167", $row); goto fhkKt; fLMIR: RsEeO: goto R60Vu; ryoPr: return ajaxSuccess("\344\xbf\235\345\xad\230\xe6\210\x90\xe5\212\237"); goto RBpu8; h2FqC: if (empty($id)) { goto RsEeO; } goto NcLMM; t8Sba: try { SubIndustryLogic::I()->saveRow($id, $data); } catch (\Exception $e) { return ajaxError($e->getMessage()); } goto ryoPr; fhkKt: return $this->fetch(); goto NlNSr; WcZV2: X6wtW: goto awvKb; NlNSr: goto X6wtW; goto fLMIR; RBpu8: } public function delete($id) { try { SubIndustryLogic::I()->delete($id); } catch (\Exception $e) { return ajaxError($e->getMessage()); } return ajaxSuccess("\345\x88\xa0\351\231\xa4\xe6\x88\x90\345\x8a\237"); } public function enterprises($iid, $readonly = 0) { goto dMkS9; xud4t: $rows = Db::table("\163\165\142\x5f\x69\x6e\144\165\x73\x74\x72\171\137\x65\x6e\x74\145\162\x70\162\x69\x73\145")->alias("\x69\x65")->join("\x65\156\164\x65\162\x70\x72\151\x73\x65\163\x20\x65", "\x65\x2e\151\x64\x3d\x69\145\x2e\x65\151\144")->field("\151\x65\x2e\x2a\54\x65\56\156\x61\155\x65")->where(["\151\145\56\x69\x69\144" => $iid])->order("\x69\x65\x2e\x73\157\x72\164\40\141\163\143\x2c\x69\145\56\151\x64\x20\141\x73\143")->select(); goto beEwa; beEwa: return json($rows ? $rows : []); goto d0qgb; D2ZDz: GSOL1: goto xud4t; pYEIY: $this->assign("\x69\x69\144", $iid); goto geUDo; Q8ibm: return $this->fetch(); goto D2ZDz; dMkS9: if (!$this->request->isGet()) { goto GSOL1; } goto pYEIY; geUDo: $this->assign("\x72\x65\x61\x64\157\156\154\171", $readonly); goto Q8ibm; d0qgb: } public function addEnterprises($iid, $eids) { SubIndustryLogic::I()->addEnterprises($iid, $eids); return ajaxSuccess("\xe6\267\273\345\x8a\240\346\x88\220\345\x8a\x9f"); } public function setEnterprise($id) { goto QLiRU; tOeIC: return $this->fetch(); goto rocLJ; R9zyc: $data = input("\160\157\163\164\x2e\144\141\x74\x61\57\141"); goto imDHw; imDHw: Db::table("\x73\x75\x62\x5f\151\156\144\x75\x73\x74\162\x79\137\145\156\x74\145\x72\160\x72\151\x73\x65")->where(["\x69\144" => $id])->update($data); goto LGN_K; rocLJ: c7S8c: goto R9zyc; QLiRU: if (!$this->request->isGet()) { goto c7S8c; } goto d7u1u; YMHJY: $this->assign("\x72\x6f\x77", $row); goto tOeIC; LGN_K: return ajaxSuccess("\344\xbf\235\345\xad\x98\346\x88\x90\xe5\212\237"); goto cb1hr; d7u1u: $row = Db::table("\163\x75\x62\137\x69\156\x64\165\163\x74\162\171\137\x65\156\x74\145\162\x70\162\151\x73\145")->alias("\x69\x65")->join("\x65\156\164\x65\x72\x70\x72\151\163\145\163\x20\x65", "\x65\x2e\151\x64\x3d\x69\x65\x2e\145\151\x64")->field("\151\x65\56\x2a\x2c\x65\56\x6e\x61\x6d\x65")->where(["\x69\145\56\151\144" => $id])->find(); goto YMHJY; cb1hr: } public function delEnterprises($id) { Db::table("\x73\x75\x62\137\151\156\144\x75\163\164\162\x79\x5f\x65\156\x74\145\x72\x70\x72\x69\163\145")->where(["\x69\144" => $id])->delete(); return ajaxSuccess("\xe5\x88\xa0\351\231\244\xe6\x88\x90\345\x8a\237"); } public function chain($subIndustryId) { goto pXy2z; CX4ZF: $this->assign("\165\162\154\110\162\145\146\163", $urlHref); goto MWDro; cX01q: return $this->fetch(); goto Suyus; pXy2z: if (!request()->isGet()) { goto Fwep4; } goto HLXjb; HLXjb: $urlHref = ["\x73\x75\142\111\156\x64\x75\163\164\x72\x79\103\150\x61\151\156" => url("\151\156\144\x65\x78\x2f\123\165\x62\111\x6e\x64\x75\x73\x74\x72\x79\57\143\x68\141\x69\x6e", ["\163\x75\142\x49\x6e\144\x75\x73\x74\162\x79\111\144" => $subIndustryId]), "\163\165\142\x49\156\144\x75\x73\x74\x72\x79\103\150\141\x69\156\x41\144\144" => url("\151\156\144\145\170\x2f\123\165\142\x49\156\144\165\163\164\x72\x79\x2f\143\x68\141\151\156\101\144\x64", ["\163\x75\142\111\156\x64\x75\163\164\x72\171\111\144" => $subIndustryId]), "\x73\x75\142\x49\156\x64\165\163\164\162\x79\x43\x68\141\x69\x6e\x55\x70\x64\x61\164\145" => url("\151\156\144\x65\x78\57\x53\x75\142\x49\156\x64\165\x73\x74\162\171\x2f\x63\150\141\x69\156\125\160\144\x61\x74\145"), "\x73\165\142\111\156\144\165\x73\164\162\171\103\150\141\151\156\x44\x65\154\145\x74\x65" => url("\151\x6e\144\x65\x78\57\x53\165\142\111\x6e\144\165\x73\x74\162\x79\x2f\x63\x68\141\x69\156\104\145\x6c\x65\x74\x65"), "\163\x75\x62\111\156\x64\x75\x73\x74\162\x79\x43\x68\x61\x69\x6e\105\156\164\145\x72\160\162\x69\163\x65\x73" => url("\151\156\144\x65\x78\57\123\x75\x62\x49\156\x64\x75\163\164\162\x79\57\x63\150\x61\151\156\x45\156\x74\145\162\x70\162\151\x73\x65\163", ["\163\x75\x62\x49\x6e\144\x75\x73\164\162\x79\111\x64" => $subIndustryId]), "\163\x75\x62\111\x6e\x64\165\x73\x74\162\171\103\150\x61\151\x6e\x45\x6e\164\x65\x72\x70\162\x69\x73\145\x41\x64\x64" => url("\151\x6e\x64\x65\170\x2f\x53\165\x62\x49\156\144\165\x73\x74\x72\x79\57\x63\150\x61\151\156\x45\156\x74\x65\162\x70\162\x69\163\145\x41\144\144"), "\x73\x75\x62\111\156\x64\x75\x73\164\x72\171\x43\150\x61\x69\156\105\x6e\x74\145\162\x70\162\x69\x73\145\104\145\154\x65\x74\145" => url("\x69\x6e\x64\145\170\x2f\123\x75\142\111\x6e\144\x75\163\164\162\171\57\x63\x68\141\151\x6e\105\x6e\x74\x65\x72\x70\162\151\163\145\x44\145\x6c\x65\164\x65")]; goto CX4ZF; Suyus: Fwep4: goto qrqGT; qrqGT: return json(SubIndustryLogic::I()->loadChainTreeDatas($subIndustryId, 0, false)); goto CWrCa; MWDro: $this->assign("\x73\165\142\111\156\144\x75\163\x74\162\x79\x49\144", $subIndustryId); goto cX01q; CWrCa: } public function chainAdd($subIndustryId, $parentId) { goto BnMe3; UOsJZ: $result = SubIndustryLogic::I()->addChain($subIndustryId, $name, $parentId); goto vG8GO; yH04h: z1EhH: goto QfoUC; doaja: return ajaxError("\346\267\273\345\x8a\xa0\345\244\261\350\xb4\245"); goto wb0o5; kko19: return ajaxSuccess("\xe6\267\xbb\345\x8a\xa0\xe6\210\x90\xe5\x8a\237"); goto yH04h; BnMe3: $name = input("\160\157\x73\x74\56\156\141\x6d\145"); goto UOsJZ; wb0o5: goto z1EhH; goto vVv4p; vG8GO: if ($result) { goto b0OX9; } goto doaja; vVv4p: b0OX9: goto kko19; QfoUC: } public function chainUpdate($subIndustryChainId) { goto cTBwF; cTBwF: $name = input("\x70\157\x73\x74\x2e\x6e\x61\155\145"); goto t9Zgu; srzt4: br0vv: goto PMHDE; q8R6X: goto br0vv; goto az6Pw; FqXvI: if ($result) { goto WxbvE; } goto Gca77; az6Pw: WxbvE: goto AXeUX; t9Zgu: $result = SubIndustryLogic::I()->updateChain($subIndustryChainId, $name); goto FqXvI; AXeUX: return ajaxSuccess("\xe4\xbf\xae\346\224\xb9\xe6\x88\x90\xe5\212\237"); goto srzt4; Gca77: return ajaxError("\344\xbf\xae\xe6\x94\271\xe5\xa4\xb1\xe8\264\xa5"); goto q8R6X; PMHDE: } public function chainDelete($subIndustryChainId) { goto aJAcm; Np3qY: uUc6F: goto nclrv; qu4UF: if ($result) { goto uUc6F; } goto P983A; Yxuns: goto mmtnI; goto Np3qY; aJAcm: $result = SubIndustryLogic::I()->deleteChain($subIndustryChainId); goto qu4UF; P983A: return ajaxError("\xe5\x88\240\351\231\244\xe5\244\261\350\xb4\xa5\357\xbc\x8c\350\257\267\345\x85\210\xe5\210\xa0\351\x99\244\xe8\257\245\350\212\x82\347\x82\271\344\270\x8b\347\x9a\204\345\205\263\xe8\201\x94\344\274\x81\xe4\xb8\x9a"); goto Yxuns; h2vtm: mmtnI: goto woKDP; nclrv: return ajaxSuccess("\xe5\210\240\xe9\x99\xa4\xe6\x88\220\xe5\212\x9f"); goto h2vtm; woKDP: } public function chainEnterprises($subIndustryId, $subIndustryChainId = 0) { goto BVMIS; v1K6L: foreach ($rows as &$row) { goto A8unm; j54z4: $chainId = $chain["\160\141\162\x65\x6e\164\x5f\x69\144"]; goto BXNFw; kDVc3: if (!$chainPositionName) { goto z7_j5; } goto vZXXp; N9hUn: if ($chain) { goto GdwMf; } goto bAaXR; oPUbD: $chain = Db::table("\163\x75\142\x5f\x69\156\x64\x75\163\x74\x72\171\137\143\x68\x61\151\x6e")->where(["\x69\x64" => $chainId])->field(true)->find(); goto N9hUn; vTQYd: GdwMf: goto kDVc3; BK51H: z7_j5: goto m_iLm; m_iLm: $chainPositionName = $chain["\156\141\x6d\145"]; goto pdxyS; A8unm: $chainId = $row["\163\x75\x62\137\x69\x6e\x64\x75\163\x74\x72\x79\137\143\x68\141\x69\156\x5f\x69\x64"]; goto EvdNF; Vu3B9: X0RaW: goto As2sS; EvdNF: $chainPositionName = ''; goto Vu3B9; x_vzi: goto w02Kr; goto BK51H; BXNFw: goto X0RaW; goto CMayz; bAaXR: goto FQZQ2; goto vTQYd; YNuuE: rbd0p: goto a7UB0; CMayz: FQZQ2: goto QEDw2; vZXXp: $chainPositionName = $chain["\156\x61\155\145"] . "\x2d\76" . $chainPositionName; goto x_vzi; As2sS: if (!$chainId) { goto FQZQ2; } goto oPUbD; QEDw2: $row["\143\x68\x61\x69\156\x5f\x70\157\x73\x69\164\151\157\x6e"] = $chainPositionName; goto YNuuE; pdxyS: w02Kr: goto j54z4; a7UB0: } goto mazVR; XNinl: AHcrM: goto Daiek; rUeyW: $rows = Db::table("\x73\x75\x62\x5f\x69\x6e\x64\165\163\164\x72\171\x5f\143\x68\x61\151\x6e\x5f\x65\x6e\164\145\162\x70\x72\x69\163\145")->alias("\151\x65")->join("\145\156\x74\x65\x72\x70\x72\x69\163\145\163\40\145", "\145\56\151\x64\x3d\151\x65\56\145\151\144")->field("\x69\x65\56\x2a\x2c\145\x2e\156\141\x6d\145")->where(["\x69\145\x2e\163\x75\142\x5f\151\156\144\x75\163\164\x72\x79\x5f\143\150\141\151\156\137\x69\x64" => $subIndustryChainId])->order("\x69\145\56\151\x64\40\x61\x73\143")->select(); goto lisUv; BVMIS: if ($subIndustryChainId == 0) { goto AHcrM; } goto rUeyW; lisUv: goto evMjg; goto XNinl; mazVR: rlfR9: goto C9sVV; C9sVV: return json($rows); goto sSSed; DBfA8: evMjg: goto v1K6L; Daiek: $rows = Db::table("\163\165\x62\137\151\x6e\x64\x75\x73\164\162\171\137\143\150\x61\151\x6e\137\x65\156\164\145\162\160\x72\151\163\x65")->alias("\151\x65")->join("\163\165\x62\137\151\156\144\x75\163\164\x72\x79\137\143\150\x61\151\x6e\x20\x73\x69", "\151\x65\x2e\163\165\x62\137\151\156\144\x75\x73\164\162\x79\137\143\150\x61\x69\156\137\x69\144\x3d\163\151\56\x69\x64")->join("\x65\156\x74\x65\162\x70\x72\x69\163\x65\x73\x20\x65", "\x65\x2e\x69\x64\75\x69\x65\x2e\x65\151\x64")->field("\x69\x65\x2e\52\x2c\145\56\156\x61\x6d\x65")->where(["\x73\151\x2e\163\x75\142\x5f\151\x6e\144\x75\163\164\x72\171\x5f\x69\144" => $subIndustryId])->order("\x69\x65\56\x69\x64\40\141\163\143")->select(); goto DBfA8; sSSed: } public function chainEnterpriseAdd($subIndustryChainId, $eids) { goto dUeLl; RBLiq: $eids = explode("\54", $eids); goto i6wiP; C21Ln: return ajaxSuccess("\346\xb7\xbb\xe5\212\240\346\x88\220\xe5\x8a\x9f"); goto K4kpp; i6wiP: foreach ($eids as $eid) { goto B67EC; aL0Li: Db::table("\163\x75\142\x5f\x69\156\144\165\163\x74\x72\171\137\x63\x68\141\x69\156\137\x65\156\164\x65\162\160\162\x69\x73\x65")->insert(["\x73\165\142\x5f\x69\x6e\x64\x75\x73\x74\x72\171\x5f\x63\x68\x61\151\156\x5f\151\x64" => $subIndustryChainId, "\x65\151\x64" => $eid]); goto NyZ65; qP3IM: if ($record) { goto AdwJ7; } goto aL0Li; NyZ65: AdwJ7: goto YgZdy; YgZdy: O3rhc: goto NOvAd; B67EC: $record = Db::table("\x73\x75\x62\137\151\156\144\x75\x73\164\162\171\137\x63\150\141\151\156\137\x65\x6e\164\145\162\x70\x72\151\163\x65")->where(["\x73\x75\x62\137\151\156\x64\165\x73\164\162\x79\x5f\143\x68\x61\151\x6e\x5f\x69\144" => $subIndustryChainId, "\x65\151\x64" => $eid])->find(); goto qP3IM; NOvAd: } goto iVNxZ; iVNxZ: J6iJf: goto C21Ln; dUeLl: if (!empty($eids)) { goto aFF5O; } goto XNEwj; nqCaV: aFF5O: goto RBLiq; XNEwj: return ajaxError("\xe9\x9d\x9e\xe6\xb3\225\xe5\x8f\202\xe6\225\260"); goto nqCaV; K4kpp: } public function chainEnterpriseDelete($id) { Db::table("\x73\x75\x62\137\151\x6e\x64\x75\x73\x74\162\171\x5f\x63\150\x61\x69\x6e\137\x65\x6e\164\x65\x72\x70\162\x69\x73\145")->where("\x69\x64", $id)->delete(); return ajaxSuccess("\xe5\210\240\xe9\231\244\xe6\210\x90\xe5\x8a\237"); } public function chainGraph($industry_id) { goto JvT1W; HvkC9: PbSLx: goto nLsOc; JAK70: $this->treeData($industry_id, $top["\x63\150\x69\154\x64\x72\145\156"], 1); goto VrYi8; JvT1W: if (!$this->request->isGet()) { goto PbSLx; } goto V3Cdd; nLsOc: $top = SubIndustryLogic::I()->getRow($industry_id); goto JAK70; VrYi8: return json($top); goto vmKHu; V3Cdd: return $this->fetch(); goto HvkC9; vmKHu: } private function treeData($industry_id, &$rows = array(), $init = 0) { goto KZJri; miK5j: if (!empty($rows)) { goto DPfWx; } goto nMZEj; QuiCy: return; goto xYTJV; nMZEj: $rows = []; goto QuiCy; KZJri: if (!$init) { goto u4e0O; } goto f7z0x; PnmEx: u4e0O: goto rUHRb; f7z0x: $rows = Db::table("\163\165\x62\x5f\151\x6e\x64\165\163\164\162\x79\x5f\x63\x68\141\x69\x6e")->where(["\x73\165\142\x5f\x69\x6e\x64\x75\x73\164\x72\x79\137\151\144" => $industry_id, "\160\141\x72\x65\156\164\137\151\x64" => 0])->field("\151\x64\54\156\x61\155\x65")->order("\x69\144\40\x61\163\143")->select(); goto miK5j; rUHRb: foreach ($rows as $k => $v) { goto Ovgyp; RuGNb: if (empty($companies)) { goto uCHsz; } goto KrKM9; FhDah: goto hDRaa; goto i6_4m; Qqc73: jiIMw: goto zN7m0; pGGkx: $rows[$k]["\143\x68\x69\154\x64\x72\x65\x6e"] = []; goto FY5UJ; s5P6S: if (empty($childs)) { goto Z2Pad; } goto dYK1L; KrKM9: $txt = array_slice($companies, 0, 4); goto iFty7; i6_4m: uCHsz: goto pGGkx; J_ReW: goto jiIMw; goto pvpVD; zN7m0: y7zmP: goto Jj0b4; hzibK: $rows[$k]["\x63\150\x69\x6c\144\x72\x65\156"] = [["\x69\x64" => $v["\151\x64"] . "\x2d\x63\157\x6d\x70\141\x6e\151\x65\163", "\x74\171\x70\x65" => "\143\x6f\x6d\x70\x61\156\171", "\156\141\x6d\x65" => $txt]]; goto FhDah; MxKbk: $childs = Db::table("\x73\165\142\137\x69\156\144\x75\163\164\x72\171\137\143\x68\x61\x69\156")->where(["\163\165\142\137\151\156\x64\x75\x73\164\162\171\137\x69\x64" => $industry_id, "\160\141\162\145\x6e\x74\137\x69\144" => $v["\151\144"]])->field("\151\144\54\156\x61\155\x65")->order("\151\144\x20\141\x73\x63")->select(); goto s5P6S; FY5UJ: hDRaa: goto Qqc73; pvpVD: Z2Pad: goto k3Hze; dYK1L: $rows[$k]["\x63\x68\151\x6c\144\162\145\156"] = $childs; goto SdYo9; k3Hze: $companies = Db::table("\x73\165\142\x5f\x69\x6e\144\x75\x73\164\162\171\x5f\x63\150\x61\151\x6e\137\x65\156\x74\145\162\x70\x72\x69\x73\x65")->alias("\143")->join("\145\156\x74\x65\162\160\x72\151\x73\x65\x73\40\145", "\145\x2e\x69\144\x3d\143\56\145\151\x64")->where(["\143\56\163\x75\x62\137\x69\x6e\144\165\x73\x74\162\x79\x5f\143\x68\x61\x69\x6e\x5f\x69\x64" => $v["\x69\x64"]])->column("\156\141\155\x65"); goto RuGNb; Ovgyp: $rows[$k]["\164\171\x70\145"] = "\151\x6e\144\165\x73\164\162\171"; goto MxKbk; iFty7: $txt = join("\xe3\x80\x81", $txt) . (isset($companies[4]) ? "\x2e\56\56" : ''); goto hzibK; SdYo9: $this->treeData($industry_id, $rows[$k]["\143\150\151\154\x64\x72\x65\156"]); goto J_ReW; Jj0b4: } goto FnfFA; FnfFA: BuaIf: goto Hx7s1; xYTJV: DPfWx: goto PnmEx; Hx7s1: } }
