<?php
 namespace app\index\controller; use app\index\logic\Defs; use app\index\model\Attachments; use think\image\Exception; use think\Log; use think\Db; use think\Image; use app\index\service\EventLogs; use app\common\CommonDefs; use app\index\logic\Upload as UploadLogic; class Upload extends Common { public function pdf($url) { $this->assign("\x75\162\x6c", $url); return $this->fetch(); } public function pdfjs($url) { $this->assign("\x75\162\154", $url); return $this->fetch(); } const ATTACHES_UI_BIG_STYLE = 1; const ATTACHES_UI_LIGHT_STYLE = 2; const ATTACHES_UI_TABLE_STYLE = 3; const ATTACHES_UI_DATAGRID_STYLE = 4; const ATTACHES_UI_LINK_STYLE = 5; public function upload() { goto fQeHx; j3eN1: if ($originalError == UPLOAD_ERR_INI_SIZE || $originalError == UPLOAD_ERR_FORM_SIZE) { goto YEMSE; } goto DIQOq; NHNPo: $originalName = $uploadInfo["\x6e\x61\x6d\145"]; goto gHt4P; nVPR7: CXhBv: goto vxn3a; WY0_o: $saveName = $fileInfo->getSaveName(); goto blRhc; GRoNk: $errorDesc = "\105\170\x63\x65\145\144\145\x64\x20\x66\151\x6c\145\x73\x69\x7a\x65\40\x6c\x69\x6d\151\164\40" . config("\165\x70\x6c\157\141\x64\137\155\141\x78\137\146\151\x6c\x65\163\x69\x7a\x65") . "\56"; goto TOcCc; hiOgW: $errorDesc = "\x4e\157\40\x66\151\154\x65\40\163\x65\156\x74\56"; goto nVPR7; D6hLT: goto Xxujk; goto oba54; tS5Ap: uploadError("\146\141\151\x6c\x65\x64\x20\x74\157\x20\x67\x65\x74\40\164\150\145\40\165\160\154\x6f\x61\144\40\x66\x69\154\x65"); goto k2d4r; pDlHn: uploadSuccess("\163\165\x63\x63\x65\163\x73", ["\x6f\x72\x69\147\x69\156\x61\x6c\x5f\156\x61\x6d\x65" => $originalName, "\163\x61\166\x65\x5f\x6e\141\x6d\x65" => $saveName, "\165\162\154" => $url, "\x72\145\154\141\x74\x69\166\x65\137\x75\x72\154" => $relativeUrl, "\x61\x62\163\157\x6c\x75\x74\145\137\165\x72\154" => $absoluteUrl]); goto KJIYh; gHt4P: $originalType = $uploadInfo["\x74\171\160\145"]; goto irucg; vxn3a: uploadError("\146\141\151\x6c\x65\x64\x20\x74\157\40\x75\160\x6c\x6f\x61\x64\x20\x66\151\154\145\x2c\40\143\x61\165\163\145\x3a\40" . $errorDesc); goto Hj5X3; q9DDD: $originalError = $uploadInfo["\x65\162\162\x6f\x72"]; goto xtytD; ZPBbU: goto CXhBv; goto DjVZu; ZFSb0: $originalTmpName = $uploadInfo["\164\x6d\x70\x5f\x6e\141\155\x65"]; goto q9DDD; xtytD: if (!($originalError != UPLOAD_ERR_OK)) { goto RQJnF; } goto xluBl; wO_xy: WHts4: goto WY0_o; TOcCc: Xxujk: goto ZPBbU; fQeHx: $file = request()->file("\165\160\x6c\x6f\x61\144"); goto IFXqk; xluBl: $errorDesc = ''; goto GUkgT; GUkgT: if ($originalError == UPLOAD_ERR_NO_FILE) { goto ZaU_e; } goto j3eN1; oba54: YEMSE: goto GRoNk; DIQOq: $errorDesc = "\125\x6e\x6b\x6e\157\167\x6e\x20\145\x72\162\157\162\163\56"; goto D6hLT; DjVZu: ZaU_e: goto hiOgW; FFFCD: $absoluteUrl = convertUploadSaveName2AbsoluteUrl($saveName); goto pDlHn; K49vc: $fileInfo = $file->move(UPLOAD_DIR); goto GKPH2; n5s4a: $relativeUrl = convertUploadSaveName2RelativeUrl($saveName); goto FFFCD; IFXqk: if (!($file == null)) { goto TMmft; } goto tS5Ap; GKPH2: if (!($fileInfo == null)) { goto WHts4; } goto W1gBw; Hj5X3: RQJnF: goto K49vc; k2d4r: TMmft: goto o1vIC; irucg: $originalSize = $uploadInfo["\163\151\x7a\x65"]; goto ZFSb0; W1gBw: uploadError("\xe5\244\xb1\xe8\264\xa5\x20\x2d\40" . $file->getError()); goto wO_xy; o1vIC: $uploadInfo = $file->getInfo(); goto NHNPo; blRhc: $url = convertUploadSaveName2FullUrl($saveName); goto n5s4a; KJIYh: } public function uploadImage() { goto qWjeH; Qqq7u: kbI8g: goto l2f1d; KBpa9: $fileInfo = $file->validate(["\145\x78\x74" => "\x6a\x70\147\x2c\160\156\147\54\147\x69\146\x2c\x6a\160\x65\147"])->move(UPLOAD_DIR); goto MmlB5; jcY1q: uploadSuccess("\163\x75\x63\143\145\x73\x73", ["\x6f\162\x69\x67\x69\x6e\x61\154\137\x6e\x61\155\x65" => $originalName, "\163\141\x76\x65\137\156\141\x6d\x65" => $saveName, "\x75\162\154" => $url, "\162\145\154\141\164\151\x76\x65\137\165\x72\x6c" => $relativeUrl, "\x61\x62\163\157\x6c\x75\164\x65\137\165\x72\154" => $absoluteUrl]); goto VMjwJ; ZMUMt: if ($originalError == UPLOAD_ERR_INI_SIZE || $originalError == UPLOAD_ERR_FORM_SIZE) { goto vzWUH; } goto hvpcM; C1G2n: if ($originalError == UPLOAD_ERR_NO_FILE) { goto kbI8g; } goto ZMUMt; u2wR3: uploadError("\146\x61\x69\154\x65\144\40\x74\x6f\x20\x67\145\x74\40\x74\150\x65\x20\x75\160\x6c\x6f\141\x64\x20\x66\151\154\145"); goto B39LH; MmlB5: if (!($fileInfo == null)) { goto qah_m; } goto Ms9Pq; IoUC6: qah_m: goto xXG58; UKCON: $url = convertUploadSaveName2FullUrl($saveName); goto a9l3Y; a9l3Y: $relativeUrl = convertUploadSaveName2RelativeUrl($saveName); goto kVbWE; QAml0: $errorDesc = ''; goto C1G2n; l2f1d: $errorDesc = "\116\157\x20\146\x69\154\x65\x20\163\x65\x6e\x74\56"; goto QHb1r; Zeh1Z: $uploadInfo = $file->getInfo(); goto igwRt; wAClx: goto v2nSI; goto Qqq7u; B39LH: DJpYl: goto Zeh1Z; Q8_Sy: $originalError = $uploadInfo["\x65\162\162\x6f\x72"]; goto yYnMp; q0kFQ: if (!($file == null)) { goto DJpYl; } goto u2wR3; qWjeH: $file = request()->file("\x75\160\x6c\157\x61\x64"); goto q0kFQ; fuDJO: $errorDesc = "\x45\170\143\145\x65\x64\145\144\x20\146\x69\x6c\145\163\151\x7a\x65\x20\x6c\151\x6d\x69\164\x20" . config("\x75\x70\154\x6f\x61\x64\137\155\x61\170\x5f\146\x69\x6c\x65\x73\x69\172\x65") . "\56"; goto QzqmL; VghZY: $originalType = $uploadInfo["\164\x79\x70\x65"]; goto BSvPB; yYnMp: if (!($originalError != UPLOAD_ERR_OK)) { goto z7iaO; } goto QAml0; igwRt: $originalName = $uploadInfo["\156\x61\155\x65"]; goto VghZY; Ms9Pq: uploadError("\345\244\xb1\xe8\xb4\xa5\x20\55\40" . $file->getError()); goto IoUC6; kVbWE: $absoluteUrl = convertUploadSaveName2AbsoluteUrl($saveName); goto jcY1q; vHSOz: uploadError("\146\x61\x69\154\x65\144\x20\x74\x6f\40\165\x70\x6c\x6f\x61\x64\40\x66\x69\x6c\145\54\x20\143\x61\165\163\145\x3a\40" . $errorDesc); goto Ddz0C; Ddz0C: z7iaO: goto KBpa9; xXG58: $saveName = $fileInfo->getSaveName(); goto UKCON; pGvhp: goto vFIR5; goto Duz49; QzqmL: vFIR5: goto wAClx; Duz49: vzWUH: goto fuDJO; QHb1r: v2nSI: goto vHSOz; BSvPB: $originalSize = $uploadInfo["\x73\151\x7a\x65"]; goto orGQL; hvpcM: $errorDesc = "\x55\156\x6b\x6e\157\x77\156\x20\x65\x72\x72\157\162\x73\56"; goto pGvhp; orGQL: $originalTmpName = $uploadInfo["\164\155\160\137\x6e\x61\155\145"]; goto Q8_Sy; VMjwJ: } public function uploadImageFromCKEditor($CKEditorFuncNum) { goto Y3x_B; JTN0d: echo "\167\151\156\144\x6f\167\56\x70\x61\162\145\x6e\164\56\x43\x4b\105\104\111\x54\117\122\x2e\x74\157\x6f\x6c\x73\56\x63\x61\x6c\154\106\165\156\x63\x74\151\157\x6e\50" . $CKEditorFuncNum . "\x2c\47\47\x2c" . "\47\146\x61\x69\154\x65\144\40\164\x6f\x20\162\x65\143\x65\x69\x76\x65\40\164\x68\x65\x20\x66\151\154\145\x27\51\x3b"; goto CLOrg; EjNci: $saveName = $fileInfo->getSaveName(); goto SLtRE; r3CUv: echo "\x77\x69\156\x64\x6f\x77\56\x70\x61\162\145\x6e\x74\x2e\103\x4b\x45\x44\x49\124\x4f\122\56\x74\157\157\x6c\163\x2e\x63\x61\154\x6c\x46\165\156\x63\164\151\x6f\156\50" . $CKEditorFuncNum . "\x2c\x27\47\x2c" . "\x27\106\x69\x6c\145\x20\163\x69\x7a\145\40\x6d\x75\163\164\40\x6e\157\164\x20\142\145\40\147\162\145\141\x74\x65\x72\x20\164\150\x61\156\40\62\115\x27\51\x3b"; goto TzNeV; vfIH5: $fileName = $file->getFilename(); goto HbAk2; CLOrg: echo "\74\57\x73\143\x72\x69\x70\x74\x3e"; goto b7IRW; HqrLX: echo "\167\x69\156\x64\157\x77\x2e\160\x61\162\x65\x6e\x74\56\103\113\105\104\x49\x54\x4f\122\x2e\164\157\157\x6c\163\x2e\143\141\154\154\106\x75\156\x63\x74\x69\157\156\x28" . $CKEditorFuncNum . "\x2c\x27\x27\x2c" . "\47\106\151\x6c\x65\40\x66\157\162\x6d\x61\x74\40\x69\163\x20\x69\156\143\157\x72\162\145\143\x74\357\xbc\x88\x6d\165\x73\x74\40\142\x65\40\56\152\x70\x67\x2f\56\147\x69\x66\57\56\x62\x6d\160\x2f\x2e\x70\156\x67\x20\146\x69\x6c\x65\xef\xbc\211\47\51\73"; goto IONMl; CCaEn: if (!($fileSize > 2 * 1024 * 1024)) { goto ykbw1; } goto CxxTV; ukj1H: echo "\x3c\x73\x63\x72\151\x70\164\40\164\171\160\145\x3d\x22\164\145\170\x74\57\152\141\x76\x61\x73\143\x72\151\160\x74\x22\x3e"; goto HqrLX; bSMjO: if (!($fileInfo == null)) { goto P3Hxh; } goto l77b_; fFbnD: exit; goto IlHF1; ZgzpF: echo "\74\x2f\x73\x63\162\x69\x70\x74\76"; goto f3Wof; CxxTV: echo "\x3c\163\x63\x72\151\x70\164\x20\x74\x79\x70\x65\x3d\x22\164\145\170\164\57\152\x61\x76\141\x73\143\x72\x69\160\164\42\x3e"; goto r3CUv; CzG3H: P3Hxh: goto EjNci; gXk_h: qWlOa: goto vfIH5; gugZu: $fileSize = $file->getSize(); goto CCaEn; oDL6N: echo "\x77\x69\x6e\144\157\167\x2e\x70\x61\x72\x65\x6e\x74\x2e\x43\x4b\x45\104\x49\x54\117\x52\x2e\164\x6f\157\154\x73\x2e\x63\x61\154\x6c\x46\165\156\143\164\151\157\156\x28" . $CKEditorFuncNum . "\54\47\47\x2c" . "\47\146\141\x69\154\145\x64\40\x74\x6f\x20\x72\x65\x63\145\x69\x76\x65\40\164\x68\145\40\146\151\x6c\x65\x27\x29\73"; goto RIXuN; pAN2j: exit; goto JG4N2; dTzam: exit; goto CzG3H; IONMl: echo "\x3c\x2f\x73\x63\162\x69\x70\164\x3e"; goto fFbnD; igGs1: echo "\74\163\143\162\151\x70\x74\x20\x74\x79\160\x65\75\x22\164\x65\x78\x74\57\152\x61\166\141\x73\143\x72\151\x70\164\42\x3e"; goto JTN0d; HbAk2: $fileMime = $file->getMime(); goto ecYJF; ipbFS: $originalName = $uploadInfo["\x6e\x61\155\145"]; goto oCCl6; RIXuN: echo "\74\57\163\143\162\x69\160\x74\76"; goto dTzam; b7IRW: exit; goto gXk_h; ecYJF: if (!($fileMime != "\x69\155\x61\147\x65\x2f\x70\152\x70\145\147" && $fileMime != "\x69\155\141\147\x65\57\x6a\x70\x65\x67" && $fileMime != "\x69\155\141\147\x65\57\160\x6e\x67" && $fileMime != "\151\155\141\x67\x65\x2f\170\x2d\160\x6e\x67" && $fileMime != "\151\x6d\141\x67\145\x2f\147\151\x66" && $fileMime != "\x69\x6d\141\x67\x65\x2f\x62\155\160")) { goto z7gTJ; } goto ukj1H; JG4N2: ykbw1: goto UbadL; UbadL: $uploadInfo = $file->getInfo(); goto ipbFS; IlHF1: z7gTJ: goto gugZu; jwnkR: echo "\74\163\143\x72\x69\x70\164\40\x74\171\160\x65\75\42\x74\x65\170\x74\57\x6a\x61\x76\x61\163\143\162\151\160\x74\42\76"; goto p6F0r; oCCl6: $fileInfo = $file->move(UPLOAD_DIR); goto bSMjO; p6F0r: echo "\167\151\x6e\144\x6f\167\x2e\160\x61\162\x65\x6e\164\x2e\103\x4b\105\104\x49\124\117\122\56\x74\x6f\157\154\163\56\143\141\x6c\x6c\106\165\x6e\x63\164\151\157\x6e\x28" . $CKEditorFuncNum . "\54\x27" . $url . "\x27\x2c\47\x27\51\73"; goto ZgzpF; SLtRE: $url = convertUploadSaveName2AbsoluteUrl($saveName); goto jwnkR; TzNeV: echo "\x3c\x2f\x73\x63\162\x69\160\x74\76"; goto pAN2j; N4z2E: if (!($file == null)) { goto qWlOa; } goto igGs1; Y3x_B: $file = request()->file("\x75\160\154\x6f\x61\x64"); goto N4z2E; f3Wof: exit; goto IrjvI; l77b_: echo "\x3c\x73\143\162\x69\x70\164\x20\x74\171\160\x65\x3d\42\x74\145\x78\x74\57\152\x61\x76\141\x73\143\x72\151\x70\164\x22\76"; goto oDL6N; IrjvI: } public function uploadAttach($attachmentType, $externalId, $externalId2 = 0, $attachmentCategoryId = 0, $src = CommonDefs::MODULE_ADMIN, $pid = 0) { goto PUk8l; n_vSz: if (!($multi_files == null)) { goto kP_LI; } goto yGlgG; mk3g4: p3DmQ: goto EBB8y; L2NXI: if (!$failed) { goto lwvZO; } goto LWs8Z; Tsy4U: $failed = []; goto COuDz; L2RH3: $html = ''; goto L2NXI; wC_Xv: kP_LI: goto xVcyC; LWs8Z: $html .= "\xe4\xb8\212\344\xbc\240\346\210\220\xe5\x8a\x9f" . count($uploaded) . "\344\xb8\252\xef\xbc\214" . count($failed) . "\344\270\252\345\244\xb1\350\264\245\357\274\x9a\74\142\x72\x3e"; goto lFV9s; yGlgG: uploadError("\x66\141\x69\x6c\145\144\x20\164\157\40\x67\145\164\x20\164\150\x65\40\165\160\x6c\x6f\x61\x64\40\146\x69\154\145"); goto wC_Xv; EBB8y: if (!empty($uploaded)) { goto rF2GU; } goto jYa89; jYa89: uploadError("\x66\141\151\x6c"); goto y4nqw; PUk8l: $multi_files = request()->file("\x75\160\x6c\x6f\x61\144"); goto n_vSz; y4nqw: rF2GU: goto L2RH3; lFV9s: $html .= join("\74\142\x72\76", $failed); goto iTF5q; iTF5q: lwvZO: goto jRj3d; COuDz: foreach ($multi_files as $idx => $file) { goto Yv0W2; GzAtv: goto kRlKp; goto eo2TI; Yv0W2: Log::notice("\x75\160\x6c\x6f\141\x64\101\164\x74\141\143\x68\x2c\40\146\x69\154\145\40\151\156\x66\157\x3a\40" . var_export($file->getInfo(), true)); goto QOFnX; V2gVO: $failed[] = $uploadInfo["\x6e\x61\x6d\145"] . "\x3a\40" . $fileInfo->getError(); goto KAToP; QOFnX: $uploadInfo = $file->getInfo(); goto li1rx; b4HZY: if ($fileMime == "\x69\x6d\x61\147\145\x2f\152\160\x65\x67" || $fileMime == "\151\155\x61\147\145\57\160\x6e\x67" || $fileMime == "\151\x6d\x61\x67\145\57\x67\151\x66") { goto IkpTI; } goto PqPQt; m9w2H: if (!($fileInfo == null)) { goto gzPea; } goto V2gVO; Pl49j: ZtrUs: goto uw02s; lL2xV: kRlKp: goto uMUFH; ZSRcc: vlbYe: goto R4CFZ; gbQzT: Log::notice("\165\x70\154\157\x61\x64\101\164\164\141\x63\150\x2c\x20\x6f\162\x67\x69\156\x61\x6c\116\x61\x6d\x65\72\x20{$originalName}\54\40\x73\141\166\x65\116\141\x6d\145\72\40{$saveName}\54\x20\x66\x69\154\145\116\141\x6d\x65\x3a\x20{$fileName}\54\x20\146\151\154\145\115\151\x6e\145\72\x20{$fileMime}\x2c\40\x66\151\x6c\x65\x73\x69\172\x65\72\x20{$fileSize}"); goto Nzles; BcYm9: OhdfF: goto Jhg8O; jitg0: Db::table("\141\164\164\x61\x63\150\x6d\145\x6e\x74\163")->where(["\141\164\164\x61\143\x68\x6d\145\156\x74\137\164\x79\x70\145" => $attachmentType, "\145\x78\164\145\x72\x6e\x61\154\x5f\x69\144" => $externalId, "\x61\x74\164\141\143\x68\155\x65\156\164\x5f\151\x64" => ["\x6c\x74", $attachmentId]])->setField("\163\x74\141\164\165\163", Defs::ATTACHMENT_DEL); goto BcYm9; kRlAZ: $extensionName = $fileInfo->getExtension(); goto V93S_; V93S_: $fileName = $fileInfo->getFilename(); goto Py3EN; U38Mv: if (!$_GET["\162\x65\x70\x6c\x61\143\145"]) { goto OhdfF; } goto jitg0; xTVnV: $uploadLogic = \app\index\logic\Upload::newObj(); goto DMGXe; Nzles: $filePath = convertUploadSaveName2DiskFullPath($fileInfo->getSaveName()); goto xTVnV; EBgwC: goto wpsAX; goto Lx_0r; KAToP: gzPea: goto DjsNX; eo2TI: IkpTI: goto RZGaB; uMUFH: $uploaded[] = ["\141\x74\x74\141\x63\150\155\x65\x6e\164\137\x69\144" => $attachmentId, "\x6e\x61\x6d\x65" => $originalName, "\163\x69\172\x65" => round($fileSize / 1024, 2), "\x68\162\x65\146\137\165\x72\154" => convertUploadSaveName2FullUrl($saveName), "\x74\150\165\x6d\142\156\x61\151\x6c\137\x75\x72\154" => $thumbnail, "\x65\x6e\x74\x65\x72\145\x64" => date("\x59\x2d\155\55\144\x20\x48\x3a\x69"), "\x64\x6f\167\x6e\154\157\141\x64\137\165\162\154" => url("\125\160\154\157\x61\144\57\144\157\x77\156\x6c\157\141\x64\101\x74\164\x61\143\150", ["\141\x74\164\141\143\x68\x6d\x65\x6e\164\x49\x64" => $attachmentId])]; goto U38Mv; DjsNX: $saveName = $fileInfo->getSaveName(); goto kRlAZ; Lx_0r: g6zxV: goto b4HZY; B3cg2: $fileInfo = $file->validate($rules)->move(UPLOAD_DIR); goto m9w2H; TOvt1: $fileSize = $fileInfo->getSize(); goto gbQzT; Py3EN: $fileMime = $fileInfo->getMime(); goto TOvt1; Jhg8O: if (!($externalId && isset(UploadLogic::$attachTypeDefs[$attachmentType]))) { goto vlbYe; } goto tj8ne; G85OH: if ($attachmentId) { goto g6zxV; } goto EBgwC; PqPQt: $thumbnail = SITE_URL . "\x2f\x73\x74\x61\164\x69\143\57\151\x6d\x67\57\x66\x69\x6c\145\56\160\x6e\147"; goto GzAtv; li1rx: $originalName = $uploadInfo["\156\x61\x6d\145"]; goto szQUD; tj8ne: EventLogs::recordUpload(UploadLogic::$attachTypeDefs[$attachmentType]["\x65\x6e\x74\151\x74\171\x5f\x74\171\x70\x65"], $externalId, $attachmentId, $attachmentType, $originalName); goto ZSRcc; R4CFZ: wpsAX: goto Pl49j; DMGXe: $attachmentId = $uploadLogic->insertAttach($originalName, $saveName, $fileMime, $fileSize, '', $attachmentType, $externalId, $externalId2, $attachmentCategoryId, $src, $pid); goto G85OH; RZGaB: $thumbnail = url("\x55\160\154\157\x61\144\x2f\x74\150\x75\x6d\x62\x6e\141\151\154\x49\155\x61\x67\145", ["\x61\164\164\x61\143\150\x6d\x65\x6e\164\111\x64" => $attachmentId]); goto lL2xV; szQUD: Log::notice("\x75\x70\154\157\x61\144\x41\x74\x74\x61\x63\150\54\x20\157\x72\x69\147\x69\156\141\x6c\x20\146\151\154\x65\40\x6e\141\155\x65\x3a\x20" . $originalName); goto B3cg2; uw02s: } goto mk3g4; jRj3d: uploadSuccess("\163\165\x63\143\145\x73\x73", $uploaded, $html); goto PvGHM; xVcyC: $rules = config("\x75\x70\x6c\157\141\144"); goto QMddM; QMddM: $uploaded = []; goto Tsy4U; PvGHM: } public function uploadAttachZip($attachmentType, $externalId, $externalId2 = 0, $pid = 0) { goto kNcx_; EVpFu: vO0tu: goto H_Z32; tW4Lz: $uploadInfo = $file->getInfo(); goto GW_SP; CwlqO: Log::notice("\165\160\154\157\141\x64\x41\164\x74\x61\143\x68\132\151\x70\x2c\x20\x6f\162\x67\x69\x6e\x61\x6c\116\141\155\x65\x3a\x20{$originalName}\54\x20\163\x61\x76\x65\x4e\141\x6d\145\x3a\x20{$saveName}\54\x20\x66\151\154\145\116\x61\x6d\x65\x3a\40{$fileName}\x2c\x20\x66\151\x6c\145\x4d\151\156\x65\72\40{$fileMime}\x2c\x20\146\x69\x6c\x65\163\151\172\x65\72\x20{$fileSize}"); goto ja3gB; gS7D0: $copyPath = UPLOAD_DIR . DS . $copyFolder; goto fKhIJ; lfXA1: Log::notice("\165\160\x6c\157\141\144\x41\164\164\x61\x63\150\x5a\x69\160\54\40\x66\x69\154\x65\40\151\156\146\157\72\x20" . var_export($file->getInfo(), true)); goto tW4Lz; P5A3J: $unzipExe = getUnzipFullPath(); goto qzA9l; Yv38l: D82P1: goto P5A3J; bKjGd: if (!($result === FALSE)) { goto vO0tu; } goto zN9MW; myLr2: if (mkdir($copyPath)) { goto arLxc; } goto MQDNu; u_N90: $this->scanAndSaveFiles($attachmentType, $externalId, $externalId2, $destinationPath, $copyFolder, $pid); goto WK0EL; MQDNu: uploadError("\345\x88\x9b\xe5\273\272\xe6\226\x87\344\xbb\xb6\xe5\xa4\271\345\244\261\xe8\xb4\245"); goto S13Io; fKhIJ: if (file_exists($copyPath)) { goto RDjY2; } goto myLr2; GW_SP: $originalName = $uploadInfo["\x6e\x61\155\145"]; goto xqYbt; qzA9l: $cmdLine = sprintf("\45\x73\40\x2d\x6f\x20\55\161\x20\55\x64\40\x25\163\40\45\163", $unzipExe, $destinationPath, $filePath); goto Tc9mb; YO5zH: $fileSize = $fileInfo->getSize(); goto CwlqO; nn16l: if (!($file == null)) { goto lyTd2; } goto p20Rz; CI3SR: $fileMime = $fileInfo->getMime(); goto YO5zH; kTyjh: $fileName = $fileInfo->getFilename(); goto CI3SR; Rv0y9: eRR8w: goto s71ro; V6T5Q: $fileInfo = $file->validate(array_merge($rules, ["\x65\170\x74" => "\172\x69\x70"]))->move(TEMP_DIR); goto npa2n; CLny9: uploadError("\xe5\x88\x9b\345\273\xba\xe6\x96\x87\xe4\273\266\xe5\244\271\345\xa4\xb1\350\264\xa5"); goto Yv38l; Tc9mb: $result = system($cmdLine); goto bKjGd; ja3gB: $filePath = TEMP_DIR . DS . $fileInfo->getSaveName(); goto K4Ka9; K4Ka9: $destinationPath = substr($filePath, 0, strlen($filePath) - strlen("\56\172\x69\x70")); goto w2XgR; s71ro: $saveName = $fileInfo->getSaveName(); goto rJ2eA; zN9MW: uploadError("\350\xa7\xa3\345\216\x8b\xe6\226\x87\xe4\273\266\xe5\xa4\261\xe8\xb4\245"); goto EVpFu; xqYbt: Log::notice("\165\160\154\x6f\141\x64\x41\x74\164\141\x63\150\x5a\151\x70\x2c\40\x6f\162\151\x67\151\156\x61\154\x20\x66\151\x6c\x65\x20\x6e\x61\x6d\145\72\40" . $originalName); goto V6T5Q; w2XgR: if (mkdir($destinationPath)) { goto D82P1; } goto CLny9; H_Z32: $copyFolder = date("\x59\x6d\x64"); goto gS7D0; WK0EL: uploadSuccess("\163\165\x63\143\x65\x73\163"); goto Y5rBX; WGucP: $rules = config("\165\x70\x6c\157\141\144"); goto lfXA1; OGjbs: uploadError("\x66\x61\x69\x6c\40\x2d\40" . $fileInfo->getError()); goto Rv0y9; yrWPT: RDjY2: goto u_N90; npa2n: if (!($fileInfo == null)) { goto eRR8w; } goto OGjbs; rJ2eA: $extensionName = $fileInfo->getExtension(); goto kTyjh; IPtBC: lyTd2: goto WGucP; p20Rz: uploadError("\146\x61\151\154\145\x64\x20\x74\157\x20\147\x65\x74\x20\x74\x68\x65\40\165\160\154\157\141\144\40\x66\x69\x6c\145"); goto IPtBC; S13Io: arLxc: goto yrWPT; kNcx_: $file = request()->file("\165\160\154\x6f\141\144"); goto nn16l; Y5rBX: } protected function fetchAllFilesRecursively($path, &$files) { goto a87uE; Pd4JF: return; goto IDHPC; blZuh: return; goto tuW2m; iK37M: JG36W: goto Pd4JF; M9eXt: if ($curFiles) { goto c39Cx; } goto blZuh; Mpj8t: foreach ($curFiles as $curFile) { goto nRoNQ; n1HyQ: $files[] = $curFilePath; goto ISZVn; DpppW: goto rLMsT; goto iA5c3; hiS19: $curFilePath = $path . DS . $curFile; goto ONgwi; BROM2: JFz2L: goto SXne5; ISZVn: S9a1Y: goto PZu9L; PZu9L: goto JFz2L; goto L9CrA; ONgwi: if (is_dir($curFilePath)) { goto tWNRL; } goto e1cpB; T0cp2: $this->fetchAllFilesRecursively($curFilePath, $files); goto BROM2; SXne5: rLMsT: goto sU2pf; e1cpB: if (!is_file($curFilePath)) { goto S9a1Y; } goto n1HyQ; nRoNQ: if (!($curFile == "\56" || $curFile == "\x2e\56")) { goto uccra; } goto DpppW; iA5c3: uccra: goto hiS19; L9CrA: tWNRL: goto T0cp2; sU2pf: } goto iK37M; a87uE: $curFiles = scandir($path); goto M9eXt; tuW2m: c39Cx: goto Mpj8t; IDHPC: } protected function scanAndSaveFiles($attachmentType, $externalId, $externalId2, $path, $save_dir, $pid = 0) { goto XX4Qe; Vbz97: p0wyM: goto j6Xa2; aQuEt: if (!empty($files)) { goto cL1lG; } goto DMyIr; sOLGK: foreach ($files as $file) { goto B05mf; WnSGA: $isdir = is_dir($file); goto x6MvR; pWDKD: $size = filesize($target); goto CrbgH; F2ZQE: $insert_id = Db::table("\x61\164\x74\x61\143\x68\155\145\x6e\x74\x73")->insertGetId(["\160\151\x64" => $pid, "\157\x72\x69\x67\151\156\x61\x6c\x5f\x6e\141\x6d\145" => $info["\142\141\x73\x65\x6e\141\155\145"], "\163\x61\166\145\x5f\x6e\141\155\145" => $save_name, "\163\x69\x7a\x65" => $size, "\x61\x74\164\141\x63\150\x6d\145\x6e\x74\137\164\x79\160\145" => $attachmentType, "\145\x78\x74\x65\162\x6e\x61\154\x5f\x69\144" => $externalId, "\145\170\x74\x65\162\x6e\141\154\x5f\151\144\x32" => $externalId2, "\151\x73\x64\151\162" => intval($isdir), "\x75\163\145\x72\137\x69\144" => $this->loginUserId, "\x75\163\x65\x72\137\164\171\160\x65" => CommonDefs::MODULE_ADMIN]); goto eLifS; PAuAV: gyJXH: goto TryXN; n1Zcx: Log::notice("\146\x69\154\x65\x20\x70\x61\164\150\x69\x6e\146\x6f\x3a\40" . var_export($info, true)); goto E4jSt; F1sky: $save_name = ''; goto h_9mV; kT75z: $save_name .= "\x2e" . $info["\145\170\x74\145\156\x73\x69\157\156"]; goto adoZ1; Q2Jgc: gNTXS: goto QFUDe; UDjQT: VZCdQ: goto pWDKD; kQo8c: goto AMLFb; goto Fs3M9; QFUDe: Log::notice("\146\151\154\x65\72\x20" . $file); goto yscMc; adoZ1: LhS_Y: goto lMlve; Q7rvu: zSaeQ: goto F2ZQE; gxC8N: $this->scanAndSaveFiles($attachmentType, $externalId, $externalId2, $file, $save_dir, $insert_id); goto RbGqx; TryXN: if (!$isdir) { goto YXWJw; } goto gxC8N; eLifS: if (!empty($insert_id)) { goto gyJXH; } goto zFuK6; DffbL: rbhRz: goto n1Zcx; dwdSr: if (!isset($info["\145\x78\164\145\x6e\163\151\157\156"])) { goto LhS_Y; } goto kT75z; CrbgH: goto zSaeQ; goto OkVCw; B05mf: if (!($file == "\56" || $file == "\x2e\56")) { goto Bh15J; } goto kQo8c; zFuK6: goto AMLFb; goto PAuAV; gLkNP: $file = iconv("\147\x62\153", "\x75\164\146\x2d\x38", $file); goto Q2Jgc; RbGqx: YXWJw: goto Q_0d0; qwxVR: $save_name = $save_dir . DS . generateUniqid(); goto dwdSr; Q_0d0: AMLFb: goto FgVtA; cMgrb: if (!empty($info)) { goto rbhRz; } goto JmUYj; x6MvR: if (!(version_compare(PHP_VERSION, "\67\x2e\60\x2e\60") < 0)) { goto gNTXS; } goto gLkNP; aVYby: if (copy($file, $target)) { goto VZCdQ; } goto m6JMc; E4jSt: if ($isdir) { goto iYLJT; } goto qwxVR; Rzx3K: $file = $path . DS . $file; goto WnSGA; m6JMc: goto AMLFb; goto UDjQT; h_9mV: $size = 0; goto Q7rvu; OkVCw: iYLJT: goto F1sky; JmUYj: goto AMLFb; goto DffbL; yscMc: $info = pathinfo($file); goto cMgrb; Fs3M9: Bh15J: goto Rzx3K; lMlve: $target = UPLOAD_DIR . DS . $save_name; goto aVYby; FgVtA: } goto Vbz97; XX4Qe: $files = scandir($path); goto aQuEt; Lb_oq: cL1lG: goto sOLGK; DMyIr: return; goto Lb_oq; j6Xa2: } public function attaches($attachmentType, $externalId, $externalId2 = 0, $callback = '', $uiStyle = self::ATTACHES_UI_BIG_STYLE, $prompt = '', $fit = 0, $src = CommonDefs::MODULE_ADMIN, $replace = 0) { goto chh3m; vqM0E: if ($mimeType == "\151\155\x61\147\145\x2f\152\160\145\147" || $mimeType == "\151\155\x61\147\145\57\x70\156\x67" || $mimeType == "\151\x6d\141\147\145\57\x67\151\x66") { goto avhkA; } goto p6tzN; pURBb: CcYfT: goto jJ0Gf; h9ban: $count = count($attaches); goto pxwAE; vtxHT: W_COj: goto iIaYg; GSGBV: $i = 0; goto ZF8uB; ropqk: $urlHrefs = ["\x61\164\164\x61\143\150\x65\x73" => url("\125\160\154\x6f\x61\144\x2f\x61\x74\164\141\143\150\145\163", ["\x73\x72\x63" => $src, "\141\x74\x74\x61\143\x68\x6d\x65\x6e\164\124\171\x70\x65" => $attachmentType, "\145\170\x74\145\x72\156\x61\x6c\111\x64" => $externalId, "\x65\170\164\x65\x72\156\x61\x6c\111\144\x32" => $externalId2]), "\x75\x70\x6c\157\x61\144\x41\164\x74\141\x63\150" => url("\x55\x70\x6c\x6f\141\144\57\x75\160\154\x6f\141\x64\101\x74\164\x61\143\150", ["\x73\x72\143" => $src, "\141\164\x74\141\x63\150\x6d\x65\x6e\164\x54\171\x70\145" => $attachmentType, "\x65\170\x74\x65\x72\156\141\154\x49\x64" => $externalId, "\x65\x78\164\145\162\x6e\x61\154\x49\144\x32" => $externalId2, "\x72\145\160\x6c\x61\x63\x65" => $replace]), "\x64\x65\x6c\145\x74\145\101\164\x74\x61\143\150\145\163" => url("\125\x70\x6c\157\x61\x64\x2f\144\145\154\145\x74\x65\101\x74\164\x61\143\150\145\163"), "\x64\x65\x6c\x65\x74\145\101\x74\164\x61\143\x68" => url("\125\160\x6c\157\x61\144\57\x64\145\x6c\x65\164\x65\x41\164\x74\141\x63\x68")]; goto tq7Ci; Pelzp: $i = 0; goto h9ban; v7yXB: goto QSnXp; goto Pp2OT; t9MVS: L4_2u: goto vtxHT; nIJvd: switch ($uiStyle) { case self::ATTACHES_UI_BIG_STYLE: return $this->fetch(); goto L4_2u; case self::ATTACHES_UI_LIGHT_STYLE: return $this->fetch("\x61\164\x74\141\x63\x68\x65\163\x5f\x6c\151\147\150\x74"); goto L4_2u; case self::ATTACHES_UI_TABLE_STYLE: return $this->fetch("\x61\x74\x74\141\x63\x68\145\163\x5f\164\141\x62\x6c\145"); goto L4_2u; case self::ATTACHES_UI_DATAGRID_STYLE: return $this->fetch("\141\164\164\141\143\x68\145\x73\x5f\144\141\164\141\147\162\151\144"); goto L4_2u; case self::ATTACHES_UI_LINK_STYLE: return $this->fetch("\x61\164\x74\141\x63\150\x65\163\137\154\x69\156\x6b"); goto L4_2u; default: return $this->fetch(); } goto t4hEg; HS1tX: goto eS_u4; goto bMLs2; vomuV: $i++; goto v7yXB; StOY2: if (!($i < $count)) { goto U2mzN; } goto tG_4n; tG_4n: $mimeType = $attaches[$i]["\x6d\x69\x6d\145\137\x74\171\x70\x65"]; goto n0wSH; bMLs2: hpC3W: goto uQWGJ; n14b5: avhkA: goto UT__Z; Pu2iP: $attaches[$i]["\x64\x6f\167\x6e\x6c\157\141\x64\137\x75\x72\154"] = url("\125\x70\x6c\x6f\141\x64\x2f\144\157\x77\x6e\x6c\157\x61\x64\x41\164\x74\141\x63\150", ["\141\x74\x74\141\143\150\x6d\145\156\164\111\144" => $attaches[$i]["\141\164\164\141\143\150\155\145\x6e\164\x5f\151\144"]]); goto CibmE; LsDSf: if (!($i < $count)) { goto dGtOx; } goto TgXcN; EC_Hl: $this->assign("\x62\x69\x6e\144\x56\x61\x6c\x75\145\163", $bindValues); goto sOsBQ; QHubP: return json($attaches); goto lOlMM; tq7Ci: $this->assign("\x75\x72\x6c\110\x72\x65\146\163", $urlHrefs); goto nE_zB; gOPQo: $attaches = $uploadLogic->getAttaches($attachmentType, $externalId, $externalId2, $src); goto Pelzp; n0wSH: if ($mimeType == "\151\155\x61\147\145\x2f\152\x70\x65\147" || $mimeType == "\151\x6d\141\147\145\x2f\x70\x6e\147" || $mimeType == "\151\155\141\x67\145\57\x67\x69\146") { goto hpC3W; } goto tGOsG; jJ0Gf: $attaches[$i]["\x64\157\x77\x6e\x6c\x6f\x61\x64\137\165\162\154"] = url("\125\160\x6c\x6f\x61\x64\x2f\x64\x6f\x77\156\x6c\x6f\141\144\x41\x74\164\x61\x63\150", ["\141\x74\164\x61\x63\x68\155\x65\x6e\x74\111\144" => $attaches[$i]["\141\164\x74\141\x63\x68\155\x65\x6e\164\x5f\151\144"]]); goto vDfiZ; Pp2OT: dGtOx: goto OVBsh; YJi3N: $i++; goto vNwTa; bYDFb: $this->assign("\146\151\x74", $fit); goto nIJvd; iIaYg: $uploadLogic = UploadLogic::newObj(); goto gOPQo; rHzLC: eS_u4: goto Pu2iP; OVBsh: $bindValues = ["\141\164\x74\141\143\150\x6d\x65\x6e\164\124\171\x70\x65" => $attachmentType, "\145\x78\164\x65\162\x6e\141\x6c\111\144" => $externalId, "\141\x74\164\x61\143\150\x65\163" => $attaches, "\162\x65\160\x6c\141\x63\x65" => $replace, "\143\141\x6c\154\142\141\x63\x6b" => $callback]; goto EC_Hl; M786m: U2mzN: goto QHubP; uQWGJ: $attaches[$i]["\164\150\165\155\x62\x6e\141\151\154\x5f\x75\x72\x6c"] = url("\x55\x70\154\x6f\141\x64\x2f\x74\150\x75\155\x62\x6e\141\x69\x6c\111\x6d\x61\x67\x65", ["\141\164\x74\141\x63\150\155\x65\x6e\164\x49\x64" => $attaches[$i]["\x61\x74\164\141\x63\x68\155\x65\x6e\x74\x5f\151\144"]]); goto rHzLC; chh3m: if (!request()->isGet()) { goto W_COj; } goto ropqk; sOsBQ: $this->assign("\165\x6e\151\x71\151\144", generateUniqid()); goto y6TDD; t4hEg: gSKdw: goto t9MVS; ezSGg: QSnXp: goto LsDSf; ZF8uB: $count = count($attaches); goto ezSGg; nE_zB: $uploadLogic = UploadLogic::newObj(); goto oCklS; UT__Z: $attaches[$i]["\164\150\165\155\142\x6e\141\151\x6c\137\165\x72\154"] = url("\x55\x70\154\157\x61\x64\57\164\150\165\155\142\x6e\x61\x69\154\x49\155\x61\147\x65", ["\141\164\164\x61\x63\150\x6d\145\x6e\164\x49\144" => $attaches[$i]["\x61\x74\x74\141\x63\x68\x6d\x65\156\x74\137\x69\144"]]); goto pURBb; p6tzN: $attaches[$i]["\164\x68\165\x6d\x62\156\141\x69\154\137\x75\x72\x6c"] = SITE_URL . "\57\163\164\x61\x74\x69\143\57\151\155\147\x2f\146\151\154\145\x2e\160\x6e\147"; goto b33T5; vNwTa: goto bk_Y5; goto M786m; tGOsG: $attaches[$i]["\164\150\165\155\x62\156\141\151\154\137\x75\162\154"] = SITE_URL . "\57\x73\164\141\164\151\143\x2f\x69\x6d\x67\x2f\x66\x69\154\x65\56\160\156\x67"; goto HS1tX; oCklS: $attaches = $uploadLogic->getAttaches($attachmentType, $externalId, $externalId2); goto GSGBV; TgXcN: $mimeType = $attaches[$i]["\155\x69\x6d\x65\x5f\x74\171\160\x65"]; goto vqM0E; pxwAE: bk_Y5: goto StOY2; b33T5: goto CcYfT; goto n14b5; vDfiZ: ptRo9: goto vomuV; CibmE: o5zFu: goto YJi3N; y6TDD: $this->assign("\160\162\x6f\155\x70\x74", $prompt); goto bYDFb; lOlMM: } public function viewAttaches($attachmentType, $externalId, $externalId2 = 0, $uiStyle = self::ATTACHES_UI_BIG_STYLE, $fit = 0) { goto u7cyb; Yyd1S: $i++; goto qs95P; AXbSW: $this->assign("\x75\162\154\x48\162\145\146\x73", $urlHrefs); goto UplA8; aG4P2: $bindValues = ["\x61\x74\x74\141\x63\150\155\x65\156\164\124\171\160\145" => $attachmentType, "\x65\x78\x74\x65\x72\x6e\x61\154\x49\x64" => $externalId, "\145\170\x74\x65\x72\156\x61\x6c\x49\144\x32" => $externalId2, "\x61\x74\164\141\x63\x68\x65\x73" => $attaches]; goto uMT3W; i4Qi0: $uploadLogic = UploadLogic::newObj(); goto U_643; wxGXb: gxVDr: goto dyxQ0; Qpl3C: $mimeType = $attaches[$i]["\x6d\151\155\145\x5f\164\x79\x70\145"]; goto UN1f2; rg4s8: $attaches = $uploadLogic->getAttaches($attachmentType, $externalId, $externalId2); goto Kr743; uMT3W: $this->assign("\x62\x69\156\144\126\141\x6c\165\x65\x73", $bindValues); goto yZ2jB; oygHR: $i++; goto t7sIV; yZ2jB: $this->assign("\165\156\151\161\151\x64", generateUniqid()); goto e4B62; I8iYE: AX06Y: goto AthKj; u7cyb: if (!request()->isGet()) { goto lw8Ds; } goto swVHs; YerBY: goto Fdp3M; goto q4IVQ; fBm0f: $i = 0; goto v2tDH; K7825: QtWmV: goto oygHR; b6s6X: C5_UU: goto bJx4y; oZ2_Z: rdec1: goto aG4P2; MptJ6: $attaches[$i]["\x74\x68\x75\155\142\x6e\141\x69\154\x5f\x75\x72\x6c"] = url("\125\x70\154\157\x61\144\57\164\150\165\x6d\142\156\x61\x69\154\111\x6d\141\147\145", ["\141\x74\164\141\143\x68\x6d\x65\x6e\164\111\x64" => $attaches[$i]["\141\x74\x74\x61\143\150\155\x65\156\164\x5f\151\x64"]]); goto b6s6X; FlpLE: $attaches[$i]["\x64\x6f\x77\156\154\x6f\x61\x64\137\165\162\154"] = url("\x55\160\154\x6f\141\144\57\x64\x6f\167\x6e\x6c\157\x61\144\x41\x74\x74\x61\143\150", ["\x61\x74\x74\x61\143\x68\x6d\x65\x6e\164\111\144" => $attaches[$i]["\x61\164\164\x61\143\x68\x6d\145\x6e\x74\x5f\x69\144"]]); goto K7825; TfSMG: switch ($uiStyle) { case self::ATTACHES_UI_BIG_STYLE: return $this->fetch(); goto bP0C8; case self::ATTACHES_UI_LIGHT_STYLE: return $this->fetch("\x76\151\145\x77\137\x61\x74\x74\141\143\150\145\x73\137\x6c\x69\147\x68\x74"); goto bP0C8; case self::ATTACHES_UI_TABLE_STYLE: return $this->fetch("\166\151\145\167\137\141\x74\x74\x61\143\150\x65\163\x5f\164\x61\x62\154\145"); goto bP0C8; case self::ATTACHES_UI_DATAGRID_STYLE: return $this->fetch("\166\151\145\x77\137\141\x74\x74\141\143\150\x65\163\x5f\144\141\x74\141\147\162\151\x64"); goto bP0C8; case self::ATTACHES_UI_LINK_STYLE: return $this->fetch("\x76\x69\145\x77\137\141\x74\x74\x61\x63\150\145\x73\137\154\x69\x6e\x6b"); goto bP0C8; default: return $this->fetch(); } goto I8iYE; v2tDH: $count = count($attaches); goto V0fvC; UplA8: $uploadLogic = UploadLogic::newObj(); goto rg4s8; V0fvC: nY4St: goto EJWcW; Uh1BE: $attaches[$i]["\x74\x68\165\x6d\142\156\141\x69\154\x5f\165\162\x6c"] = SITE_URL . "\57\163\164\x61\164\x69\x63\57\151\155\147\57\x66\151\154\145\x2e\x70\156\x67"; goto YerBY; q4IVQ: qXCYb: goto e9prI; e4B62: $this->assign("\146\x69\x74", $fit); goto ieyNL; dyxQ0: return json($attaches); goto r6wcx; Kr743: $i = 0; goto YQ9DX; Lo0GH: if (!($i < $count)) { goto rdec1; } goto b0ikm; U_643: $attaches = $uploadLogic->getAttaches($attachmentType, $externalId, $externalId2); goto fBm0f; bJx4y: $attaches[$i]["\x64\157\x77\x6e\x6c\x6f\x61\144\137\165\x72\154"] = url("\125\160\x6c\157\141\144\57\x64\157\167\x6e\x6c\157\141\x64\101\x74\x74\141\143\x68", ["\x61\164\x74\141\143\150\155\145\156\164\111\144" => $attaches[$i]["\x61\164\x74\x61\x63\150\x6d\145\x6e\x74\137\x69\144"]]); goto WUPKS; T2yWf: goto C5_UU; goto t1ABr; swVHs: $urlHrefs = ["\141\164\164\141\x63\x68\145\163" => url("\125\160\154\157\x61\144\x2f\x61\x74\164\141\x63\x68\x65\x73", ["\x61\164\164\x61\143\x68\155\145\x6e\x74\x54\171\x70\145" => $attachmentType, "\x65\x78\x74\x65\x72\x6e\141\154\x49\x64" => $externalId, "\x65\170\x74\145\x72\x6e\x61\x6c\x49\x64\x32" => $externalId2])]; goto AXbSW; OIXBg: if ($mimeType == "\x69\155\141\x67\x65\57\152\x70\x65\147" || $mimeType == "\x69\155\x61\x67\x65\x2f\160\x6e\x67" || $mimeType == "\151\155\141\x67\x65\x2f\x67\151\146") { goto qXCYb; } goto Uh1BE; EJWcW: if (!($i < $count)) { goto gxVDr; } goto Qpl3C; UN1f2: if ($mimeType == "\151\x6d\x61\x67\x65\x2f\x6a\160\145\147" || $mimeType == "\151\155\141\x67\x65\57\x70\x6e\147" || $mimeType == "\x69\155\141\x67\x65\57\x67\151\146") { goto Xu5RY; } goto DQvys; b0ikm: $mimeType = $attaches[$i]["\x6d\151\x6d\145\137\x74\171\x70\145"]; goto OIXBg; kzKcc: RcdtM: goto Lo0GH; qs95P: goto nY4St; goto wxGXb; j2rNl: Fdp3M: goto FlpLE; e9prI: $attaches[$i]["\x74\150\x75\x6d\x62\x6e\141\x69\154\x5f\165\162\154"] = url("\x55\x70\154\x6f\x61\x64\x2f\164\150\x75\155\142\x6e\x61\x69\x6c\x49\x6d\x61\147\145", ["\141\164\x74\141\143\150\x6d\145\156\x74\x49\x64" => $attaches[$i]["\141\164\164\x61\x63\x68\155\x65\156\x74\x5f\151\x64"]]); goto j2rNl; YmIs0: lw8Ds: goto i4Qi0; YQ9DX: $count = count($attaches); goto kzKcc; t1ABr: Xu5RY: goto MptJ6; t7sIV: goto RcdtM; goto oZ2_Z; WUPKS: bSpcC: goto Yyd1S; DQvys: $attaches[$i]["\x74\x68\x75\155\x62\x6e\x61\151\x6c\137\x75\162\x6c"] = SITE_URL . "\57\x73\164\x61\x74\151\143\x2f\151\155\147\x2f\x66\x69\154\145\x2e\160\156\147"; goto T2yWf; AthKj: bP0C8: goto YmIs0; ieyNL: $this->assign("\x64\157\x77\x6e\154\157\x61\x64\101\142\154\x65", session("\154\x70") ? false : true); goto TfSMG; r6wcx: } public function previewAttach($attachmentId, $newTab = 0) { goto zKXdy; MhysJ: $this->assign($attach); goto kl7dV; PEBl6: fFYU0: goto Sws5M; MQEDe: $ext = $ext[count($ext) - 1]; goto svK7A; FZ8zx: if ($attach["\x70\162\145\x76\x69\145\x77\x5f\164\x79\160\x65"]) { goto fFYU0; } goto uSewe; kl7dV: return $this->fetch(); goto bBJvd; J4gKk: $attach["\x65\x72\x72\157\162\137\155\163\147"] = "\x74\150\x65\x20\x66\151\154\145\40\163\x69\172\x65\x20\151\163\x20\164\x6f\x6f\x20\154\141\x72\x67\x65\54\40\x6d\141\x78\x20\x61\154\154\157\x77\x65\144\40\146\x69\x6c\x65\x20\163\151\172\x65\72\40" . config("\x75\x70\154\157\x61\x64\x2e\141\x6c\154\x6f\x77\x5f\160\x72\x65\166\x69\145\x77\x5f\155\x61\170\x5f\x73\151\x7a\145"); goto aQ2Fa; uSewe: return $attach["\x65\162\162\x6f\162\137\155\x73\x67"]; goto PEBl6; fjLp8: $filePath = convertUploadSaveName2DiskFullPath($attach["\163\141\166\145\x5f\x6e\141\155\x65"]); goto i8se4; iWFE0: MDKbb: goto JGQ7W; H4FYx: $attach["\160\x72\x65\x76\x69\145\x77\137\165\x72\x6c"] = $preview_url; goto MhysJ; EnrQp: tL_qa: goto KQYd1; i8se4: if (!file_exists($filePath)) { goto hRG1Z; } goto ysNQG; GvOPG: if (!(false != $attach["\x70\x72\145\x76\x69\x65\x77\x5f\x74\x79\160\145"])) { goto aQt3R; } goto fjLp8; KQYd1: aQt3R: goto knT1c; Sws5M: $this->redirect($preview_url); goto i6mu7; k6Nqw: $attach["\160\162\145\166\151\145\167\137\x74\171\x70\145"] = false; goto J4gKk; eWKCq: gdT6o: goto iWWT5; EoHWX: $attach["\160\162\x65\166\151\145\x77\137\x74\x79\x70\x65"] = false; goto GBHgT; knT1c: if (!$newTab) { goto MoRUw; } goto FZ8zx; aQ2Fa: QYXsJ: goto HuYs5; i6mu7: MoRUw: goto H4FYx; GBHgT: $attach["\x65\162\162\x6f\x72\x5f\155\163\147"] = "\143\x61\x6e\40\156\157\x74\x20\146\x69\x6e\144\40\164\x68\145\40\x66\x69\154\145"; goto EnrQp; svK7A: $url = convertUploadSaveName2FullUrl($attach["\163\141\x76\x65\x5f\156\141\155\x65"]); goto yv_XB; dvBp4: if ($attach) { goto gdT6o; } goto e0c_C; RV5wH: hRG1Z: goto EoHWX; HuYs5: goto tL_qa; goto RV5wH; sCQP2: switch (strtolower($ext)) { case "\144\x6f\x63": case "\144\157\x63\170": case "\170\154\x73": case "\x78\154\x73\x78": case "\160\160\164": case "\x70\160\164\170": goto Hovnt; vZULz: $preview_url = "\150\x74\x74\160\163\72\57\x2f\166\x69\145\167\x2e\157\x66\146\151\x63\145\141\160\x70\x73\56\154\151\x76\x65\56\x63\157\155\x2f\x6f\160\x2f\x76\151\x65\167\56\141\x73\160\170\x3f\x73\x72\143\x3d" . $url; goto ivNNn; Hovnt: $attach["\x70\x72\x65\166\x69\145\x77\x5f\164\171\x70\x65"] = "\157\146\146\151\x63\145"; goto vZULz; ivNNn: goto el0tV; goto SSidN; SSidN: case "\160\144\146": goto wPbQF; wPbQF: $attach["\x70\162\145\166\151\145\167\x5f\x74\x79\160\145"] = "\x70\144\146"; goto bwgcK; hMvqX: goto el0tV; goto ULqUo; zidk9: $preview_url = url("\151\x6e\x64\x65\170\x2f\x55\x70\x6c\157\x61\x64\x2f\160\x64\x66\152\x73", ["\x75\x72\154" => $url]); goto RHo17; bwgcK: if (!($this->loginMobile && !isSafari())) { goto q4SPM; } goto zidk9; RHo17: q4SPM: goto hMvqX; ULqUo: case "\x6a\x70\147": case "\160\156\x67": case "\147\151\x66": case "\x6a\x70\x65\x67": $attach["\160\x72\x65\166\151\145\x77\x5f\x74\x79\x70\145"] = "\151\x6d\x61\147\x65"; goto el0tV; default: $attach["\160\x72\145\x76\x69\x65\167\137\164\171\x70\145"] = false; $attach["\145\162\162\x6f\162\137\x6d\x73\147"] = "\143\141\x6e\47\x74\x20\163\x75\x70\160\157\162\x74\x20\164\x68\145\40\146\151\x6c\145\x20\164\x79\160\x65\x20\164\157\x20\160\162\x65\166\151\145\x77\54\40\x70\x6c\x65\x61\163\145\x20\144\157\167\x6e\x6c\x6f\x61\x64\40\x69\164"; } goto iWFE0; e0c_C: return $this->fetch("\x63\x6f\x6d\x6d\157\x6e\57\145\162\162\157\x72"); goto eWKCq; zKXdy: $attach = Db::table("\x61\x74\164\141\x63\150\155\x65\156\164\163")->where("\141\x74\164\x61\x63\x68\x6d\145\156\x74\x5f\x69\144", $attachmentId)->field("\x61\164\x74\x61\143\x68\155\x65\156\164\x5f\x69\x64\54\x73\141\x76\x65\137\x6e\141\x6d\145\54\x73\x69\x7a\x65")->find(); goto dvBp4; yv_XB: $preview_url = $url; goto sCQP2; JGQ7W: el0tV: goto GvOPG; ysNQG: $filesize = filesize(iconv("\125\x54\106\x2d\x38", "\147\x62\x32\x33\61\62", $filePath)); goto JQas9; iWWT5: $ext = explode("\x2e", $attach["\x73\x61\x76\145\137\x6e\141\155\145"]); goto MQEDe; JQas9: if (!($filesize > config("\x75\x70\x6c\157\141\144\x2e\141\x6c\x6c\x6f\x77\x5f\160\x72\x65\166\x69\x65\167\x5f\x6d\141\x78\137\163\151\x7a\x65"))) { goto QYXsJ; } goto k6Nqw; bBJvd: } public function deleteAttach($attachmentId) { goto qNqMM; qNqMM: $uploadLogic = UploadLogic::newObj(); goto aikHX; aikHX: $uploadLogic->deleteAttach($attachmentId); goto OnDFo; OnDFo: return ajaxSuccess("\346\x88\220\xe5\212\237"); goto nHTPS; nHTPS: } public function deleteAttaches($attachmentIds) { goto IpaJQ; pJzGk: foreach ($attachmentIds as $attachmentId) { $uploadLogic->deleteAttach($attachmentId); y7rPr: } goto gTtHR; IpaJQ: $uploadLogic = UploadLogic::newObj(); goto pJzGk; LJuDR: return ajaxSuccess("\xe6\x88\220\345\212\x9f"); goto LKmDL; gTtHR: TkbYY: goto LJuDR; LKmDL: } public function downloadAttach($attachmentId) { goto LN02r; Vm7b7: exit("\346\232\202\xe4\xb8\x8d\346\x94\xaf\346\x8c\x81\344\270\213\xe8\275\xbd\xe6\x96\x87\344\273\xb6\xe5\xa4\271"); goto ZExwt; waWOr: if (file_exists($originalPath)) { goto y1ANo; } goto to5IG; Jxysa: header("\x43\157\x6e\164\x65\x6e\164\55\104\151\x73\x70\157\x73\x69\164\x69\157\x6e\72\x20\x61\x74\x74\141\143\x68\155\145\156\x74\x3b\x20\x66\x69\x6c\x65\x6e\x61\x6d\x65\75" . $attach["\157\x72\x69\x67\x69\156\141\154\x5f\156\141\155\145"]); goto t3Ksv; ZExwt: svl1a: goto JkHtY; JkHtY: $originalPath = convertUploadSaveName2DiskFullPath($attach["\163\141\x76\x65\137\156\x61\155\145"]); goto waWOr; t3Ksv: readfile($originalPath); goto Ynu6j; to5IG: return $this->fetch("\x63\157\x6d\155\x6f\156\57\x65\162\162\157\x72"); goto W2UqO; yuE3X: IUslD: goto bBlyk; Ynu6j: exit; goto YuSFY; IdSCu: if ($attach) { goto IUslD; } goto TqDoN; ey4K9: header("\x43\x61\143\150\145\x2d\103\x6f\156\x74\x72\x6f\154\72\x20\x70\157\163\x74\55\143\x68\145\x63\153\x3d\60\x2c\40\x70\x72\145\55\143\150\x65\143\153\x3d\60", false); goto eKNCG; LN02r: $attach = Db::table("\x61\x74\x74\141\143\x68\x6d\145\156\164\x73")->where("\x61\x74\x74\x61\x63\150\155\x65\x6e\164\137\151\x64", $attachmentId)->field("\141\x74\x74\141\x63\x68\x6d\145\156\x74\137\x69\x64\54\157\x72\151\147\x69\156\141\154\x5f\156\x61\x6d\145\x2c\x73\x61\166\x65\137\156\141\155\x65\54\x6d\x69\x6d\x65\137\164\x79\160\145\x2c\x69\163\x64\151\162")->find(); goto IdSCu; MBCjy: header("\103\x6f\156\164\145\x6e\x74\55\x54\171\x70\145\x3a\40\141\160\x70\x6c\151\143\x61\164\151\x6f\156\57\x66\157\x72\x63\x65\55\144\157\167\156\x6c\157\141\x64"); goto dNgCo; dNgCo: header("\x43\157\156\164\x65\156\x74\x2d\x4c\145\x6e\147\x74\150\x3a\40" . filesize($originalPath)); goto Jxysa; bBlyk: if (!$attach["\x69\163\144\x69\x72"]) { goto svl1a; } goto Vm7b7; W2UqO: y1ANo: goto LJ66Z; drsCQ: header("\103\x61\143\x68\x65\55\103\157\156\164\162\157\154\x3a\40\156\157\x2d\163\164\x6f\162\145\x2c\x20\x6e\x6f\x2d\x63\141\143\x68\x65\54\40\x6d\x75\163\x74\x2d\162\x65\166\141\154\151\x64\x61\164\145"); goto ey4K9; eKNCG: header("\120\162\141\x67\155\x61\x3a\x20\x6e\x6f\x2d\143\x61\x63\150\x65"); goto MBCjy; LJ66Z: header("\105\x78\160\151\x72\x65\x73\x3a\40\115\x6f\156\x2c\40\x32\x36\x20\112\x75\x6c\40\61\71\x39\x37\x20\x30\65\72\60\x30\72\x30\x30\40\107\x4d\x54"); goto drsCQ; TqDoN: return $this->fetch("\x63\157\155\155\157\156\x2f\x65\162\x72\x6f\162"); goto yuE3X; YuSFY: } public function thumbnailImage($attachmentId) { goto p163T; wJTQA: header("\x50\x72\x61\x67\x6d\141\x3a\40\156\x6f\55\143\141\x63\150\x65"); goto PdA2d; ayc2a: $thumbnailPath = convertUploadSaveNameThumbnail2DiskFullPath($attach["\x73\x61\166\x65\x5f\x6e\x61\155\145"]); goto mwbC5; CWOiZ: header("\x43\141\143\150\145\x2d\x43\x6f\x6e\164\x72\157\x6c\x3a\x20\x70\157\163\164\x2d\143\150\x65\143\x6b\75\60\54\x20\160\162\x65\55\x63\x68\x65\x63\153\x3d\60", false); goto wJTQA; c13bx: mZ35M: goto T4JSk; hwQOR: NIPrA: goto aZipc; zAgRj: try { goto UNhpS; uni4M: $image->thumb(100, 100); goto e16X_; UNhpS: $image = Image::open($originalPath); goto uni4M; bRVKs: $imagePath = $thumbnailPath; goto A501K; e16X_: $image->save($thumbnailPath); goto bRVKs; A501K: $imageType = $attach["\155\151\x6d\x65\137\x74\x79\160\145"]; goto z8SvP; z8SvP: } catch (Exception $e) { Log::error("\145\x78\x63\145\x70\x74\151\x6f\156\x20\x6f\x63\x63\165\x72\x20\167\x68\x65\156\x20\143\162\145\x61\164\x65\x20\x74\x68\x75\x6d\x62\x6e\141\151\154\x20\x69\x6d\141\147\x65\x20\146\x6f\x72\x20" . $originalPath); } goto c13bx; KWjsV: header("\x43\157\156\164\x65\156\164\x2d\114\x65\156\x67\x74\150\x3a\x20" . filesize($imagePath)); goto pNp8p; T4JSk: goto Ur6ie; goto WROb0; d4BZJ: $imageType = "\x69\155\141\x67\145\x2f\152\x70\x65\147"; goto Yqry5; pNp8p: echo file_get_contents($imagePath); goto O03kN; mwbC5: if (file_exists($thumbnailPath)) { goto u7MwF; } goto PtnUz; K8L3p: if (!file_exists($originalPath)) { goto mZ35M; } goto zAgRj; PdA2d: header("\x43\x6f\x6e\x74\145\x6e\x74\x2d\x54\x79\160\x65\72\40" . $imageType); goto KWjsV; Po7hX: $imageType = $attach["\155\x69\155\145\x5f\164\171\x70\x65"]; goto LebX3; O03kN: exit; goto ICSGv; aZipc: header("\x45\170\160\151\162\145\163\72\40\x4d\157\x6e\54\x20\62\x36\x20\x4a\165\x6c\x20\x31\71\x39\67\x20\60\x35\72\60\60\x3a\x30\60\40\107\115\x54"); goto CIkId; PtnUz: $originalPath = convertUploadSaveName2DiskFullPath($attach["\x73\x61\166\145\137\156\141\x6d\145"]); goto K8L3p; NQxG3: $imagePath = $thumbnailPath; goto Po7hX; p163T: $imagePath = STATIC_DIR . DS . "\151\x6d\147\57\x6e\x6f\137\x69\155\x61\147\145\56\152\160\x67"; goto d4BZJ; JjYQl: if (!$attach) { goto NIPrA; } goto ayc2a; Yqry5: $attach = Db::table("\141\x74\x74\141\x63\150\155\145\x6e\x74\x73")->where("\x61\x74\164\141\x63\150\x6d\x65\156\x74\x5f\151\x64", $attachmentId)->field("\141\164\x74\141\x63\x68\155\145\x6e\164\137\151\144\x2c\163\141\x76\x65\x5f\x6e\141\x6d\145\54\155\151\155\x65\137\164\171\160\145")->find(); goto JjYQl; CIkId: header("\x43\141\143\150\145\55\x43\x6f\156\164\162\x6f\154\x3a\40\156\x6f\x2d\x73\164\157\162\145\x2c\40\x6e\157\x2d\x63\x61\143\150\145\54\40\x6d\x75\163\164\55\x72\x65\166\x61\154\x69\144\x61\164\x65"); goto CWOiZ; LebX3: Ur6ie: goto hwQOR; WROb0: u7MwF: goto NQxG3; ICSGv: } public function attachesComplex($attachmentType, $externalId, $externalId2 = 0, $readOnly = 0, $fit = 0, $search = array(), $pid = 0) { goto RVZ23; KNzI8: PWq62: goto FhoBM; kUhuy: $categoryDefs["\x30"] = "\346\234\xaa\345\210\206\347\xb1\273"; goto s8OIg; EGX91: $attaches = Db::table("\x61\x74\164\x61\143\x68\x6d\x65\156\x74\163")->where($conditions)->field(true)->order("\x65\156\164\x65\162\x65\x64\40\x64\x65\163\x63")->select(); goto gm0YV; Klrnh: $bindValues = ["\141\164\164\x61\143\x68\155\145\x6e\x74\x54\171\160\145" => $attachmentType, "\x65\x78\x74\145\x72\x6e\141\x6c\x49\x64" => $externalId, "\x65\x78\164\145\x72\x6e\141\x6c\x49\x64\62" => $externalId2]; goto z2dXn; gkZrO: foreach ($additionalCategories as $additionalCategory) { $attaches[] = ["\141\164\x74\x61\x63\150\155\x65\x6e\164\x5f\151\x64" => 0, "\157\x72\x69\147\151\x6e\141\154\137\x6e\x61\x6d\x65" => '', "\163\x61\x76\145\x5f\156\141\x6d\x65" => '', "\155\151\x6d\x65\137\x74\x79\x70\x65" => '', "\x64\145\163\143\x72\151\160\x74\151\x6f\x6e" => '', "\x73\x69\x7a\x65" => '', "\x61\x74\164\x61\143\x68\155\145\156\164\x5f\x74\171\x70\x65" => $attachmentType, "\x65\x78\x74\x65\162\x6e\x61\154\x5f\x69\144" => 0, "\141\x74\164\x61\x63\150\155\145\156\164\x5f\143\141\x74\x65\x67\157\162\x79\x5f\x69\x64" => $additionalCategory["\x61\x74\x74\141\143\150\155\145\156\x74\137\143\141\164\x65\x67\157\x72\x79\137\x69\x64"], "\x65\156\164\x65\162\x65\144" => Defs::DEFAULT_DB_DATETIME_VALUE, "\165\163\x65\x72\137\151\x64" => 0]; DD7or: } goto ncpbO; RGHbG: $mimeType = $attaches[$i]["\x6d\x69\x6d\x65\x5f\164\171\x70\x65"]; goto shkWs; sU037: if (!($i < $count)) { goto CUjm8; } goto RGHbG; xRX0A: $urlHrefs = ["\141\164\x74\x61\x63\x68\x65\x73\x43\157\155\160\154\x65\170" => url("\125\160\154\x6f\141\x64\x2f\141\x74\164\x61\x63\x68\145\x73\x43\157\x6d\160\154\145\x78", ["\141\164\164\141\143\x68\x6d\145\x6e\x74\124\171\160\x65" => $attachmentType, "\x65\170\164\145\162\x6e\141\x6c\111\144" => $externalId, "\x65\170\164\x65\162\156\x61\154\x49\144\62" => $externalId2]), "\141\164\x74\141\x63\150\145\163\103\141\x74\x65\x67\x6f\162\x79\123\x61\x76\145" => url("\x55\160\154\157\141\144\x2f\x61\x74\164\141\143\150\x65\x73\103\x61\164\x65\147\157\162\171\123\141\166\x65"), "\x61\164\x74\141\x63\x68\x65\x73\103\x61\164\x65\147\x6f\x72\171\x44\x65\154\x65\164\x65" => url("\125\x70\154\157\141\144\57\x61\164\164\x61\x63\x68\145\163\x43\x61\x74\x65\147\x6f\162\x79\104\145\154\x65\164\x65"), "\x61\164\x74\141\x63\150\x65\163\x43\x61\x74\145\147\x6f\162\171\x43\150\141\x6e\x67\x65" => url("\125\x70\x6c\157\141\144\x2f\141\x74\164\141\143\150\145\x73\x43\141\164\x65\x67\x6f\x72\171\x43\150\x61\x6e\x67\x65"), "\141\164\x74\x61\x63\150\x65\x73\x43\141\164\x65\x67\157\x72\x79\x44\145\146\163" => url("\x55\x70\x6c\157\141\144\x2f\141\164\164\x61\143\150\145\163\103\141\164\145\x67\157\162\x79\x44\145\146\x73", ["\141\x74\164\x61\143\150\x6d\145\156\164\124\x79\160\145" => $attachmentType]), "\165\x70\154\157\141\x64\101\x74\x74\141\x63\150" => url("\x55\x70\154\x6f\x61\144\57\x75\x70\x6c\x6f\141\144\x41\164\164\141\143\150", ["\141\164\x74\141\x63\150\155\145\x6e\164\x54\x79\160\x65" => $attachmentType, "\145\170\164\145\x72\x6e\141\x6c\111\x64" => $externalId, "\x65\x78\164\x65\162\x6e\141\x6c\x49\x64\x32" => $externalId2]), "\165\160\x6c\x6f\141\144\x41\164\164\141\x63\x68\x5a\x69\x70" => url("\125\160\154\x6f\x61\x64\57\x75\160\154\157\141\144\101\164\164\141\143\150\132\151\160", ["\x61\164\x74\141\143\x68\155\x65\156\164\124\x79\x70\x65" => $attachmentType, "\145\x78\x74\x65\x72\x6e\x61\154\x49\144" => $externalId, "\145\x78\164\145\x72\156\141\x6c\x49\144\x32" => $externalId2]), "\x64\x65\154\145\164\x65\x41\164\164\x61\143\150" => url("\x55\160\x6c\157\141\x64\57\x64\145\154\x65\x74\145\x41\x74\x74\141\x63\x68"), "\144\x65\x6c\x65\164\145\101\x74\164\141\x63\150\145\163" => url("\x55\x70\x6c\x6f\x61\144\x2f\x64\x65\154\x65\x74\145\x41\164\164\x61\x63\150\x65\x73")]; goto XPRQC; gm0YV: $i = 0; goto YtmLX; Ygdee: $this->assign("\x72\x65\x61\x64\117\x6e\154\x79", $readOnly); goto NFXPP; S3haF: bKNgK: goto RqBnE; BT3oK: $additionalCategories = Db::table("\141\x74\x74\141\143\x68\x6d\x65\x6e\164\137\143\x61\164\145\147\x6f\x72\x69\x65\163")->where(["\141\164\164\x61\x63\150\x6d\x65\x6e\164\137\164\171\x70\145" => $attachmentType, "\x61\164\164\x61\x63\x68\x6d\x65\156\x74\x5f\x63\x61\164\x65\x67\x6f\162\x79\137\151\x64" => ["\x6e\x6f\x74\40\151\156", function ($query) use($attachmentType) { $query->table("\x61\x74\164\141\x63\x68\155\x65\156\164\163")->where("\141\x74\x74\x61\143\x68\155\145\156\164\137\164\x79\160\145", $attachmentType)->field("\141\164\164\x61\x63\x68\155\145\x6e\x74\x5f\x63\x61\x74\145\x67\157\162\171\x5f\x69\x64"); }]])->field(true)->select(); goto gkZrO; s8OIg: $this->assign("\x63\141\x74\x65\147\157\x72\x79\104\145\x66\163", $categoryDefs); goto IoxaD; tcXTw: $conditions["\157\162\151\147\x69\156\x61\154\137\x6e\141\155\145"] = ["\154\x69\x6b\145", "\x25" . trim($search["\156\x61\155\x65"]) . "\x25"]; goto S3haF; X0g_S: Y0X4F: goto KPoao; IoxaD: return $this->fetch(); goto KNzI8; shkWs: if ($mimeType == "\151\155\x61\147\145\x2f\152\160\145\147" || $mimeType == "\151\155\x61\147\x65\57\160\x6e\147" || $mimeType == "\x69\x6d\141\x67\x65\x2f\147\151\x66") { goto Vo2Yq; } goto JrKQd; ys9De: $attaches[$i]["\x74\150\x75\155\x62\156\x61\x69\x6c\x5f\165\x72\x6c"] = url("\x55\x70\154\x6f\141\144\x2f\164\150\165\155\142\x6e\x61\x69\154\x49\x6d\x61\147\145", ["\141\x74\164\x61\x63\x68\x6d\145\x6e\164\111\144" => $attaches[$i]["\x61\164\164\141\143\150\155\145\156\164\x5f\151\x64"]]); goto ZK7bg; pjRFX: return json($attaches); goto YEOxP; RVZ23: if (!request()->isGet()) { goto PWq62; } goto xRX0A; BPLxh: mVgIS: goto sU037; NFXPP: $this->assign("\146\x69\164", $fit); goto DdkNh; Qtq3v: $conditions["\145\x78\x74\x65\162\x6e\x61\154\x5f\151\x64\62"] = $externalId2; goto X0g_S; hrW3x: if ($categoryDefs) { goto mMRfy; } goto yANJP; IcDza: goto mVgIS; goto bPZKf; xJAEi: $attaches[$i]["\144\157\x77\156\x6c\x6f\141\x64\x5f\x75\162\154"] = url("\x55\160\154\157\141\144\x2f\144\157\x77\156\x6c\157\x61\144\x41\x74\x74\x61\143\150", ["\x61\164\x74\x61\x63\150\x6d\145\156\x74\x49\144" => $attaches[$i]["\x61\164\x74\141\143\x68\x6d\x65\156\164\x5f\151\x64"]]); goto VxLlp; JrKQd: $attaches[$i]["\x74\x68\x75\155\x62\156\141\151\x6c\x5f\x75\x72\154"] = SITE_URL . "\57\x73\164\141\164\x69\143\57\x69\x6d\x67\57\146\x69\154\x65\56\160\x6e\x67"; goto zFWeA; hc90e: $this->assign("\165\x6e\x69\x71\151\144", generateUniqid()); goto Ygdee; yANJP: $categoryDefs = []; goto cvi50; zFWeA: goto PzyVj; goto LInsi; bPZKf: CUjm8: goto BT3oK; FwyQB: $i++; goto IcDza; ncpbO: wuRR9: goto pjRFX; KPoao: $conditions["\160\x69\144"] = $pid; goto EGX91; YtmLX: $count = count($attaches); goto BPLxh; cvi50: mMRfy: goto kUhuy; FhoBM: $conditions = ["\141\164\164\141\x63\150\x6d\145\156\164\137\164\x79\160\x65" => $attachmentType, "\145\170\x74\x65\x72\x6e\x61\154\x5f\151\144" => $externalId, "\x73\x74\141\x74\165\x73" => Defs::ATTACHMENT_OK]; goto SegeS; XPRQC: $this->assign("\x75\x72\x6c\110\x72\x65\146\163", $urlHrefs); goto Klrnh; ZK7bg: PzyVj: goto xJAEi; DdkNh: $categoryDefs = Db::table("\141\x74\x74\x61\143\x68\155\x65\x6e\164\137\143\141\164\145\147\x6f\x72\x69\x65\163")->where("\x61\x74\164\x61\143\150\x6d\x65\156\164\137\x74\171\160\145", $attachmentType)->column("\141\164\164\141\x63\150\x6d\x65\x6e\164\137\143\x61\164\x65\x67\157\162\171", "\141\x74\164\141\x63\x68\x6d\x65\156\164\137\143\141\x74\145\x67\157\x72\x79\x5f\x69\x64"); goto hrW3x; VxLlp: So1kn: goto FwyQB; SegeS: if (!(isset($search["\x6e\141\x6d\145"]) && $search["\x6e\x61\155\145"])) { goto bKNgK; } goto tcXTw; z2dXn: $this->assign("\x62\151\x6e\x64\x56\141\x6c\165\145\x73", $bindValues); goto hc90e; LInsi: Vo2Yq: goto ys9De; RqBnE: if (!$externalId2) { goto Y0X4F; } goto Qtq3v; YEOxP: } public function attachesCategorySave($attachmentCategoryId = 0) { goto pYM8g; TGgP8: Db::table("\x61\x74\164\x61\143\150\x6d\x65\156\x74\137\x63\x61\164\x65\147\157\x72\x69\x65\x73")->insert(["\141\164\x74\x61\143\150\x6d\x65\156\x74\137\x74\x79\160\x65" => $attachmentType, "\x61\164\164\x61\143\x68\x6d\145\156\164\137\143\141\x74\x65\147\x6f\162\171" => $attachmentCategory]); goto P0B_v; O835H: $categoryDefs = []; goto dMHuE; W6sk7: $categoryDefs = Db::table("\141\x74\x74\x61\x63\150\x6d\145\x6e\x74\137\143\141\x74\145\x67\157\x72\151\x65\x73")->where("\141\x74\x74\x61\x63\150\x6d\145\156\x74\137\x74\x79\160\145", $attachmentType)->column("\x61\164\x74\x61\x63\x68\x6d\145\156\164\x5f\143\141\x74\x65\147\157\162\x79", "\141\164\x74\x61\143\150\155\x65\156\164\137\143\141\x74\145\x67\157\162\171\x5f\x69\144"); goto UAJZj; wfGr7: $attachmentCategory = input("\160\157\x73\164\x2e\141\x74\164\x61\143\x68\155\145\156\x74\137\x63\141\164\145\147\x6f\x72\171"); goto zaQJD; WWe1_: Db::table("\x61\x74\164\141\x63\150\155\x65\x6e\x74\x5f\143\141\164\x65\x67\157\162\151\145\163")->where("\141\164\164\141\143\150\155\145\x6e\164\137\143\x61\x74\145\x67\157\x72\171\x5f\151\144", $attachmentCategoryId)->update(["\141\164\164\x61\x63\150\x6d\x65\156\x74\x5f\143\x61\164\145\x67\x6f\x72\171" => $attachmentCategory]); goto LLfmT; P0B_v: l1gE5: goto W6sk7; RnI8n: Lx1Oc: goto XwDSY; hQdYT: return ajaxError("\xe9\235\236\xe6\xb3\x95\345\x8f\x82\xe6\225\260"); goto RnI8n; zaQJD: if (0 == $attachmentCategoryId) { goto E9T8e; } goto WWe1_; UAJZj: if ($categoryDefs) { goto v1ZQs; } goto O835H; dMHuE: v1ZQs: goto fw9Nm; MwnN2: return ajaxSuccess("\xe6\x88\220\xe5\x8a\x9f", $categoryDefs); goto xta1x; fw9Nm: $categoryDefs["\60"] = "\xe6\x9c\252\xe5\210\206\xe7\xb1\273"; goto RbLEy; RbLEy: $this->assign("\x63\x61\164\x65\x67\157\x72\x79\x44\145\x66\x73", $categoryDefs); goto MwnN2; pYM8g: if (!(!input("\77\160\x6f\163\x74\x2e\141\164\x74\x61\x63\150\155\x65\x6e\164\137\164\171\x70\145") || !input("\77\160\157\163\164\56\x61\164\x74\x61\x63\x68\155\145\x6e\x74\137\x63\141\x74\145\147\x6f\162\x79"))) { goto Lx1Oc; } goto hQdYT; ra4HJ: E9T8e: goto TGgP8; LLfmT: goto l1gE5; goto ra4HJ; XwDSY: $attachmentType = input("\160\157\x73\164\x2e\x61\x74\164\141\x63\150\155\145\x6e\x74\137\x74\171\160\145"); goto wfGr7; xta1x: } public function attachesCategoryDelete($attachmentCategoryId) { goto yV7Wj; YUo7x: $categoryDefs = Db::table("\x61\x74\164\x61\143\x68\x6d\145\x6e\164\137\x63\141\x74\x65\x67\x6f\x72\151\x65\163")->where("\x61\164\x74\x61\143\x68\155\x65\x6e\164\137\x74\x79\x70\145", $attachmentType)->column("\141\164\164\141\x63\150\155\x65\x6e\x74\137\x63\141\164\x65\x67\157\162\x79", "\141\164\164\141\143\x68\x6d\x65\x6e\164\137\143\141\x74\145\x67\x6f\x72\171\x5f\x69\144"); goto SyYdh; SyYdh: if ($categoryDefs) { goto KdKmc; } goto g_c4I; rAXu_: return ajaxSuccess("\346\x88\x90\345\212\237", $categoryDefs); goto qn_W_; igIIG: Db::table("\141\x74\164\x61\143\150\x6d\x65\x6e\164\163")->where("\x61\164\x74\x61\x63\150\155\145\x6e\x74\x5f\143\x61\x74\145\x67\x6f\x72\171\137\151\144", $attachmentCategoryId)->setField("\x73\164\x61\x74\x75\x73", Defs::ATTACHMENT_DEL); goto YUo7x; yK46t: $this->assign("\143\141\x74\145\147\x6f\x72\171\104\145\x66\163", $categoryDefs); goto rAXu_; A2Gln: $categoryDefs["\x30"] = "\xe6\234\xaa\345\x88\206\347\xb1\xbb"; goto yK46t; h620n: return ajaxError("\xe6\227\240\346\263\225\346\211\276\xe5\210\260\xe8\xaf\245\347\261\273\345\210\xab"); goto gc0dB; rFLMV: Db::table("\141\164\164\141\143\x68\155\145\156\164\x5f\143\x61\x74\145\x67\157\x72\151\x65\163")->where("\141\x74\x74\141\143\150\155\x65\x6e\x74\x5f\143\141\164\145\x67\x6f\x72\x79\137\151\144", $attachmentCategoryId)->delete(); goto igIIG; yV7Wj: $attachmentType = Db::table("\141\164\x74\x61\x63\x68\155\145\x6e\164\x5f\x63\x61\x74\x65\147\x6f\162\151\145\x73")->where("\141\164\x74\141\x63\150\155\x65\x6e\164\137\x63\x61\x74\145\147\157\162\171\x5f\151\144", $attachmentCategoryId)->value("\141\x74\x74\141\143\x68\155\x65\156\164\x5f\164\171\x70\145"); goto v9Rcw; g_c4I: $categoryDefs = []; goto bmQZw; bmQZw: KdKmc: goto A2Gln; v9Rcw: if (!($attachmentType === null)) { goto H3Y8x; } goto h620n; gc0dB: H3Y8x: goto rFLMV; qn_W_: } public function attachesCategoryChange($attachmentId, $attachmentCategoryId) { Db::table("\x61\x74\164\141\143\150\x6d\145\156\164\163")->where("\x61\164\164\x61\143\150\x6d\x65\x6e\164\137\151\x64", $attachmentId)->update(["\141\x74\x74\141\143\x68\155\145\x6e\164\137\x63\141\164\x65\147\x6f\162\171\137\151\x64" => $attachmentCategoryId]); return ajaxSuccess("\xe6\x88\220\xe5\212\x9f"); } public function attachesCategoryDefs($attachmentType) { goto SYNFO; V0s8K: JMH0I: goto r532Z; Zye_Y: return ajaxSuccess("\xe6\x88\x90\345\212\237", $categoryDefs); goto dAn1f; r532Z: $categoryDefs["\60"] = "\346\234\252\345\x88\206\347\261\xbb"; goto Zye_Y; BmmWI: if ($categoryDefs) { goto JMH0I; } goto kiZIu; kiZIu: $categoryDefs = []; goto V0s8K; SYNFO: $categoryDefs = Db::table("\x61\x74\x74\141\x63\x68\x6d\145\x6e\x74\137\x63\x61\x74\x65\147\x6f\x72\151\x65\x73")->where("\141\164\x74\141\143\x68\155\x65\x6e\x74\137\164\171\160\x65", $attachmentType)->column("\141\x74\164\141\143\150\x6d\145\x6e\x74\137\143\x61\164\145\x67\x6f\x72\x79", "\141\x74\x74\141\143\x68\155\145\x6e\x74\x5f\143\x61\x74\x65\147\x6f\x72\171\137\151\x64"); goto BmmWI; dAn1f: } public function setAttachesType($attachmentId, $entity_type, $target_type = 0) { goto M8lTs; zGe4u: return ajaxError("\350\xaf\xb7\xe9\x80\211\346\213\xa9\xe7\233\256\xe6\xa0\x87\xe5\210\206\347\261\273"); goto RKvDc; TGGA0: mwAK6: goto lQX6U; C3FDK: if (!empty($target_type)) { goto Nvm3K; } goto zGe4u; lQX6U: $where["\x61\x74\164\x61\143\150\155\x65\x6e\164\137\x69\144"] = count($attachmentId) > 1 ? ["\x69\156", $attachmentId] : $attachmentId[0]; goto S0cgs; mWzud: return $this->fetch('', ["\164\171\160\145\x73" => $types]); goto qOUtA; t7YIn: $types = array_filter(UploadLogic::$attachTypeDefs, function ($v) use($entity_type) { return $entity_type == $v["\x65\x6e\164\x69\x74\x79\x5f\164\x79\x70\145"]; }); goto mWzud; ivpt_: return ajaxSuccess("\344\xbf\256\xe6\x94\271\346\210\220\345\x8a\x9f"); goto w54Di; qOUtA: jTOHJ: goto C3FDK; S0cgs: Attachments::update(["\141\164\x74\141\x63\x68\x6d\145\x6e\164\x5f\164\x79\160\145" => $target_type, "\x70\151\144" => 0], $where); goto ivpt_; RKvDc: Nvm3K: goto ZjVUr; j7Am6: $attachmentId = explode("\x2c", $attachmentId); goto TGGA0; ZjVUr: if (is_array($attachmentId)) { goto mwAK6; } goto j7Am6; M8lTs: if (!$this->request->isGet()) { goto jTOHJ; } goto t7YIn; w54Di: } public function changeDir($attachment_id, $pid) { Attachments::update(["\x70\151\144" => $pid], ["\x61\164\x74\x61\143\150\x6d\x65\x6e\x74\137\151\x64" => $attachment_id]); return ajaxSuccess("\xe7\xa7\xbb\345\x8a\250\xe6\210\220\xe5\212\237"); } public function addDir($external_id, $attachment_type, $dir_name, $external_id2 = 0, $pid = 0) { Db::table("\141\164\164\141\143\150\x6d\x65\x6e\x74\x73")->insertGetId(["\157\x72\151\147\x69\156\x61\154\x5f\156\x61\155\145" => $dir_name, "\141\164\164\x61\x63\x68\155\145\x6e\x74\137\164\171\160\x65" => $attachment_type, "\145\x78\x74\x65\162\156\x61\154\x5f\x69\x64" => $external_id, "\145\170\x74\x65\162\x6e\141\x6c\x5f\x69\x64\62" => $external_id2, "\160\x69\144" => $pid, "\151\x73\x64\151\162" => 1, "\x75\x73\x65\x72\x5f\x69\x64" => $this->loginUserId, "\x75\x73\x65\162\x5f\164\171\160\x65" => CommonDefs::MODULE_ADMIN]); return ajaxSuccess("\xe6\210\x90\345\212\x9f"); } }
